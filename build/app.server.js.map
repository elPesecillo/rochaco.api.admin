{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/app.js","webpack:///./src/constants/menusConfig.js","webpack:///./src/constants/types.js","webpack:///./src/controllers/handleFile.js","webpack:///./src/controllers/menus.js","webpack:///./src/controllers/postalCodes.js","webpack:///./src/controllers/signup.js","webpack:///./src/controllers/siteAuth.js","webpack:///./src/controllers/suburb.js","webpack:///./src/controllers/userAdmin.js","webpack:///./src/logic/auth.js","webpack:///./src/logic/menuService.js","webpack:///./src/logic/postalCodeService.js","webpack:///./src/logic/suburbService.js","webpack:///./src/logic/userService.js","webpack:///./src/logic/viewPermissions.js","webpack:///./src/middleware/auth.js","webpack:///./src/models/index.js","webpack:///./src/models/menu.js","webpack:///./src/models/postalCode.js","webpack:///./src/models/role.js","webpack:///./src/models/schemas/guestSchema.js","webpack:///./src/models/schemas/suburbFileSchema.js","webpack:///./src/models/schemas/suburbStatusSchema.js","webpack:///./src/models/suburb.js","webpack:///./src/models/user.js","webpack:///./src/routes/apiRoutes.js","webpack:///./src/routes/router.js","webpack:///./src/server.js","webpack:///external \"@sendgrid/mail\"","webpack:///external \"base-64\"","webpack:///external \"bcryptjs\"","webpack:///external \"body-parser\"","webpack:///external \"cors\"","webpack:///external \"debug\"","webpack:///external \"dotenv\"","webpack:///external \"dropbox-v2-api\"","webpack:///external \"express\"","webpack:///external \"fs\"","webpack:///external \"http\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"moment\"","webpack:///external \"mongoose\"","webpack:///external \"morgan\"","webpack:///external \"multer\"","webpack:///external \"request\""],"names":["dotenv","require","express","logger","bodyParser","cors","config","connectDb","router","app","use","urlencoded","extended","json","module","exports","userType","userTypes","menus","name","path","icon","visible","validUserTypes","guard","suburbAdmin","admin","guest","neighbor","order","suburbStatus","status","description","userServices","suburbService","fs","dropboxV2Api","sgMail","getFileName","nodeFileName","originalName","idx","lastIndexOf","substring","uploadFileDropbox","file","dropbox","authenticate","token","process","env","DROPBOX_TOKEN","Promise","resolve","reject","resource","parameters","filename","originalname","readStream","createReadStream","destination","err","result","response","base64_encode","file_path","bitmap","readFileSync","Buffer","from","toString","getEmailAttachments","files","attachments","forEach","push","content","sendEmail","user","suburb","suburbId","setApiKey","SENDGRID_API_KEY","msg","to","OWNER_EMAILS","split","subject","text","html","send","ex","deleteTemporaryFiles","unlink","console","log","processFileUpload","data","userId","lastName","cellphone","email","postalCode","section","suburbName","recaptchaToken","validCaptcha","validateRecaptcha","proms","uploadedFiles","all","saveSuburb","location","active","userAdmins","getSuburbStatus","map","fil","fileName","actionType","mimetype","updateUser","_id","id","uploadFile","req","res","next","body","processFiles","message","menuService","getMenusByUser","headers","postalCodeService","getPostalCodeInfo","getCPInfo","query","signUp","undefined","success","facebookId","googleId","password","loginName","saveFacebookUser","saveGoogleUser","saveEmailUser","User","viewPermissions","validateUser","userLogin","getLogin","then","login","validPass","validatePassword","generateUserToken","succes","checkAuth","getTokenByFacebookId","getUserByFacebookId","usr","getTokenByGoogleId","getUserByGoogleId","isValidToken","isValid","valid","validateTokenPath","permissionValid","logOff","session","destroy","userService","moment","approveReject","newStatus","details","getSuburbById","addStatus","suburbAddStatus","transtime","utc","getSuburbByAdminId","getSuburbByAdminUser","resV","saveUser","userConfirmed","resSave","saveUserWithPassword","createUserByType","params","getUserByType","getUserInfo","getUserByToken","getUserFavs","userFavs","getUserFavorites","addUserFavs","favs","saveUserFavorites","removeUserFavs","removeUserFavorites","openApi","protectedApi","Auth","validateToken","def","validateAdminUser","getPayload","getTokenPayload","payload","isOpenApi","apiPath","indexOf","isProtectedApi","validateApiRequest","catch","userToken","userMenus","filter","menu","types","g","toLowerCase","length","item","errP","PostalCode","getInfo","cp","Suburb","statusName","st","suburbObj","SaveSuburb","sub","UpdateStatus","suburbAddStatusByName","UpdateStatusByName","GetSuburbByUserId","GetSuburb","request","userObj","secretKey","RECAPTCHA_SECRET","verificationURL","post","error","resG","JSON","parse","score","encryptPassword","resEncrypt","encryptedPassword","hash","find","findById","permissions","validateWithPayload","validPath","p","toLocaleLowerCase","jwt","validApiRequest","auth","stringify","checkApiAuth","baseUrl","mongoose","Menu","Role","models","mConn","connect","DB_CONNECTION","useNewUrlParser","connection","on","bind","MenuSchema","Schema","type","String","required","link","parentId","Types","ObjectId","ref","position","Number","default","Boolean","Date","statics","getMenuById","menuId","findOne","updateMenu","objMenu","update","$set","deleteMenu","deleteMany","getChildMenus","getChildMenusRecursively","parents","_this","getThisLevelChilds","elements","childs","child","getInnerChilds","concat","getParentMenusRecursively","getThisLevel","getMoreParents","getMenus","model","PostalCodeSchema","d_codigo","d_asenta","d_tipo_asenta","D_mnpio","d_estado","d_ciudad","d_CP","c_estado","c_oficina","c_CP","c_tipo_asenta","c_mnpio","id_asenta_cpcons","d_zona","c_cve_ciudad","regCp","RegExp","limit","RoleSchema","siteAdministration","sysAdministrator","deleteRole","roleId","setRoleMenu","Array","isArray","$addToSet","$each","multi","deleteRoleMenu","roles","$in","$pullAll","getRoleMenus","populate","exec","GuestSchema","vehicle","isService","plates","additionalInformation","arriveOn","leaveOn","SuburbFileSchema","SuburbStatusSchema","SuburbSchema","save","updateOne","GetSuburbByName","bcrypt","base64","UserSchema","unique","loginAttempts","temporaryDisabled","disabledSince","lastAccess","favorites","_secretKey","JWT_SECRET","_getExpDate","expTimeByMin","exptoken","add","valueOf","_getValidApis","_getValidMenus","_validateExpDate","expDate","currentTime","methods","_password","pass","decode","wait","getDisabledSince","increaseLoginAttempts","compare","start","end","diff","reset","_suburb","exp","validApis","sign","setUserRole","deleteUserRole","users","getUserRoles","getCleanResult","mergeArrayObjects","arr1","arr2","firstMerge","i","assign","a2","Object","fm","trim","_loginName","_facebookId","_googleId","mergedFavs","findOneAndUpdate","new","filterFavs","exists","f","objUser","_token","verify","decoded","saltRounds","genSalt","salt","Router","siteAuth","postalCodes","signup","handleFiles","multer","upload","dest","get","userAdmin","any","apiRoutes","debug","http","port","normalizePort","PORT","set","server","createServer","listen","onError","onListening","val","parseInt","isNaN","syscall","code","exit","addr","address"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA,MAAMA,MAAM,GAAGC,mBAAO,CAAC,sBAAD,CAAtB;;AACA,MAAMC,OAAO,GAAGD,mBAAO,CAAC,wBAAD,CAAvB;;AACA,MAAME,MAAM,GAAGF,mBAAO,CAAC,sBAAD,CAAtB;;AACA,MAAMG,UAAU,GAAGH,mBAAO,CAAC,gCAAD,CAA1B;;AACA,MAAMI,IAAI,GAAGJ,mBAAO,CAAC,kBAAD,CAApB;;AAEAD,MAAM,CAACM,MAAP;;AAEA,MAAMC,SAAS,GAAGN,mBAAO,CAAC,uCAAD,CAAP,CAAoBM,SAAtC;;AACA,IAAIC,MAAM,GAAGP,mBAAO,CAAC,+CAAD,CAApB;;AAGA,IAAIQ,GAAG,GAAGP,OAAO,EAAjB;AAEAO,GAAG,CAACC,GAAJ,CAAQN,UAAU,CAACO,UAAX,CAAsB;AAAEC,UAAQ,EAAE;AAAZ,CAAtB,CAAR;AACAH,GAAG,CAACC,GAAJ,CAAQN,UAAU,CAACS,IAAX,EAAR;AACAJ,GAAG,CAACC,GAAJ,CAAQR,OAAO,CAACW,IAAR,EAAR;AACAJ,GAAG,CAACC,GAAJ,CAAQL,IAAI,EAAZ;AACAI,GAAG,CAACC,GAAJ,CAAQP,MAAM,CAAC,KAAD,CAAd;AACAM,GAAG,CAACC,GAAJ,CAAQ,GAAR,EAAaF,MAAb;AAEAD,SAAS;AAETO,MAAM,CAACC,OAAP,GAAiBN,GAAjB,C;;;;;;;;;;;ACvBA,MAAMO,QAAQ,GAAGf,mBAAO,CAAC,yCAAD,CAAP,CAAmBgB,SAApC;AAEA;;;;;AAGAF,OAAO,CAACG,KAAR,GAAgB,CACd;AACEC,MAAI,EAAE,WADR;AAEEC,MAAI,EAAE,eAFR;AAGEC,MAAI,EAAE,0BAHR;AAIEC,SAAO,EAAE,IAJX;AAKEC,gBAAc,EAAE,CACdP,QAAQ,CAACQ,KADK,EAEdR,QAAQ,CAACS,WAFK,EAGdT,QAAQ,CAACU,KAHK,EAIdV,QAAQ,CAACW,KAJK,EAKdX,QAAQ,CAACY,QALK,CALlB;AAYEC,OAAK,EAAE;AAZT,CADc,EAed;AACEV,MAAI,EAAE,UADR;AAEEC,MAAI,EAAE,iBAFR;AAGEC,MAAI,EAAE,kBAHR;AAIEC,SAAO,EAAE,IAJX;AAKEC,gBAAc,EAAE,CAACP,QAAQ,CAACW,KAAV,EAAiBX,QAAQ,CAACQ,KAA1B,EAAiCR,QAAQ,CAACU,KAA1C,CALlB;AAMEG,OAAK,EAAE;AANT,CAfc,EAuBd;AACEV,MAAI,EAAE,cADR;AAEEE,MAAI,EAAE,kBAFR;AAGED,MAAI,EAAE,sBAHR;AAIEE,SAAO,EAAE,KAJX;AAKEC,gBAAc,EAAE,CAACP,QAAQ,CAACS,WAAV,EAAuBT,QAAQ,CAACU,KAAhC,CALlB;AAMEG,OAAK,EAAE;AANT,CAvBc,EA+Bd;AACEV,MAAI,EAAE,SADR;AAEEC,MAAI,EAAE,gBAFR;AAGEC,MAAI,EAAE,iBAHR;AAIEC,SAAO,EAAE,IAJX;AAKEC,gBAAc,EAAE,CAACP,QAAQ,CAACQ,KAAV,EAAiBR,QAAQ,CAACS,WAA1B,EAAuCT,QAAQ,CAACU,KAAhD,CALlB;AAMEG,OAAK,EAAE;AANT,CA/Bc,EAuCd;AACEV,MAAI,EAAE,SADR;AAEEC,MAAI,EAAE,iBAFR;AAGEC,MAAI,EAAE,oBAHR;AAIEC,SAAO,EAAE,IAJX;AAKEC,gBAAc,EAAE,CAACP,QAAQ,CAACU,KAAV,EAAiBV,QAAQ,CAACS,WAA1B,EAAuCT,QAAQ,CAACW,KAAhD,CALlB;AAMEE,OAAK,EAAE;AANT,CAvCc,EA+Cd;AACEV,MAAI,EAAE,gBADR;AAEEC,MAAI,EAAE,sBAFR;AAGEC,MAAI,EAAE,oBAHR;AAIEC,SAAO,EAAE,KAJX;AAKEC,gBAAc,EAAE,CAACP,QAAQ,CAACU,KAAV,EAAiBV,QAAQ,CAACS,WAA1B,EAAuCT,QAAQ,CAACW,KAAhD,CALlB;AAMEE,OAAK,EAAE;AANT,CA/Cc,EAuDd;AACEV,MAAI,EAAE,gBADR;AAEEC,MAAI,EAAE,oBAFR;AAGEC,MAAI,EAAE,oBAHR;AAIEC,SAAO,EAAE,KAJX;AAKEC,gBAAc,EAAE,CACdP,QAAQ,CAACU,KADK,EAEdV,QAAQ,CAACS,WAFK,EAGdT,QAAQ,CAACS,WAHK,CALlB;AAUEI,OAAK,EAAE;AAVT,CAvDc,CAAhB,C;;;;;;;;;;;ACLAd,OAAO,CAACE,SAAR,GAAoB;AAClBU,OAAK,EAAE,OADW;AAElBD,OAAK,EAAE,OAFW;AAGlBD,aAAW,EAAE,aAHK;AAIlBD,OAAK,EAAE,OAJW;AAKlBI,UAAQ,EAAE;AALQ,CAApB;AAQAb,OAAO,CAACe,YAAR,GAAuB,CACrB;AACEC,QAAM,EAAE,SADV;AAEEC,aAAW,EACT;AAHJ,CADqB,EAMrB;AACED,QAAM,EAAE,UADV;AAEEC,aAAW,EAAE;AAFf,CANqB,EAUrB;AACED,QAAM,EAAE,UADV;AAEEC,aAAW,EAAE;AAFf,CAVqB,EAcrB;AACED,QAAM,EAAE,UADV;AAEEC,aAAW,EAAE;AAFf,CAdqB,CAAvB,C;;;;;;;;;;;ACRA,MAAMC,YAAY,GAAGhC,mBAAO,CAAC,wDAAD,CAA5B;;AACA,MAAMiC,aAAa,GAAGjC,mBAAO,CAAC,4DAAD,CAA7B,C,CACA;;;AACA,MAAMkC,EAAE,GAAGlC,mBAAO,CAAC,cAAD,CAAlB,C,CACA;;;AACA,MAAMmC,YAAY,GAAGnC,mBAAO,CAAC,sCAAD,CAA5B;;AACA,MAAMoC,MAAM,GAAGpC,mBAAO,CAAC,sCAAD,CAAtB;;AAEA,MAAMqC,WAAW,GAAG,CAACC,YAAD,EAAeC,YAAf,KAAgC;AAClD,MAAIC,GAAG,GAAGD,YAAY,CAACE,WAAb,CAAyB,GAAzB,CAAV;AACA,SAAQ,GAAEH,YAAa,IAAGC,YAAY,CAACG,SAAb,CAAuBF,GAAG,GAAG,CAA7B,CAAgC,EAA1D;AACD,CAHD;;AAKA,MAAMG,iBAAiB,GAAIC,IAAD,IAAU;AAClC,QAAMC,OAAO,GAAGV,YAAY,CAACW,YAAb,CAA0B;AACxCC,SAAK,EAAEC,OAAO,CAACC,GAAR,CAAYC;AADqB,GAA1B,CAAhB;AAIA,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCR,WAAO,CACL;AACES,cAAQ,EAAE,cADZ;AAEEC,gBAAU,EAAE;AACVpC,YAAI,EAAG,YAAWkB,WAAW,CAACO,IAAI,CAACY,QAAN,EAAgBZ,IAAI,CAACa,YAArB,CAAmC;AADtD,OAFd;AAKEC,gBAAU,EAAExB,EAAE,CAACyB,gBAAH,CAAqB,GAAEf,IAAI,CAACgB,WAAY,IAAGhB,IAAI,CAACY,QAAS,EAAzD;AALd,KADK,EAQL,CAACK,GAAD,EAAMC,MAAN,EAAcC,QAAd,KAA2B;AACzB,UAAI,CAACF,GAAL,EAAUT,OAAO,CAACU,MAAD,CAAP,CAAV,KACKT,MAAM,CAACQ,GAAD,CAAN;AACN,KAXI,CAAP;AAaD,GAdM,CAAP;AAeD,CApBD;;AAsBA,MAAMG,aAAa,GAAIC,SAAD,IAAe;AACnC;AACA,MAAIC,MAAM,GAAGhC,EAAE,CAACiC,YAAH,CAAgBF,SAAhB,CAAb,CAFmC,CAGnC;;AACA,SAAO,IAAIG,MAAM,CAACC,IAAX,CAAgBH,MAAhB,EAAwB,QAAxB,EAAkCI,QAAlC,CAA2C,QAA3C,CAAP,CAJmC,CAI0B;AAC9D,CALD;;AAOA,MAAMC,mBAAmB,GAAIC,KAAD,IAAW;AACrC,MAAIC,WAAW,GAAG,EAAlB;AACAD,OAAK,CAACE,OAAN,CAAe9B,IAAD,IAAU;AACtB6B,eAAW,CAACE,IAAZ,CAAiB;AACfnB,cAAQ,EAAG,GAAEZ,IAAI,CAACa,YAAa,EADhB;AAEfmB,aAAO,EAAEZ,aAAa,CAAE,GAAEpB,IAAI,CAACgB,WAAY,IAAGhB,IAAI,CAACY,QAAS,EAAtC;AAFP,KAAjB;AAID,GALD;AAMA,SAAOiB,WAAP;AACD,CATD;;AAWA,MAAMI,SAAS,GAAG,OAAOL,KAAP,EAAcM,IAAd,EAAoBC,MAApB,EAA4BC,QAA5B,KAAyC;AACzD,MAAI;AACF5C,UAAM,CAAC6C,SAAP,CAAiBjC,OAAO,CAACC,GAAR,CAAYiC,gBAA7B;AAEA,UAAMC,GAAG,GAAG;AACVC,QAAE,EAAEpC,OAAO,CAACC,GAAR,CAAYoC,YAAZ,CAAyBC,KAAzB,CAA+B,GAA/B,CADM;AAEVjB,UAAI,EAAE,qBAFI;AAGVkB,aAAO,EAAE,6CAHC;AAIVC,UAAI,EAAG,wBAJG;AAKVC,UAAI,EAAG,sBAAqBX,IAAK,+BAA8BC,MAAO,iGAAgGC,QAAS,aALrK;AAMVP,iBAAW,EAAEF,mBAAmB,CAACC,KAAD;AANtB,KAAZ;AAQA,UAAMpC,MAAM,CAACsD,IAAP,CAAYP,GAAZ,CAAN;AACD,GAZD,CAYE,OAAOQ,EAAP,EAAW;AACX,UAAMA,EAAN;AACD;AACF,CAhBD;;AAkBA,MAAMC,oBAAoB,GAAIpB,KAAD,IAAW;AACtCA,OAAK,CAACE,OAAN,CAAe9B,IAAD,IAAU;AACtBV,MAAE,CAAC2D,MAAH,CAAW,GAAEjD,IAAI,CAACgB,WAAY,IAAGhB,IAAI,CAACY,QAAS,EAA/C,EAAmDK,GAAD,IAAS;AACzD,UAAIA,GAAJ,EAAS,MAAMA,GAAN;AACTiC,aAAO,CAACC,GAAR,CACG,aAAYnD,IAAI,CAACgB,WAAY,IAAGhB,IAAI,CAACY,QAAS,oBADjD;AAGD,KALD;AAMD,GAPD;AAQD,CATD;;AAWA,MAAMwC,iBAAiB,GAAG,OAAOxB,KAAP,EAAcyB,IAAd,KAAuB;AAC/C,MAAI;AACF,QAAI;AACFC,YADE;AAEFhF,UAFE;AAGFiF,cAHE;AAIFC,eAJE;AAKFC,WALE;AAMFC,gBANE;AAOFC,aAPE;AAQFC,gBARE;AASFC;AATE,QAUAR,IAVJ;AAWA,QAAIS,YAAY,GAAG,MAAM1E,YAAY,CAAC2E,iBAAb,CAA+BF,cAA/B,CAAzB;AACA,QAAIG,KAAK,GAAG,EAAZ;AACApC,SAAK,CAACE,OAAN,CAAe9B,IAAD,IAAU;AACtBgE,WAAK,CAACjC,IAAN,CAAWhC,iBAAiB,CAACC,IAAD,CAA5B;AACD,KAFD;AAGA,QAAIiE,aAAa,GAAG,MAAM1D,OAAO,CAAC2D,GAAR,CAAYF,KAAZ,CAA1B;AAEA,QAAIG,UAAU,GAAG,MAAM9E,aAAa,CAAC8E,UAAd,CAAyB;AAC9C7F,UAAI,EAAEsF,UADwC;AAE9CQ,cAAQ,EAAET,OAFoC;AAG9CD,gBAAU,EAAEA,UAHkC;AAI9CW,YAAM,EAAE,IAJsC;AAK9CC,gBAAU,EAAE,CAAChB,MAAD,CALkC;AAM9CpE,YAAM,EAAE,CAACG,aAAa,CAACkF,eAAd,CAA8B,SAA9B,CAAD,CANsC;AAO9C3C,WAAK,EAAEA,KAAK,CAAC4C,GAAN,CAAWC,GAAD,KAAU;AACzBC,gBAAQ,EAAED,GAAG,CAAC7D,QADW;AAEzBjB,oBAAY,EAAE8E,GAAG,CAAC5D,YAFO;AAGzB8D,kBAAU,EAAE,mBAHa;AAIzBC,gBAAQ,EAAEH,GAAG,CAACG;AAJW,OAAV,CAAV;AAPuC,KAAzB,CAAvB;AAeA,QAAIC,UAAU,GAAG,MAAMzF,YAAY,CAACyF,UAAb,CAAwB;AAC7CC,SAAG,EAAExB,MADwC;AAE7ChF,UAF6C;AAG7CiF,cAH6C;AAI7CC,eAJ6C;AAK7CC,WAL6C;AAM7CY,YAAM,EAAE;AANqC,KAAxB,CAAvB;AASA,UAAMpC,SAAS,CAACL,KAAD,EAAS,GAAEtD,IAAK,IAAGiF,QAAS,EAA5B,EAA+BK,UAA/B,EAA2CO,UAAU,CAACY,EAAtD,CAAf;AAEA/B,wBAAoB,CAACpB,KAAD,CAApB;AACA,WAAOuC,UAAP;AACD,GA/CD,CA+CE,OAAOpB,EAAP,EAAW;AACX,UAAMA,EAAN;AACD;AACF,CAnDD;;AAqDA7E,OAAO,CAAC8G,UAAR,GAAqB,OAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAC7C,MAAI;AACF,QAAI;AACF7B,YADE;AAEFhF,UAFE;AAGFiF,cAHE;AAIFC,eAJE;AAKFC,WALE;AAMFC,gBANE;AAOFC,aAPE;AAQFC,gBARE;AASFC;AATE,QAUAoB,GAAG,CAACG,IAVR;AAWA,QAAIC,YAAY,GAAG,MAAMjC,iBAAiB,CAAC6B,GAAG,CAACrD,KAAL,EAAY;AACpD0B,YADoD;AAEpDhF,UAFoD;AAGpDiF,cAHoD;AAIpDC,eAJoD;AAKpDC,WALoD;AAMpDC,gBANoD;AAOpDC,aAPoD;AAQpDC,gBARoD;AASpDC;AAToD,KAAZ,CAA1C;AAWAqB,OAAG,CAAChG,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqB;AAAEsH,aAAO,EAAE;AAAX,KAArB;AACD,GAxBD,CAwBE,OAAOvC,EAAP,EAAW;AACXmC,OAAG,CACAhG,MADH,CACU,GADV,EAEGlB,IAFH,CAEQ;AAAEsH,aAAO,EAAEvC,EAAE,CAACuC,OAAH,IAAc;AAAzB,KAFR;AAGD;AACF,CA9BD,C;;;;;;;;;;;ACvIA,MAAMC,WAAW,GAAGnI,mBAAO,CAAC,wDAAD,CAA3B;AAIA;;;;;AAGAc,OAAO,CAACsH,cAAR,GAAyB,OAAOP,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAC/C,MAAIhF,KAAK,GAAG8E,GAAG,CAACQ,OAAJ,CAAY,eAAZ,CAAZ;;AACA,MAAI;AACA,UAAMvE,MAAM,GAAG,MAAMqE,WAAW,CAACC,cAAZ,CAA2BrF,KAA3B,CAArB;AACA+E,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBkD,MAAvB;AACH,GAHD,CAGE,OAAOD,GAAP,EAAY;AACViE,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBiD,GAAvB;AACH;AACJ,CARD,C;;;;;;;;;;;ACPA,MAAMyE,iBAAiB,GAAGtI,mBAAO,CAAC,oEAAD,CAAjC;;AAEAc,OAAO,CAACyH,iBAAR,GAA4B,OAAOV,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAClD,MAAI;AACA,QAAIjE,MAAM,GAAG,MAAMwE,iBAAiB,CAACE,SAAlB,CAA4BX,GAAG,CAACY,KAAJ,CAAUnC,UAAtC,CAAnB;AACAwB,OAAG,CAAChG,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqBkD,MAArB;AACH,GAHD,CAIA,OAAOD,GAAP,EAAY;AACRiE,OAAG,CAAChG,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqBiD,GAArB;AACH;AACJ,CARD,C;;;;;;;;;;;ACFA,MAAMiB,IAAI,GAAG9E,mBAAO,CAAC,mDAAD,CAApB;;AAEAc,OAAO,CAAC4H,MAAR,GAAiB,CAACb,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACjC,MAAIF,GAAG,CAACG,IAAJ,CAASjF,KAAT,KAAmB4F,SAAnB,IAAgCd,GAAG,CAACG,IAAJ,CAASjF,KAAT,KAAmB,EAAnD,IAAyD8E,GAAG,CAACG,IAAJ,CAASjF,KAAT,KAAmB,IAAhF,EAAsF;AAClF+E,OAAG,CAACpC,IAAJ,CAAS;AAAEkD,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAE;AAA3B,KAAT;AACA;AACH;;AACD,MAAI;AAAE7B,SAAF;AAASnF,QAAT;AAAeiF,YAAf;AAAyBC,aAAzB;AAAoCyC,cAApC;AAAgDC,YAAhD;AAA0DC,YAA1D;AAAoEhG;AAApE,MAA8E8E,GAAG,CAACG,IAAtF;;AACA,MAAIa,UAAJ,EAAgB;AACZhB,OAAG,CAACG,IAAJ,GAAU;AAAE3B,WAAF;AAASnF,UAAT;AAAeiF,cAAf;AAAyB6C,eAAS,EAAEH,UAApC;AAAgDzC,eAAhD;AAA2DyC,gBAA3D;AAAuEC,cAAvE;AAAiFC,cAAjF;AAA2FhG;AAA3F,KAAV;AACA+B,QAAI,CAACmE,gBAAL,CAAsBpB,GAAtB,EAA2BC,GAA3B,EAAgCC,IAAhC;AACH,GAHD,MAIK,IAAIe,QAAJ,EAAc;AACfjB,OAAG,CAACG,IAAJ,GAAU;AAAE3B,WAAF;AAASnF,UAAT;AAAeiF,cAAf;AAAyB6C,eAAS,EAAEF,QAApC;AAA8C1C,eAA9C;AAAyDyC,gBAAzD;AAAqEC,cAArE;AAA+EC,cAA/E;AAAyFhG;AAAzF,KAAV;AACA+B,QAAI,CAACoE,cAAL,CAAoBrB,GAApB,EAAyBC,GAAzB,EAA8BC,IAA9B;AACH,GAHI,MAIA;AACDF,OAAG,CAACG,IAAJ,GAAU;AAAE3B,WAAF;AAASnF,UAAT;AAAeiF,cAAf;AAAyB6C,eAAS,EAAE3C,KAApC;AAA2CD,eAA3C;AAAsDyC,gBAAtD;AAAkEC,cAAlE;AAA4EC,cAA5E;AAAsFhG;AAAtF,KAAV;AACA+B,QAAI,CAACqE,aAAL,CAAmBtB,GAAnB,EAAwBC,GAAxB,EAA6BC,IAA7B;AACH,GAjBgC,CAkBjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACH,CA7DD,C;;;;;;;;;;;ACFA,MAAMqB,IAAI,GAAGpJ,mBAAO,CAAC,4CAAD,CAApB;;AACA,MAAMqJ,eAAe,GAAGrJ,mBAAO,CAAC,gEAAD,CAA/B;;AAGA,MAAMsJ,YAAY,GAAG,CAACC,SAAD,EAAYR,QAAZ,KAAyB;AAC1C,SAAO,IAAI5F,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC+F,QAAI,CAACI,QAAL,CAAcD,SAAd,EAAyBE,IAAzB,CAA8B,CAACC,KAAD,EAAQ7F,GAAR,KAAgB;AAC1C,UAAI6F,KAAJ,EAAW;AACP,YAAIC,SAAS,GAAGD,KAAK,CAACE,gBAAN,CAAuBb,QAAvB,CAAhB;AACAY,iBAAS,CAACF,IAAV,CAAe3F,MAAM,IAAI;AACrB;AACA,cAAIf,KAAK,GAAG2G,KAAK,CAACG,iBAAN,EAAZ;AACAzG,iBAAO,CAAC;AAAEwF,mBAAO,EAAE,IAAX;AAAiBV,mBAAO,EAAEnF;AAA1B,WAAD,CAAP;AACH,SAJD,EAIGc,GAAG,IAAI;AACNR,gBAAM,CAAC;AAAEuF,mBAAO,EAAE,KAAX;AAAkBV,mBAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,WAAD,CAAN;AACH,SAND;AAOH,OATD,MAUK7E,MAAM,CAAC;AAAEyG,cAAM,EAAE,KAAV;AAAiB5B,eAAO,EAAE;AAA1B,OAAD,CAAN;AACR,KAZD;AAaH,GAdM,CAAP;AAeH,CAhBD;;AAkBApH,OAAO,CAACiJ,SAAR,GAAoB,CAAClC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACpC;AACA,MAAIjD,IAAI,GAAG+C,GAAG,CAACG,IAAJ,CAASlD,IAApB;AACA,MAAIiE,QAAQ,GAAGlB,GAAG,CAACG,IAAJ,CAASe,QAAxB;AACAO,cAAY,CAACxE,IAAD,EAAOiE,QAAP,CAAZ,CAA6BU,IAA7B,CAAkC3F,MAAM,IAAI;AACxC,QAAIA,MAAM,CAAC8E,OAAX,EAAoB;AAChB;AACA;AACA;AACAd,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBkD,MAAvB;AACH,KALD,MAOIgE,GAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAE;AAA3B,KAAvB;AACP,GATD,EASGrE,GAAG,IAAI;AACNiE,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAAvB;AACH,GAXD;AAYH,CAhBD;;AAkBApH,OAAO,CAACkJ,oBAAR,GAA+B,CAACnC,GAAD,EAAMC,GAAN,KAAc;AACzC,MAAIe,UAAU,GAAGhB,GAAG,CAACY,KAAJ,CAAU,IAAV,CAAjB;AACAW,MAAI,CAACa,mBAAL,CAAyBpB,UAAzB,EAAqCY,IAArC,CAA0CS,GAAG,IAAI;AAC7C,QAAIA,GAAJ,EAAS;AACL,UAAInH,KAAK,GAAGmH,GAAG,CAACL,iBAAJ,EAAZ;AACA/B,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEmC;AAAF,OAAvB;AACH,KAHD,MAIK;AACD+E,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEmC,aAAK,EAAE;AAAT,OAAvB;AACH;AACJ,GARD;AASH,CAXD;;AAaAjC,OAAO,CAACqJ,kBAAR,GAA6B,CAACtC,GAAD,EAAMC,GAAN,KAAc;AACvC,MAAIgB,QAAQ,GAAGjB,GAAG,CAACY,KAAJ,CAAU,IAAV,CAAf;AACAW,MAAI,CAACgB,iBAAL,CAAuBtB,QAAvB,EAAiCW,IAAjC,CAAsCS,GAAG,IAAI;AACzC,QAAIA,GAAJ,EAAS;AACL,UAAInH,KAAK,GAAGmH,GAAG,CAACL,iBAAJ,EAAZ;AACA/B,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEmC;AAAF,OAAvB;AACH,KAHD,MAIK;AACD+E,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEmC,aAAK,EAAE;AAAT,OAAvB;AACH;AACJ,GARD;AASH,CAXD;;AAaAjC,OAAO,CAACuJ,YAAR,GAAuB,CAACxC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACvC,MAAIhF,KAAK,GAAG8E,GAAG,CAACQ,OAAJ,CAAY,eAAZ,CAAZ;AACA,SAAO,IAAIlF,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC+F,QAAI,CAACiB,YAAL,CAAkBtH,KAAlB,EAAyB0G,IAAzB,CAA+Ba,OAAD,IAAa;AACvC,UAAIA,OAAJ,EACIxC,GAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAE2J,aAAK,EAAE,IAAT;AAAerC,eAAO,EAAE;AAAxB,OAAvB,EADJ,KAGIJ,GAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkB;AACdyI,aAAK,EAAE,KADO;AAEdrC,eAAO,EAAE;AAFK,OAAlB;AAKP,KATD,EASGrE,GAAG,IAAIiE,GAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkB+B,GAAlB,CATV;AAUH,GAXM,CAAP;AAaH,CAfD;;AAiBA/C,OAAO,CAAC0J,iBAAR,GAA4B,CAAC3C,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC5C,MAAI;AAAEhF,SAAF;AAAS+B,QAAT;AAAe3D;AAAf,MAAwB0G,GAAG,CAACG,IAAhC,CAD4C,CAE5C;;AACAqB,iBAAe,CAACoB,eAAhB,CAAgCtJ,IAAhC,EAAsC4B,KAAtC,EAA6C+B,IAA7C,EAAmD2E,IAAnD,CAAwD3F,MAAM,IAAI;AAC9DgE,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAE2J,WAAK,EAAE,IAAT;AAAerC,aAAO,EAAE;AAAxB,KAAvB;AACH,GAFD,EAEGrE,GAAG,IAAI;AACNiE,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBiD,GAAvB;AACH,GAJD;AAKH,CARD;;AAUA/C,OAAO,CAAC4J,MAAR,GAAiB,CAAC7C,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACjC,MAAIF,GAAG,CAAC8C,OAAR,EACI9C,GAAG,CAAC8C,OAAJ,CAAYC,OAAZ,CAAoB/G,GAAG,IAAI;AACvB,QAAIA,GAAJ,EACIiE,GAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAAvB;AACJJ,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEgI,aAAO,EAAE,IAAX;AAAiBV,aAAO,EAAE;AAA1B,KAAvB;AACH,GAJD;AAKP,CAPD,C;;;;;;;;;;;AC7FA,MAAMjG,aAAa,GAAGjC,mBAAO,CAAC,4DAAD,CAA7B;;AACA,MAAM6K,WAAW,GAAG7K,mBAAO,CAAC,wDAAD,CAA3B;;AACA,MAAMgB,SAAS,GAAGhB,mBAAO,CAAC,oDAAD,CAAP,CAA8BgB,SAAhD;;AACA,MAAM8J,MAAM,GAAG9K,mBAAO,CAAC,sBAAD,CAAtB;;AAEAc,OAAO,CAACiK,aAAR,GAAwB,OAAOlD,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAChD,MAAI;AACF,QAAI;AAAE/C,cAAF;AAAYgG,eAAZ;AAAuBC;AAAvB,QAAmCpD,GAAG,CAACG,IAA3C;AACA,QAAIjD,MAAM,GAAG,MAAM9C,aAAa,CAACiJ,aAAd,CAA4BlG,QAA5B,CAAnB;AACA,QAAIlD,MAAM,GAAGG,aAAa,CAACkF,eAAd,CAA8B6D,SAA9B,CAAb;;AACA,QAAIjG,MAAM,IAAIjD,MAAd,EAAsB;AACpB,UAAIqJ,SAAS,GAAG,MAAMlJ,aAAa,CAACmJ,eAAd,CAA8BpG,QAA9B,EAAwC,EAC5D,GAAGlD,MADyD;AAE5DmJ,eAF4D;AAG5DI,iBAAS,EAAEP,MAAM,CAACQ,GAAP;AAHiD,OAAxC,CAAtB;;AAKA,UAAIH,SAAJ,EAAe;AACb,YAAIrJ,MAAM,CAACA,MAAP,KAAkB,UAAtB,EACE,MAAM+I,WAAW,CAACpD,UAAZ,CAAuB;AAC3BC,aAAG,EAAE3C,MAAM,CAACmC,UAAP,CAAkB,CAAlB,EAAqBS,EADC;AAE3B5G,kBAAQ,EAAEC,SAAS,CAACQ,WAFO;AAG3B6J,mBAAS,EAAEP,MAAM,CAACQ,GAAP;AAHgB,SAAvB,CAAN;AAKFxD,WAAG,CAAChG,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqB;AACnBgI,iBAAO,EAAE,IADU;AAEnBV,iBAAO,EAAG,uEAAsEpG,MAAM,CAACA,MAAO;AAF3E,SAArB;AAID;AACF,KAlBD,MAmBEgG,GAAG,CAAChG,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqB;AACnBgI,aAAO,EAAE,KADU;AAEnBV,aAAO,EAAE;AAFU,KAArB;AAIH,GA3BD,CA2BE,OAAOvC,EAAP,EAAW;AACXmC,OAAG,CAAChG,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqB;AACnBgI,aAAO,EAAE,KADU;AAEnBV,aAAO,EAAEvC,EAAE,CAACuC,OAAH,IAAc;AAFJ,KAArB;AAID;AACF,CAlCD;;AAoCApH,OAAO,CAACyK,kBAAR,GAA6B,CAAC1D,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC/C,MAAI7B,MAAM,GAAG2B,GAAG,CAACY,KAAJ,CAAUd,EAAvB;AACA1F,eAAa,CAACuJ,oBAAd,CAAmCtF,MAAnC,EAA2CuD,IAA3C,CACG3F,MAAD,IAAY;AACVgE,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBkD,MAAvB;AACD,GAHH,EAIGD,GAAD,IAAS;AACPiE,OAAG,CAAChG,MAAJ,CAAW,GAAX,EAAgBlB,IAAhB,CAAqB;AACnBgI,aAAO,EAAE,KADU;AAEnBV,aAAO,EACLrE,GAAG,CAACqE,OAAJ,IAAe;AAHE,KAArB;AAKD,GAVH;AAYD,CAdD,C;;;;;;;;;;;ACzCA,MAAM2C,WAAW,GAAG7K,mBAAO,CAAC,wDAAD,CAA3B;;AACA,MAAMgB,SAAS,GAAGhB,mBAAO,CAAC,oDAAD,CAAP,CAA8BgB,SAAhD;;AAEAF,OAAO,CAACoI,cAAR,GAAyB,CAACrB,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC3C;AACA,MAAI;AACF7G,QADE;AAEFiF,YAFE;AAGF6C,aAHE;AAIF3C,SAJE;AAKF0C,YALE;AAMF3C,aANE;AAOFyC,cAPE;AAQFC,YARE;AASF/F;AATE,MAUA8E,GAAG,CAACG,IAVR,CAF2C,CAa3C;;AACA6C,aAAW,CAAClE,iBAAZ,CAA8B5D,KAA9B,EAAqC0G,IAArC,CACGgC,IAAD,IAAU;AACR;AACAZ,eAAW,CACRa,QADH,CACY;AACRxK,UADQ;AAERiF,cAFQ;AAGR6C,eAHQ;AAIR3C,WAJQ;AAKR0C,cALQ;AAMR3C,eANQ;AAORyC,gBAPQ;AAQRC,cARQ;AASR6C,mBAAa,EAAE;AATP,KADZ,EAYGlC,IAZH,CAaKmC,OAAD,IAAa;AACX9D,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AACrBgI,eAAO,EAAE,IADY;AAErBV,eAAO,EAAEJ,GAAG,CAACI,OAAJ,IAAe;AAFH,OAAvB;AAID,KAlBL,EAmBKrE,GAAD,IAAS;AACPiE,SAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,OAFR;AAGD,KAvBL;AAyBD,GA5BH,EA6BGrE,GAAD,IAAS;AACPiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD,GAjCH;AAmCD,CAjDD;;AAmDApH,OAAO,CAACmI,gBAAR,GAA2B,CAACpB,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC7C,MAAI;AACF7G,QADE;AAEFiF,YAFE;AAGF6C,aAHE;AAIF3C,SAJE;AAKF0C,YALE;AAMF3C,aANE;AAOFyC,cAPE;AAQFC,YARE;AASF/F;AATE,MAUA8E,GAAG,CAACG,IAVR,CAD6C,CAY7C;;AACA6C,aAAW,CAAClE,iBAAZ,CAA8B5D,KAA9B,EAAqC0G,IAArC,CACGgC,IAAD,IAAU;AACR;AACAZ,eAAW,CACRa,QADH,CACY;AACRxK,UADQ;AAERiF,cAFQ;AAGR6C,eAHQ;AAIR3C,WAJQ;AAKR0C,cALQ;AAMR3C,eANQ;AAORyC,gBAPQ;AAQRC,cARQ;AASR6C,mBAAa,EAAE;AATP,KADZ,EAYGlC,IAZH,CAaKmC,OAAD,IAAa;AACX9D,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AACrBgI,eAAO,EAAE,IADY;AAErBV,eAAO,EAAEJ,GAAG,CAACI,OAAJ,IAAe;AAFH,OAAvB;AAID,KAlBL,EAmBKrE,GAAD,IAAS;AACPiE,SAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,OAFR;AAGD,KAvBL;AAyBD,GA5BH,EA6BGrE,GAAD,IAAS;AACPiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD,GAjCH;AAmCD,CAhDD;;AAkDApH,OAAO,CAACqI,aAAR,GAAwB,CAACtB,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC1C,MAAI;AACF7G,QADE;AAEFiF,YAFE;AAGF6C,aAHE;AAIF3C,SAJE;AAKF0C,YALE;AAMF3C,aANE;AAOFyC,cAPE;AAQFC,YARE;AASF/F;AATE,MAUA8E,GAAG,CAACG,IAVR,CAD0C,CAY1C;;AACA6C,aAAW,CAAClE,iBAAZ,CAA8B5D,KAA9B,EAAqC0G,IAArC,CACGgC,IAAD,IAAU;AACR;AACAZ,eAAW,CACRgB,oBADH,CACwB;AACpB3K,UADoB;AAEpBiF,cAFoB;AAGpB6C,eAHoB;AAIpB3C,WAJoB;AAKpB0C,cAAQ,EAAEA,QALU;AAMpB3C,eANoB;AAOpByC,gBAPoB;AAQpBC,cARoB;AASpB6C,mBAAa,EAAE;AATK,KADxB,EAYGlC,IAZH,CAaKmC,OAAD,IAAa;AACX9D,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AACrBgI,eAAO,EAAE,IADY;AAErBV,eAAO,EAAEJ,GAAG,CAACI,OAAJ,IAAe;AAFH,OAAvB;AAID,KAlBL,EAmBKrE,GAAD,IAAS;AACPiE,SAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,OAFR;AAGD,KAvBL;AAyBD,GA5BH,EA6BGrE,GAAD,IAAS;AACPiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD,GAjCH;AAmCD,CAhDD;;AAkDApH,OAAO,CAACgL,gBAAR,GAA2B,OAAOjE,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AACnD,MAAI;AACF,UAAM;AAAE7G,UAAF;AAAQiF,cAAR;AAAkB6C,eAAlB;AAA6B3C,WAA7B;AAAoCD;AAApC,QAAkDyB,GAAG,CAACG,IAA5D;AACA,UAAMjH,QAAQ,GAAGC,SAAS,CAAC6G,GAAG,CAACkE,MAAJ,CAAWhL,QAAZ,CAA1B;;AACA,QAAI,CAACA,QAAL,EAAe;AACb+G,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEgI,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAE;AAA3B,OAAvB;AACA;AACD;;AACD,UAAMpE,MAAM,GAAG,MAAM+G,WAAW,CAACa,QAAZ,CAAqB;AACxCxK,UADwC;AAExCiF,cAFwC;AAGxC6C,eAHwC;AAIxC3C,WAJwC;AAKxCD,eALwC;AAMxCuF,mBAAa,EAAE,KANyB;AAOxC5K;AAPwC,KAArB,CAArB;AASA+G,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AACrBgI,aAAO,EAAE,IADY;AAErBV,aAAO,EAAEpE,MAAM,CAACoE,OAAP,IAAkB;AAFN,KAAvB;AAID,GApBD,CAoBE,OAAOrE,GAAP,EAAY;AACZiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD;AACF,CA1BD;;AA4BApH,OAAO,CAACkL,aAAR,GAAwB,OAAOnE,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAChD,MAAI;AACF,UAAMhH,QAAQ,GAAGC,SAAS,CAAC6G,GAAG,CAACkE,MAAJ,CAAWhL,QAAZ,CAA1B;;AACA,QAAI,CAACA,QAAL,EAAe;AACb+G,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEgI,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAE;AAA3B,OAAvB;AACA;AACD;;AACD,UAAMpE,MAAM,GAAG,MAAM+G,WAAW,CAACmB,aAAZ,CAA0BjL,QAA1B,CAArB;AACA+G,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AAAEgI,aAAO,EAAE,IAAX;AAAiB3C,UAAI,EAAEnC;AAAvB,KAAvB;AACD,GARD,CAQE,OAAOD,GAAP,EAAY;AACZiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD;AACF,CAdD;;AAgBApH,OAAO,CAACmL,WAAR,GAAsB,OAAOpE,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAC9C,MAAI;AACF8C,eAAW,CAACqB,cAAZ,CAA2BrE,GAAG,CAACY,KAAJ,CAAU1F,KAArC,EAA4C0G,IAA5C,CACG3F,MAAD,IAAY;AACVgE,SAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBkD,MAAvB;AACD,KAHH,EAIGD,GAAD,IAAS;AACPiE,SAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,OAFR;AAGD,KARH;AAUD,GAXD,CAWE,OAAOrE,GAAP,EAAY;AACZiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD;AACF,CAjBD;;AAmBApH,OAAO,CAACqL,WAAR,GAAsB,OAAOtE,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAC9C,MAAI;AACF,QAAIqE,QAAQ,GAAG,MAAMvB,WAAW,CAACwB,gBAAZ,CAA6BxE,GAAG,CAACY,KAAJ,CAAUvC,MAAvC,CAArB;AACA4B,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBwL,QAAvB;AACD,GAHD,CAGE,OAAOvI,GAAP,EAAY;AACZiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD;AACF,CATD;;AAWApH,OAAO,CAACwL,WAAR,GAAsB,OAAOzE,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAC9C,MAAI;AACF,QAAI;AAAEwE,UAAF;AAAQrG;AAAR,QAAmB2B,GAAG,CAACG,IAA3B;AACA,QAAIoE,QAAQ,GAAG,MAAMvB,WAAW,CAAC2B,iBAAZ,CAA8BtG,MAA9B,EAAsCqG,IAAtC,CAArB;AACAzE,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBwL,QAAvB;AACD,GAJD,CAIE,OAAOvI,GAAP,EAAY;AACZiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD;AACF,CAVD;;AAYApH,OAAO,CAAC2L,cAAR,GAAyB,OAAO5E,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AACjD,MAAI;AACF,QAAI;AAAEwE,UAAF;AAAQrG;AAAR,QAAmB2B,GAAG,CAACG,IAA3B;AACA,QAAIoE,QAAQ,GAAG,MAAMvB,WAAW,CAAC6B,mBAAZ,CAAgCxG,MAAhC,EAAwCqG,IAAxC,CAArB;AACAzE,OAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuBwL,QAAvB;AACD,GAJD,CAIE,OAAOvI,GAAP,EAAY;AACZiE,OAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkBV,aAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,KAFR;AAGD;AACF,CAVD,C;;;;;;;;;;;AChPA,MAAMkB,IAAI,GAAGpJ,mBAAO,CAAC,4CAAD,CAApB;;AACA,MAAMgB,SAAS,GAAGhB,mBAAO,CAAC,oDAAD,CAAP,CAA8BgB,SAAhD;;AAEA,MAAM2L,OAAO,GAAG,CACd,gBADc,EAEd,mBAFc,EAGd,uBAHc,EAId,qBAJc,EAKd,uBALc,EAMd,oBANc,EAOd,aAPc,EAQd,wBARc,EASd,mBATc,EAUd,kBAVc,EAWd,yBAXc,EAWa;AAC3B,4BAZc,EAYgB;AAC9B,+BAbc,CAAhB;AAgBA,MAAMC,YAAY,GAAG,CAAC,2BAAD,CAArB;AAEA/L,MAAM,CAACC,OAAP,GAAiB,MAAM+L,IAAN,CAAW;AAC1BC,eAAa,CAAC/J,KAAD,EAAQ;AACnB,QAAI+B,IAAI,GAAGsE,IAAX;AAEA,QAAI2D,GAAG,GAAGjI,IAAI,CAACuF,YAAL,CAAkBtH,KAAlB,CAAV;AACA,WAAO,IAAII,OAAJ,CACL,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACnB0J,SAAG,CAACtD,IAAJ,CAAS,UAAUa,OAAV,EAAmB;AAC1B,YAAIA,OAAJ,EAAalH,OAAO,CAAC;AAAEmH,eAAK,EAAE,IAAT;AAAerC,iBAAO,EAAE;AAAxB,SAAD,CAAP,CAAb,KAEE9E,OAAO,CAAC;AACNmH,eAAK,EAAE,KADD;AAENrC,iBAAO,EAAE;AAFH,SAAD,CAAP;AAIH,OAPD;AAQD,KAVI,EAWJrE,GAAD,IAASR,MAAM,CAAC;AAAEkH,WAAK,EAAE,KAAT;AAAgBrC,aAAO,EAAE;AAAzB,KAAD,CAXV,CAAP;AAaD;;AAED8E,mBAAiB,CAACjK,KAAD,EAAQ;AACvB,QAAI+B,IAAI,GAAGsE,IAAX;AACA,QAAI6D,UAAU,GAAGnI,IAAI,CAACoI,eAAL,CAAqBnK,KAArB,CAAjB;AACA,WAAO,IAAII,OAAJ,CACL,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACnB4J,gBAAU,CAACxD,IAAX,CAAiB0D,OAAD,IAAa;AAC3B,YAAIA,OAAO,CAACpM,QAAR,KAAqBC,SAAS,CAACS,KAAnC,EACE4B,MAAM,CAAC;AACLkH,eAAK,EAAE,KADF;AAELrC,iBAAO,EACL;AAHG,SAAD,CAAN,CADF,KAMK9E,OAAO,CAAC;AAAEmH,eAAK,EAAE,IAAT;AAAerC,iBAAO,EAAE;AAAxB,SAAD,CAAP;AACN,OARD;AASD,KAXI,EAYJrE,GAAD,IAAS;AACPiC,aAAO,CAACC,GAAR,CAAYlC,GAAZ;AACAR,YAAM,CAAC;AACLkH,aAAK,EAAE,KADF;AAELrC,eAAO,EAAE;AAFJ,OAAD,CAAN;AAID,KAlBI,CAAP;AAoBD;;AAEDkF,WAAS,CAACC,OAAD,EAAU;AACjB,WAAOV,OAAO,CAACW,OAAR,CAAgBD,OAAhB,MAA6B,CAAC,CAA9B,GAAkC,IAAlC,GAAyC,KAAhD;AACD;;AAEDE,gBAAc,CAACF,OAAD,EAAU;AACtB,WAAOT,YAAY,CAACU,OAAb,CAAqBD,OAArB,MAAkC,CAAC,CAAnC,GAAuC,IAAvC,GAA8C,KAArD;AACD;;AAEDG,oBAAkB,CAACH,OAAD,EAAUtK,KAAV,EAAiB;AACjC,QAAI,KAAKqK,SAAL,CAAeC,OAAf,CAAJ,EACE,OAAO,IAAIlK,OAAJ,CAAaC,OAAD,IACjBA,OAAO,CAAC;AAAEmH,WAAK,EAAE,IAAT;AAAerC,aAAO,EAAE;AAAxB,KAAD,CADF,CAAP,CADF,KAIK,IAAI,KAAKqF,cAAL,CAAoBF,OAApB,CAAJ,EAAkC;AACrC,aAAO,IAAIlK,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,aAAK2J,iBAAL,CAAuBjK,KAAvB,EACG0G,IADH,CACS3B,GAAD,IAAS;AACb,cAAIgF,aAAa,GAAG,KAAKA,aAAL,CAAmB/J,KAAnB,CAApB;AACA+J,uBAAa,CACVrD,IADH,CACS3B,GAAD,IAAS1E,OAAO,CAAC0E,GAAD,CADxB,EAEG2F,KAFH,CAEU5J,GAAD,IAASR,MAAM,CAACQ,GAAD,CAFxB;AAGD,SANH,EAOG4J,KAPH,CAOU5J,GAAD,IAAS;AACdR,gBAAM,CAACQ,GAAD,CAAN;AACD,SATH;AAUD,OAXM,CAAP;AAYD,KAbI,MAaE;AACL,aAAO,KAAKiJ,aAAL,CAAmB/J,KAAnB,CAAP;AACD;AACF;;AA1EyB,CAA5B,C;;;;;;;;;;;ACrBA,MAAMqG,IAAI,GAAGpJ,mBAAO,CAAC,4CAAD,CAApB;;AACA,MAAMiB,KAAK,GAAGjB,mBAAO,CAAC,gEAAD,CAAP,CAAoCiB,KAAlD;AAEA;;;;;AAGAH,OAAO,CAACsH,cAAR,GAAyB,MAAOsF,SAAP,IAAqB;AAC5C,SAAO,IAAIvK,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,QAAI4J,UAAU,GAAG7D,IAAI,CAAC8D,eAAL,CAAqBQ,SAArB,CAAjB;AACAT,cAAU,CAACxD,IAAX,CAAgB0D,OAAO,IAAI;AACzB,YAAM;AAAEpM,gBAAF;AAAYiI;AAAZ,UAA0BmE,OAAhC;AAEA,UAAIQ,SAAS,GAAG1M,KAAK,CAAC2M,MAAN,CAAaC,IAAI,IAAI;AACnC,YAAIC,KAAK,GAAGD,IAAI,CAACvM,cAAL,CAAoBsM,MAApB,CAA2BG,CAAC,IAAIA,CAAC,CAACC,WAAF,OAAoBjN,QAAQ,CAACiN,WAAT,EAApD,CAAZ;AACA,eAAOF,KAAK,CAACG,MAAN,GAAe,CAAtB;AACD,OAHe,EAGb7G,GAHa,CAGT8G,IAAI,KAAK;AAAEhN,YAAI,EAAEgN,IAAI,CAAChN,IAAb;AAAmBC,YAAI,EAAE+M,IAAI,CAAC/M,IAA9B;AAAoCE,eAAO,EAAE6M,IAAI,CAAC7M,OAAlD;AAA2DD,YAAI,EAAE8M,IAAI,CAAC9M,IAAtE;AAA4EQ,aAAK,EAAEsM,IAAI,CAACtM;AAAxF,OAAL,CAHK,CAAhB;AAMAwB,aAAO,CAACuK,SAAD,CAAP;AACD,KAVD,EAUGQ,IAAI,IAAI;AACT9K,YAAM,CAAC;AAAEkH,aAAK,EAAE,KAAT;AAAgBrC,eAAO,EAAE;AAAzB,OAAD,CAAN;AACD,KAZD;AAaD,GAfM,CAAP;AAgBD,CAjBD,C;;;;;;;;;;;ACNA,MAAMkG,UAAU,GAAGpO,mBAAO,CAAC,wDAAD,CAA1B;;AAGAc,OAAO,CAAC0H,SAAR,GAAoB,MAAOlC,UAAP,IAAsB;AACtC,SAAO,IAAInD,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,QAAIiD,UAAU,CAAC2H,MAAX,GAAoB,CAAxB,EAA2B;AACvBI,aAAO,GAAGD,UAAU,CAAC5F,SAAX,CAAqBlC,UAArB,CAAV;AACA+H,aAAO,CAAC5E,IAAR,CAAa6E,EAAE,IAAI;AACflL,eAAO,CAACkL,EAAD,CAAP;AACH,OAFD,EAEGzK,GAAG,IAAI;AACNR,cAAM,CAAC;AAAEkH,eAAK,EAAE,KAAT;AAAgBrC,iBAAO,EAAE;AAAzB,SAAD,CAAN;AACH,OAJD;AAKH,KAPD,MAQK;AACD7E,YAAM,CAAC;AAAEkH,aAAK,EAAE,KAAT;AAAgBrC,eAAO,EAAE;AAAzB,OAAD,CAAN;AACH;AACJ,GAZM,CAAP;AAaH,CAdD,C;;;;;;;;;;;ACHA,MAAMqG,MAAM,GAAGvO,mBAAO,CAAC,gDAAD,CAAtB;;AACA,MAAM6B,YAAY,GAAG7B,mBAAO,CAAC,oDAAD,CAAP,CAA8B6B,YAAnD;;AAEA,MAAMsF,eAAe,GAAIqH,UAAD,IAAgB;AACtC,MAAI1M,MAAM,GAAGD,YAAY,CAAC+L,MAAb,CAAqBa,EAAD,IAAQA,EAAE,CAAC3M,MAAH,KAAc0M,UAA1C,CAAb;AACA,SAAO1M,MAAM,CAAC,CAAD,CAAb;AACD,CAHD;;AAKA,MAAMiF,UAAU,GAAI2H,SAAD,IAAe;AAChC,SAAO,IAAIvL,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCkL,UAAM,CAACI,UAAP,CAAkBD,SAAlB,EAA6BjF,IAA7B,CAAkC,CAACmF,GAAD,EAAM/K,GAAN,KAAc;AAC9C,UAAI,CAACA,GAAL,EACET,OAAO,CAAC;AACNwF,eAAO,EAAE,IADH;AAENV,eAAO,EAAE,wCAFH;AAGNP,UAAE,EAAEiH,GAAG,CAACjH;AAHF,OAAD,CAAP,CADF,KAOEtE,MAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EACLrE,GAAG,CAACqE,OAAJ,IAAe;AAHZ,OAAD,CAAN;AAKH,KAbD;AAcD,GAfM,CAAP;AAgBD,CAjBD;;AAmBA,MAAMkD,eAAe,GAAG,CAACzD,EAAD,EAAK7F,MAAL,KAAgB;AACtC,SAAO,IAAIqB,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCkL,UAAM,CAACM,YAAP,CAAoBlH,EAApB,EAAwB7F,MAAxB,EAAgC2H,IAAhC,CAAqC,CAACmF,GAAD,EAAM/K,GAAN,KAAc;AACjD,UAAI,CAACA,GAAL,EACET,OAAO,CAAC;AACNwF,eAAO,EAAE,IADH;AAENV,eAAO,EAAE;AAFH,OAAD,CAAP,CADF,KAME7E,MAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EACLrE,GAAG,CAACqE,OAAJ,IACA;AAJG,OAAD,CAAN;AAMH,KAbD;AAcD,GAfM,CAAP;AAgBD,CAjBD;;AAmBA,MAAM4G,qBAAqB,GAAG,CAAC5N,IAAD,EAAOoF,UAAP,EAAmBxE,MAAnB,KAA8B;AAC1D,SAAO,IAAIqB,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCkL,UAAM,CAACQ,kBAAP,CAA0B7N,IAA1B,EAAgCoF,UAAhC,EAA4CxE,MAA5C,EAAoD2H,IAApD,CAAyD,CAACmF,GAAD,EAAM/K,GAAN,KAAc;AACrE,UAAI,CAACA,GAAL,EACET,OAAO,CAAC;AACNwF,eAAO,EAAE,IADH;AAENV,eAAO,EAAE;AAFH,OAAD,CAAP,CADF,KAME7E,MAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EACLrE,GAAG,CAACqE,OAAJ,IACA;AAJG,OAAD,CAAN;AAMH,KAbD;AAcD,GAfM,CAAP;AAgBD,CAjBD;;AAmBA,MAAMsD,oBAAoB,GAAItF,MAAD,IAAY;AACvC,SAAO,IAAI/C,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCkL,UAAM,CAACS,iBAAP,CAAyB9I,MAAzB,EAAiCuD,IAAjC,CAAsC,CAACmF,GAAD,EAAM/K,GAAN,KAAc;AAClD,UAAI,CAACA,GAAL,EAAUT,OAAO,CAACwL,GAAD,CAAP,CAAV,KAEEvL,MAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EACLrE,GAAG,CAACqE,OAAJ,IACA;AAJG,OAAD,CAAN;AAMH,KATD;AAUD,GAXM,CAAP;AAYD,CAbD;;AAeA,MAAMgD,aAAa,GAAIlG,QAAD,IAAc;AAClC,SAAO,IAAI7B,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCkL,UAAM,CAACU,SAAP,CAAiBjK,QAAjB,EACGyE,IADH,CACQ,CAACmF,GAAD,EAAM/K,GAAN,KAAc;AAClB,UAAI,CAACA,GAAL,EAAUT,OAAO,CAACwL,GAAD,CAAP,CAAV,KAEEvL,MAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EACLrE,GAAG,CAACqE,OAAJ,IAAe;AAHZ,OAAD,CAAN;AAKH,KATH,EAUGuF,KAVH,CAUU5J,GAAD,IAASR,MAAM,CAACQ,GAAD,CAVxB;AAWD,GAZM,CAAP;AAaD,CAdD;;AAgBAhD,MAAM,CAACC,OAAP,GAAiB;AACfiG,YADe;AAEfqE,iBAFe;AAGf0D,uBAHe;AAIftD,sBAJe;AAKfN,eALe;AAMf/D;AANe,CAAjB,C;;;;;;;;;;;AChGA,MAAMiC,IAAI,GAAGpJ,mBAAO,CAAC,4CAAD,CAApB;;AACA,MAAMkP,OAAO,GAAGlP,mBAAO,CAAC,wBAAD,CAAvB;;AACA,MAAMgB,SAAS,GAAGhB,mBAAO,CAAC,oDAAD,CAAP,CAA8BgB,SAAhD;;AAEA,MAAM0K,QAAQ,GAAIyD,OAAD,IAAa;AAC5B,SAAO,IAAIhM,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC+F,QAAI,CAACI,QAAL,CAAc2F,OAAO,CAACnG,SAAtB,EAAiCS,IAAjC,CACGC,KAAD,IAAW;AACT,UAAIA,KAAJ,EAAW;AACTrG,cAAM,CAAC;AACLuF,iBAAO,EAAE,KADJ;AAELV,iBAAO,EAAE;AAFJ,SAAD,CAAN;AAID,OALD,MAKO;AACL;AACAkB,YAAI,CAACsC,QAAL,CACEyD,OAAO,CAACpO,QAAR,GACIoO,OADJ,GAEI,EAAE,GAAGA,OAAL;AAAcpO,kBAAQ,EAAEC,SAAS,CAACU;AAAlC,SAHN,EAIE+H,IAJF,CAKE,CAACS,GAAD,EAAMrG,GAAN,KAAc;AACZ;AACA,cAAI,CAACA,GAAL,EACET,OAAO,CAAC;AACNwF,mBAAO,EAAE,IADH;AAENV,mBAAO,EAAE;AAFH,WAAD,CAAP,CADF,KAME7E,MAAM,CAAC;AACLuF,mBAAO,EAAE,KADJ;AAELV,mBAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAFnB,WAAD,CAAN;AAIH,SAjBH,EAkBGrE,GAAD,IAAS;AACPR,gBAAM,CAAC;AAAEuF,mBAAO,EAAE,KAAX;AAAkBV,mBAAO,EAAErE,GAAG,CAACqE;AAA/B,WAAD,CAAN;AACD,SApBH;AAsBD;AACF,KAhCH,EAiCGrE,GAAD,IAAS;AACPR,YAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EACLrE,GAAG,CAACqE,OAAJ,IAAe;AAHZ,OAAD,CAAN;AAKD,KAvCH;AAyCD,GA1CM,CAAP;AA2CD,CA5CD;;AA8CA,MAAMT,UAAU,GAAG,MAAO0H,OAAP,IAAmB;AACpC,SAAO,IAAIhM,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC+F,QAAI,CAAC3B,UAAL,CAAgB0H,OAAhB,EAAyB1F,IAAzB,CACE,CAACS,GAAD,EAAMrG,GAAN,KAAc;AACZ,UAAI,CAACA,GAAL,EACET,OAAO,CAAC;AACNwF,eAAO,EAAE,IADH;AAENV,eAAO,EAAE;AAFH,OAAD,CAAP,CADF,KAME7E,MAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAFnB,OAAD,CAAN;AAIH,KAZH,EAaGrE,GAAD,IAAS;AACPR,YAAM,CAAC;AAAEuF,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAErE,GAAG,CAACqE;AAA/B,OAAD,CAAN;AACD,KAfH;AAiBD,GAlBM,CAAP;AAmBD,CApBD;;AAsBA,MAAMvB,iBAAiB,GAAG,MAAO5D,KAAP,IAAiB;AACzC,QAAMqM,SAAS,GAAGpM,OAAO,CAACC,GAAR,CAAYoM,gBAA9B;AACA,QAAMC,eAAe,GAAI,0DAAyDF,SAAU,aAAYrM,KAAM,EAA9G;AAEA,SAAO,IAAII,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC6L,WAAO,CAACK,IAAR,CAAaD,eAAb,EAA8B,CAACE,KAAD,EAAQC,IAAR,EAAczH,IAAd,KAAuB;AACnD,UAAIwH,KAAJ,EACEnM,MAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EACL;AAHG,OAAD,CAAN;AAKF,UAAIpG,MAAM,GAAG4N,IAAI,CAACC,KAAL,CAAW3H,IAAX,CAAb;AACA,UAAI,CAAClG,MAAM,CAAC8G,OAAZ,EACEvF,MAAM,CAAC;AAAEuF,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAE;AAA3B,OAAD,CAAN,CADF,KAEK,IAAIpG,MAAM,CAAC8N,KAAP,IAAgB,GAApB,EACHvM,MAAM,CAAC;AACLuF,eAAO,EAAE,KADJ;AAELV,eAAO,EAAE;AAFJ,OAAD,CAAN,CADG,KAKA9E,OAAO,CAAC;AAAEwF,eAAO,EAAE,IAAX;AAAiBV,eAAO,EAAE;AAA1B,OAAD,CAAP;AACN,KAhBD;AAiBD,GAlBM,CAAP;AAmBD,CAvBD;;AAyBA,MAAM2D,oBAAoB,GAAG,MAAOsD,OAAP,IAAmB;AAC9C,QAAM;AAAEpG;AAAF,MAAeoG,OAArB;AACA,SAAO,IAAIhM,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC+F,QAAI,CAACyG,eAAL,CAAqB9G,QAArB,EAA+BU,IAA/B,CACGqG,UAAD,IAAgB;AACd,UAAIC,iBAAiB,GAAGD,UAAU,CAACE,IAAnC;AACAb,aAAO,CAACpG,QAAR,GAAmBgH,iBAAnB;AACArE,cAAQ,CAACyD,OAAD,CAAR,CAAkB1F,IAAlB,CACG3F,MAAD,IAAY;AACVV,eAAO,CAACU,MAAD,CAAP;AACD,OAHH,EAIGD,GAAD,IAAS;AACPR,cAAM,CAACQ,GAAD,CAAN;AACD,OANH;AAQD,KAZH,EAaGA,GAAD,IAAS;AACPR,YAAM,CAAC;AAAEuF,eAAO,EAAE,KAAX;AAAkBV,eAAO,EAAErE,GAAG,CAACqE,OAAJ,IAAe;AAA1C,OAAD,CAAN;AACD,KAfH;AAiBD,GAlBM,CAAP;AAmBD,CArBD;;AAuBA,MAAM8D,aAAa,GAAG,MAAOjL,QAAP,IAAoB;AACxC,MAAI;AACF,WAAO,MAAMqI,IAAI,CAAC6G,IAAL,CAAU;AACrBlP,cAAQ,EAAEA;AADW,KAAV,CAAb;AAGD,GAJD,CAIE,OAAO4E,EAAP,EAAW;AACX,WAAOA,EAAP;AACD;AACF,CARD;;AAUA,MAAMuG,cAAc,GAAG,MAAOnJ,KAAP,IAAiB;AACtC,MAAI;AACF,QAAIoK,OAAO,GAAG,MAAM/D,IAAI,CAAC8D,eAAL,CAAqBnK,KAArB,CAApB;AACA,WAAO,MAAMqG,IAAI,CAAC8G,QAAL,CAAc/C,OAAO,CAACjH,MAAtB,CAAb;AACD,GAHD,CAGE,OAAOP,EAAP,EAAW;AACX,WAAOA,EAAP;AACD;AACF,CAPD;;AASA,MAAM0G,gBAAgB,GAAG,MAAOnG,MAAP,IAAkB;AACzC,MAAI;AACF,QAAIiH,OAAO,GAAG,MAAM/D,IAAI,CAAC+C,WAAL,CAAiBjG,MAAjB,CAApB;AACA,WAAOiH,OAAP;AACD,GAHD,CAGE,OAAOxH,EAAP,EAAW;AACX,UAAMA,EAAN;AACD;AACF,CAPD;;AASA,MAAM6G,iBAAiB,GAAG,OAAOtG,MAAP,EAAeqG,IAAf,KAAwB;AAChD,MAAI;AACF,QAAIY,OAAO,GAAG,MAAM/D,IAAI,CAACkD,WAAL,CAAiBpG,MAAjB,EAAyBqG,IAAzB,CAApB;AACA,WAAOY,OAAP;AACD,GAHD,CAGE,OAAOxH,EAAP,EAAW;AACX,UAAMA,EAAN;AACD;AACF,CAPD;;AASA,MAAM+G,mBAAmB,GAAG,OAAOxG,MAAP,EAAeqG,IAAf,KAAwB;AAClD,MAAI;AACF,QAAIY,OAAO,GAAG,MAAM/D,IAAI,CAACqD,cAAL,CAAoBvG,MAApB,EAA4BqG,IAA5B,CAApB;AACA,WAAOY,OAAP;AACD,GAHD,CAGE,OAAOxH,EAAP,EAAW;AACX,UAAMA,EAAN;AACD;AACF,CAPD;;AASA9E,MAAM,CAACC,OAAP,GAAiB;AACf4K,UADe;AAEf/E,mBAFe;AAGfkF,sBAHe;AAIfG,eAJe;AAKfE,gBALe;AAMfzE,YANe;AAOf4E,kBAPe;AAQfG,mBARe;AASfE;AATe,CAAjB,C;;;;;;;;;;;ACtKA,MAAMtD,IAAI,GAAGpJ,mBAAO,CAAC,4CAAD,CAApB;;AACA,MAAMmQ,WAAW,GAAGnQ,mBAAO,CAAC,gEAAD,CAAP,CAAoCiB,KAAxD;;AAIA,MAAMmP,mBAAmB,GAAG,CAACjP,IAAD,EAAOgM,OAAP,KAAmB;AAC3C,MAAI5C,KAAK,GAAI;AAAEA,SAAK,EAAE,KAAT;AAAgBrC,WAAO,EAAE;AAAzB,GAAb;AACA,MAAG,CAACiF,OAAD,IAAY,CAACA,OAAO,CAACpM,QAAxB,EACI,OAAOwJ,KAAP;AAEJ,QAAM;AAAExJ;AAAF,MAAeoM,OAArB;AACA,MAAIkD,SAAS,GAAGF,WAAW,CAACvC,MAAZ,CAAmB0C,CAAC,IAAI;AACpC,QAAIxC,KAAK,GAAGwC,CAAC,CAAChP,cAAF,CAAiBsM,MAAjB,CAAwBG,CAAC,IAAIA,CAAC,CAACC,WAAF,OAAoBjN,QAAQ,CAACiN,WAAT,EAAjD,CAAZ;AACA,WAAOF,KAAK,CAACG,MAAN,GAAe,CAAf,IAAoBqC,CAAC,CAACnP,IAAF,CAAO6M,WAAP,OAAyB7M,IAAI,CAACoP,iBAAL,EAApD;AAEH,GAJe,CAAhB;AAMA,MAAIF,SAAS,CAACpC,MAAV,GAAmB,CAAvB,EACI1D,KAAK,GAAG;AAAEA,SAAK,EAAE,IAAT;AAAerC,WAAO,EAAE;AAAxB,GAAR;AACJ,SAAOqC,KAAP;AACH,CAfD;;AAkBAzJ,OAAO,CAAC2J,eAAR,GAA0B,CAACtJ,IAAD,EAAOqP,GAAP,KAAe;AACrC,SAAO,IAAIrN,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,QAAIyB,IAAI,GAAGsE,IAAX;AACA,QAAIkB,OAAO,GAAGxF,IAAI,CAACuF,YAAL,CAAkBmG,GAAlB,CAAd;AACAlG,WAAO,CAACb,IAAR,CAAa3B,GAAG,IAAI;AAChB,UAAImF,UAAU,GAAGnI,IAAI,CAACoI,eAAL,CAAqBsD,GAArB,CAAjB;AACAvD,gBAAU,CAACxD,IAAX,CAAgB0D,OAAO,IAAI;AACvB,YAAI5C,KAAK,GAAG6F,mBAAmB,CAACjP,IAAD,EAAOgM,OAAP,CAA/B;AACA,YAAI5C,KAAK,CAACA,KAAV,EACInH,OAAO,CAACmH,KAAD,CAAP,CADJ,KAGIlH,MAAM,CAACkH,KAAD,CAAN;AACP,OAND,EAMG4D,IAAI,IAAI;AACP9K,cAAM,CAAC;AAAEkH,eAAK,EAAE,KAAT;AAAgBrC,iBAAO,EAAE;AAAzB,SAAD,CAAN;AACH,OARD;AASH,KAXD,EAWGrE,GAAG,IAAI;AACNR,YAAM,CAAC;AAAEkH,aAAK,EAAE,KAAT;AAAgBrC,eAAO,EAAE;AAAzB,OAAD,CAAN;AACH,KAbD;AAcH,GAjBM,CAAP;AAkBH,CAnBD,C;;;;;;;;;;;ACvBA,MAAM2E,IAAI,GAAG7M,mBAAO,CAAC,0CAAD,CAApB;;AAEA,MAAMyQ,eAAe,GAAG,CAACpD,OAAD,EAAUtK,KAAV,KAAoB;AAC1C,SAAO,IAAII,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,QAAIqN,IAAI,GAAG,IAAI7D,IAAJ,EAAX;AACA6D,QAAI,CAAClD,kBAAL,CAAwBH,OAAxB,EAAiCtK,KAAjC,EAAwC0G,IAAxC,CACG3B,GAAD,IAAS;AACP1E,aAAO,CAAC0E,GAAD,CAAP;AACD,KAHH,EAIGjE,GAAD,IACER,MAAM,CAAC;AACLkH,WAAK,EAAE,KADF;AAELrC,aAAO,EAAErE,GAAG,CAACqE,OAAJ,GAAcrE,GAAG,CAACqE,OAAlB,GAA6B,UAASwH,IAAI,CAACiB,SAAL,CAAe9M,GAAf,CAAoB;AAF9D,KAAD,CALV;AAUD,GAZM,CAAP;AAaD,CAdD;;AAgBA/C,OAAO,CAAC8P,YAAR,GAAuB,CAAC/I,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACzCjC,SAAO,CAACC,GAAR,CAAa,6CAAb,EADyC,CAEzC;;AACA,MAAIsH,OAAO,GAAGxF,GAAG,CAACgJ,OAAlB;AAAA,MACE9N,KAAK,GAAG8E,GAAG,CAACQ,OAAJ,CAAY,eAAZ,CADV;AAGAoI,iBAAe,CAACpD,OAAD,EAAUtK,KAAV,CAAf,CAAgC0G,IAAhC,CACG3F,MAAD,IAAY;AACV,QAAIA,MAAM,CAACyG,KAAX,EAAkBxC,IAAI,GAAtB,KAEED,GAAG,CACAhG,MADH,CACU,KADV,EAEGlB,IAFH,CAEQ;AAAEgI,aAAO,EAAE,KAAX;AAAkB4G,WAAK,EAAE;AAAzB,KAFR;AAGH,GAPH,EAQG3L,GAAD,IACEiE,GAAG,CAAChG,MAAJ,CAAW,KAAX,EAAkBlB,IAAlB,CAAuB;AACrBgI,WAAO,EAAE,KADY;AAErB4G,SAAK,EAAE3L,GAAG,CAACqE,OAAJ,IAAe;AAFD,GAAvB,CATJ;AAcD,CApBD,C;;;;;;;;;;;AClBA,MAAM4I,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB;;AACA,MAAM+Q,IAAI,GAAG/Q,mBAAO,CAAC,oCAAD,CAApB;;AACA,MAAMgR,IAAI,GAAGhR,mBAAO,CAAC,oCAAD,CAApB;;AACA,MAAMoJ,IAAI,GAAGpJ,mBAAO,CAAC,oCAAD,CAApB;;AACA,MAAMoO,UAAU,GAAGpO,mBAAO,CAAC,gDAAD,CAA1B;;AAGA,MAAMiR,MAAM,GAAG;AAAEF,MAAF;AAAQC,MAAR;AAAc5H,MAAd;AAAoBgF;AAApB,CAAf;;AAEA,MAAM9N,SAAS,GAAG,MAAM;AACpB;AACA,MAAI4Q,KAAK,GAAGJ,QAAQ,CAACK,OAAT,CAAiBnO,OAAO,CAACC,GAAR,CAAYmO,aAA7B,EAA4C;AACpDC,mBAAe,EAAE;AADmC,GAA5C,CAAZ;AAIAP,UAAQ,CAACQ,UAAT,CAAoBC,EAApB,CAAuB,OAAvB,EAAgCzL,OAAO,CAAC0J,KAAR,CAAcgC,IAAd,CAAmB1L,OAAnB,EAA4B,6BAA5B,CAAhC;AACA,SAAOoL,KAAP;AACH,CARD;;AAWArQ,MAAM,CAACC,OAAP,GAAiB;AAAER,WAAF;AAAa2Q;AAAb,CAAjB,C;;;;;;;;;;;ACpBA,MAAMnG,MAAM,GAAG9K,mBAAO,CAAC,sBAAD,CAAtB;;AACA,MAAM8Q,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB,C,CACA;;;AAEA,MAAMyR,UAAU,GAAG,IAAIX,QAAQ,CAACY,MAAb,CAAoB;AACnCxQ,MAAI,EAAE;AACFyQ,QAAI,EAAEC,MADJ;AAEFC,YAAQ,EAAE;AAFR,GAD6B;AAKnCC,MAAI,EAAE;AACFH,QAAI,EAAEC,MADJ;AAEFC,YAAQ,EAAE;AAFR,GAL6B;AASnCE,UAAQ,EAAE;AACNJ,QAAI,EAAEb,QAAQ,CAACY,MAAT,CAAgBM,KAAhB,CAAsBC,QADtB;AAENC,OAAG,EAAE;AAFC,GATyB;AAanCC,UAAQ,EAAE;AACNR,QAAI,EAAES,MADA;AAENC,WAAO,EAAE;AAFH,GAbyB;AAiBnCjR,MAAI,EAAE;AACFuQ,QAAI,EAAEC;AADJ,GAjB6B;AAoBnCvQ,SAAO,EAAE;AACLsQ,QAAI,EAAEW,OADD;AAELD,WAAO,EAAE;AAFJ,GApB0B;AAwBnCpL,QAAM,EAAE;AACJ0K,QAAI,EAAEW,OADF;AAEJD,WAAO,EAAE;AAFL,GAxB2B;AA4BnCV,MAAI,EAAE;AACFA,QAAI,EAAEC;AADJ,GA5B6B;AA+BnCvG,WAAS,EAAE;AACPsG,QAAI,EAAEY,IADC;AAEPF,WAAO,EAAEvH,MAAM,CAACQ,GAAP;AAFF;AA/BwB,CAApB,CAAnB;AAsCAmG,UAAU,CAACe,OAAX,GAAqB;AACjBC,aAAW,EAAE,UAAUC,MAAV,EAAkB;AAAE;AAC7B,WAAO,KAAKC,OAAL,CAAa;AAChBjL,SAAG,EAAEgL,MADW,CACJ;AACZ;;AAFgB,KAAb,CAAP;AAIH,GANgB;AAOjBE,YAAU,EAAE,UAAUC,OAAV,EAAmB;AAC3B,WAAO,KAAKC,MAAL,CAAY;AACfpL,SAAG,EAAEmL,OAAO,CAACnL;AADE,KAAZ,EAEJ;AACKqL,UAAI,EAAE;AACF,gBAAQF,OAAO,CAAC3R,IADd;AAEF,gBAAQ2R,OAAO,CAACf,IAFd;AAGF,oBAAYe,OAAO,CAACd,QAHlB;AAIF,oBAAYc,OAAO,CAACV,QAJlB;AAKF,gBAAQU,OAAO,CAACV,QALd;AAMF,mBAAWU,OAAO,CAACxR,OANjB;AAOF,kBAAUwR,OAAO,CAAC5L,MAPhB;AAQF,gBAAQ4L,OAAO,CAAC5L,MARd;AASF,qBAAa6D,MAAM,CAACQ,GAAP;AATX;AADX,KAFI,CAAP;AAeH,GAvBgB;AAwBjB0H,YAAU,EAAE,UAAUN,MAAV,EAAkB;AAC1B,WAAO,KAAKO,UAAL,CAAgB;AACnBvL,SAAG,EAAEgL;AADc,KAAhB,CAAP;AAGH,GA5BgB;AA6BjBQ,eAAa,EAAE,UAAUR,MAAV,EAAkB;AAC7B,WAAO,KAAKzC,IAAL,CAAU;AACb8B,cAAQ,EAAEW;AADG,KAAV,CAAP;AAGH,GAjCgB;AAkCjBS,0BAAwB,EAAE,UAAUC,OAAV,EAAmB;AACzC,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAIC,kBAAkB,GAAG,KAAKJ,aAAL,CAAmBE,OAAnB,CAAzB;AACA,QAAIG,QAAQ,GAAG,EAAf;AACA,WAAO,IAAIpQ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpCiQ,wBAAkB,CAAC7J,IAAnB,CAAyB+J,MAAD,IAAY;AAChC,YAAIA,MAAM,CAACvF,MAAP,GAAgB,CAApB,EAAuB;AACnBsF,kBAAQ,GAAG7D,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACiB,SAAL,CAAe6C,MAAf,CAAX,EAAmCpM,GAAnC,CAAwCqM,KAAD,IAAW;AACzD,mBAAOA,KAAK,CAAC/L,GAAb;AACH,WAFU,CAAX;;AAGA,cAAIgM,cAAc,GAAGL,KAAK,CAACF,wBAAN,CAA+BI,QAA/B,CAArB;;AACAG,wBAAc,CAACjK,IAAf,CAAqB3F,MAAD,IAAY;AAC5BV,mBAAO,CAACmQ,QAAQ,CAACI,MAAT,CAAgB7P,MAAhB,CAAD,CAAP;AACH,WAFD;AAGH,SARD,MASIV,OAAO,CAACmQ,QAAD,CAAP;AACP,OAXD,EAWI1P,GAAD,IAAS;AACRR,cAAM,CAACQ,GAAD,CAAN;AACH,OAbD;AAcH,KAfM,CAAP;AAgBH,GAtDgB;AAuDjB+P,2BAAyB,EAAE,UAAUlB,MAAV,EAAkB;AACzC,QAAIW,KAAK,GAAG,IAAZ;;AACA,QAAIQ,YAAY,GAAG,KAAKpB,WAAL,CAAiBC,MAAjB,CAAnB;AACA,QAAIa,QAAQ,GAAG,EAAf;AACA,WAAO,IAAIpQ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpCwQ,kBAAY,CAACpK,IAAb,CAAmBoE,IAAD,IAAU;AACxBA,YAAI,GAAG6B,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACiB,SAAL,CAAe9C,IAAf,CAAX,CAAP;;AACA,YAAIA,IAAI,IAAIA,IAAI,CAACkE,QAAjB,EAA2B;AACvBwB,kBAAQ,CAAC5O,IAAT,CAAckJ,IAAI,CAACkE,QAAnB;;AACA,cAAI+B,cAAc,GAAGT,KAAK,CAACO,yBAAN,CAAgC/F,IAAI,CAACkE,QAArC,CAArB;;AACA+B,wBAAc,CAACrK,IAAf,CAAqB3F,MAAD,IAChBV,OAAO,CAACmQ,QAAQ,CAACI,MAAT,CAAgB7P,MAAhB,CAAD,CADX;AAEH,SALD,MAMIV,OAAO,CAACmQ,QAAD,CAAP;AACP,OATD,EASG1P,GAAG,IAAIR,MAAM,CAACQ,GAAD,CAThB;AAUH,KAXM,CAAP;AAYH,GAvEgB;AAwEjBkQ,UAAQ,EAAE,UAAU9S,KAAV,EAAiB;AACvB,WAAO,KAAKgP,IAAL,CAAU;AAAEvI,SAAG,EAAEzG;AAAP,KAAV,CAAP;AACH;AA1EgB,CAArB;AAgFA,MAAM8P,IAAI,GAAGD,QAAQ,CAACkD,KAAT,CAAe,MAAf,EAAuBvC,UAAvB,CAAb;AAEA5Q,MAAM,CAACC,OAAP,GAAiBiQ,IAAjB,C;;;;;;;;;;;AC5HA,MAAMD,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB;;AAEA,MAAMiU,gBAAgB,GAAG,IAAInD,QAAQ,CAACY,MAAb,CAAoB;AACzCwC,UAAQ,EAAE;AACNvC,QAAI,EAAEC;AADA,GAD+B;AAIzCuC,UAAQ,EAAE;AACNxC,QAAI,EAAEC;AADA,GAJ+B;AAOzCwC,eAAa,EAAE;AACXzC,QAAI,EAAEC;AADK,GAP0B;AAUzCyC,SAAO,EAAE;AACL1C,QAAI,EAAEC;AADD,GAVgC;AAazC0C,UAAQ,EAAE;AACN3C,QAAI,EAAEC;AADA,GAb+B;AAgBzC2C,UAAQ,EAAE;AACN5C,QAAI,EAAEC;AADA,GAhB+B;AAmBzC4C,MAAI,EAAE;AACF7C,QAAI,EAAEC;AADJ,GAnBmC;AAsBzC6C,UAAQ,EAAE;AACN9C,QAAI,EAAEC;AADA,GAtB+B;AAyBzC8C,WAAS,EAAE;AACP/C,QAAI,EAAEC;AADC,GAzB8B;AA4BzC+C,MAAI,EAAE;AACFhD,QAAI,EAAEC;AADJ,GA5BmC;AA+BzCgD,eAAa,EAAE;AACXjD,QAAI,EAAEC;AADK,GA/B0B;AAkCzCiD,SAAO,EAAE;AACLlD,QAAI,EAAEC;AADD,GAlCgC;AAqCzCkD,kBAAgB,EAAE;AACdnD,QAAI,EAAEC;AADQ,GArCuB;AAwCzCmD,QAAM,EAAE;AACJpD,QAAI,EAAEC;AADF,GAxCiC;AA2CzCoD,cAAY,EAAE;AACVrD,QAAI,EAAEC;AADI;AA3C2B,CAApB,CAAzB;AAgDAqC,gBAAgB,CAACzB,OAAjB,GAA2B;AACvBhK,WAAS,EAAE,UAAU8F,EAAV,EAAc;AACrB,QAAI2G,KAAK,GAAG,IAAIC,MAAJ,CAAW5G,EAAX,CAAZ;AACA,WAAO,KAAK2B,IAAL,CAAU;AAAEiE,cAAQ,EAAEe;AAAZ,KAAV,EAA+BE,KAA/B,CAAqC,GAArC,CAAP;AACH;AAJsB,CAA3B;AAOA,MAAM/G,UAAU,GAAG0C,QAAQ,CAACkD,KAAT,CAAe,YAAf,EAA6BC,gBAA7B,CAAnB;AAEApT,MAAM,CAACC,OAAP,GAAiBsN,UAAjB,C;;;;;;;;;;;AC3DA,MAAMtD,MAAM,GAAG9K,mBAAO,CAAC,sBAAD,CAAtB;;AACA,MAAM8Q,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB;;AAEA,MAAMoV,UAAU,GAAG,IAAItE,QAAQ,CAACY,MAAb,CAAoB;AACnCxQ,MAAI,EAAE;AACFyQ,QAAI,EAAEC,MADJ;AAEFC,YAAQ,EAAE;AAFR,GAD6B;AAKnC9P,aAAW,EAAE;AACT4P,QAAI,EAAEC,MADG;AAETC,YAAQ,EAAE;AAFD,GALsB;AASnCwD,oBAAkB,EAAE;AAChB1D,QAAI,EAAEW,OADU;AAEhBD,WAAO,EAAE;AAFO,GATe;AAanCiD,kBAAgB,EAAE;AACd3D,QAAI,EAAEW,OADQ;AAEdD,WAAO,EAAE;AAFK,GAbiB;AAiBnCpL,QAAM,EAAE;AACJ0K,QAAI,EAAEW,OADF;AAEJD,WAAO,EAAE;AAFL,GAjB2B;AAqBnCpR,OAAK,EAAE,CAAC;AACJ0Q,QAAI,EAAEb,QAAQ,CAACY,MAAT,CAAgBM,KAAhB,CAAsBC,QADxB;AAEJC,OAAG,EAAE;AAFD,GAAD,CArB4B;AAyBnC7G,WAAS,EAAE;AACPsG,QAAI,EAAEY,IADC;AAEPF,WAAO,EAAEvH,MAAM,CAACQ,GAAP;AAFF;AAzBwB,CAApB,CAAnB;AA+BA8J,UAAU,CAAC5C,OAAX,GAAqB;AACjB+C,YAAU,EAAE,UAAUC,MAAV,EAAkB;AAC1B,WAAO,KAAKvC,UAAL,CAAgB;AACnBvL,SAAG,EAAE8N;AADc,KAAhB,CAAP;AAGH,GALgB;AAMjBC,aAAW,EAAE,UAAUD,MAAV,EAAkBvU,KAAlB,EAAyB;AAClC,QAAI,CAACyU,KAAK,CAACC,OAAN,CAAc1U,KAAd,CAAL,EAA2BA,KAAK,GAAG,CAACA,KAAD,CAAR;AAC3B,WAAO,KAAK6R,MAAL,CAAY;AACfpL,SAAG,EAAE8N;AADU,KAAZ,EAEJ;AACKI,eAAS,EAAE;AACP3U,aAAK,EAAE;AACH4U,eAAK,EAAE5U;AADJ;AADA;AADhB,KAFI,EAQA;AACC6U,WAAK,EAAE;AADR,KARA,CAAP;AAWH,GAnBgB;AAoBjBC,gBAAc,EAAE,UAAUC,KAAV,EAAiB/U,KAAjB,EAAwB;AACpC,QAAI,CAACyU,KAAK,CAACC,OAAN,CAAc1U,KAAd,CAAL,EAA2BA,KAAK,GAAG,CAACA,KAAD,CAAR;AAC3B,QAAI,CAACyU,KAAK,CAACC,OAAN,CAAcK,KAAd,CAAL,EAA2BA,KAAK,GAAG,CAACA,KAAD,CAAR;AAE3B,WAAO,KAAKlD,MAAL,CAAY;AACfpL,SAAG,EAAE;AACDuO,WAAG,EAAED;AADJ;AADU,KAAZ,EAIJ;AACKE,cAAQ,EAAE;AACNjV,aAAK,EAAEA;AADD;AADf,KAJI,EAQA;AACC6U,WAAK,EAAE;AADR,KARA,CAAP;AAWH,GAnCgB;AAoCjBK,cAAY,EAAE,UAAUX,MAAV,EAAkB;AAC5B,WAAO,IAAIrS,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,WAAK4M,IAAL,CAAU;AACNvI,WAAG,EAAE8N;AADC,OAAV,EAEGY,QAFH,CAEY,OAFZ,EAEqBC,IAFrB,CAE0B,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AACvC,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACU,MAAD,CAAP;AACH,OALD;AAMH,KAPM,CAAP;AAQH;AA7CgB,CAArB;AAgDA,MAAMkN,IAAI,GAAGF,QAAQ,CAACkD,KAAT,CAAe,MAAf,EAAuBoB,UAAvB,CAAb;AAEAvU,MAAM,CAACC,OAAP,GAAiBkQ,IAAjB,C;;;;;;;;;;;ACpFA,MAAMF,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB;;AACA,MAAM8K,MAAM,GAAG9K,mBAAO,CAAC,sBAAD,CAAtB;;AAEA,MAAMsW,WAAW,GAAG,IAAIxF,QAAQ,CAACY,MAAb,CAAoB;AACtCxQ,MAAI,EAAE;AACJyQ,QAAI,EAAEC;AADF,GADgC;AAItC2E,SAAO,EAAE;AACP5E,QAAI,EAAEC;AADC,GAJ6B;AAOtCrM,SAAO,EAAE;AACPoM,QAAI,EAAEC;AADC,GAP6B;AAUtC4E,WAAS,EAAE;AACT7E,QAAI,EAAEW,OADG;AAETD,WAAO,EAAE;AAFA,GAV2B;AActCoE,QAAM,EAAE;AACN9E,QAAI,EAAEC;AADA,GAd8B;AAiBtC8E,uBAAqB,EAAE;AACrB/E,QAAI,EAAEC;AADe,GAjBe;AAoBtC3K,QAAM,EAAE;AACN0K,QAAI,EAAEW,OADA;AAEND,WAAO,EAAE;AAFH,GApB8B;AAwBtCsE,UAAQ,EAAE;AACRhF,QAAI,EAAEY;AADE,GAxB4B;AA2BtCqE,SAAO,EAAE;AACPjF,QAAI,EAAEY;AADC,GA3B6B;AA8BtClH,WAAS,EAAE;AACTsG,QAAI,EAAEY,IADG;AAETF,WAAO,EAAEvH,MAAM,CAACQ,GAAP;AAFA;AA9B2B,CAApB,CAApB;AAoCAzK,MAAM,CAACC,OAAP,GAAiBwV,WAAjB,C;;;;;;;;;;;ACvCA,MAAMxF,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB;;AACA,MAAM8K,MAAM,GAAG9K,mBAAO,CAAC,sBAAD,CAAtB;;AAEA,MAAM6W,gBAAgB,GAAG,IAAI/F,QAAQ,CAACY,MAAb,CAAoB;AAC3CpK,UAAQ,EAAE;AACRqK,QAAI,EAAEC;AADE,GADiC;AAI3CrP,cAAY,EAAE;AACZoP,QAAI,EAAEC;AADM,GAJ6B;AAO3CrK,YAAU,EAAE;AACVoK,QAAI,EAAEC;AADI,GAP+B;AAU3CpK,UAAQ,EAAE;AACRmK,QAAI,EAAEC;AADE,GAViC;AAa3CvG,WAAS,EAAE;AACTsG,QAAI,EAAEY,IADG;AAETF,WAAO,EAAEvH,MAAM,CAACQ,GAAP;AAFA;AAbgC,CAApB,CAAzB;AAmBAzK,MAAM,CAACC,OAAP,GAAiB+V,gBAAjB,C;;;;;;;;;;;ACtBA,MAAM/F,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB;;AACA,MAAM8K,MAAM,GAAG9K,mBAAO,CAAC,sBAAD,CAAtB;;AAEA,MAAM8W,kBAAkB,GAAG,IAAIhG,QAAQ,CAACY,MAAb,CAAoB;AAC7C5P,QAAM,EAAE;AACN6P,QAAI,EAAEC;AADA,GADqC;AAI7C7P,aAAW,EAAE;AACX4P,QAAI,EAAEC;AADK,GAJgC;AAO7C3G,SAAO,EAAE;AACP0G,QAAI,EAAEC;AADC,GAPoC;AAU7CvG,WAAS,EAAE;AACTsG,QAAI,EAAEY,IADG;AAETF,WAAO,EAAEvH,MAAM,CAACQ,GAAP;AAFA;AAVkC,CAApB,CAA3B,C,CAgBA;;AAEAzK,MAAM,CAACC,OAAP,GAAiBgW,kBAAjB,C;;;;;;;;;;;ACrBA,MAAMhG,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB;;AACA,MAAM8K,MAAM,GAAG9K,mBAAO,CAAC,sBAAD,CAAtB;;AACA,MAAM8W,kBAAkB,GAAG9W,mBAAO,CAAC,gFAAD,CAAlC;;AACA,MAAM6W,gBAAgB,GAAG7W,mBAAO,CAAC,4EAAD,CAAhC;;AAEA,MAAM+W,YAAY,GAAG,IAAIjG,QAAQ,CAACY,MAAb,CAAoB;AACvCxQ,MAAI,EAAE;AACJyQ,QAAI,EAAEC;AADF,GADiC;AAIvC5K,UAAQ,EAAE;AACR2K,QAAI,EAAEC;AADE,GAJ6B;AAOvCtL,YAAU,EAAE;AACVqL,QAAI,EAAES;AADI,GAP2B;AAUvCnL,QAAM,EAAE;AACN0K,QAAI,EAAEW;AADA,GAV+B;AAavCjH,WAAS,EAAE;AACTsG,QAAI,EAAEY,IADG;AAETF,WAAO,EAAEvH,MAAM,CAACQ,GAAP;AAFA,GAb4B;AAiBvCpE,YAAU,EAAE,CACV;AACEyK,QAAI,EAAEb,QAAQ,CAACY,MAAT,CAAgBM,KAAhB,CAAsBC,QAD9B;AAEEC,OAAG,EAAE;AAFP,GADU,CAjB2B;;AAuBvC;;;;;;;AAOApQ,QAAM,EAAE,CAACgV,kBAAD,CA9B+B;AA+BvCtS,OAAK,EAAE,CAACqS,gBAAD;AA/BgC,CAApB,CAArB;AAkCAE,YAAY,CAACvE,OAAb,GAAuB;AACrB7D,YAAU,EAAE,UAAUD,SAAV,EAAqB;AAC/B,QAAI3J,MAAM,GAAG,IAAI,IAAJ,CAAS2J,SAAT,CAAb;AACA,WAAO3J,MAAM,CAACiS,IAAP,EAAP;AACD,GAJoB;AAKrBnI,cAAY,EAAE,UAAUlH,EAAV,EAAc7F,MAAd,EAAsB;AAClC,QAAI,CAAC4T,KAAK,CAACC,OAAN,CAAc7T,MAAd,CAAL,EAA4BA,MAAM,GAAG,CAACA,MAAD,CAAT;AAC5B,WAAO,KAAKmV,SAAL,CACL;AAAEvP,SAAG,EAAEC;AAAP,KADK,EAEL;AACEiO,eAAS,EAAE;AACT9T,cAAM,EAAE;AACN+T,eAAK,EAAE/T;AADD;AADC;AADb,KAFK,EASL;AACEgU,WAAK,EAAE;AADT,KATK,CAAP;AAaD,GApBoB;AAqBrB/G,oBAAkB,EAAE,UAAU7N,IAAV,EAAgBoF,UAAhB,EAA4B;AAC9C,QAAI,CAACoP,KAAK,CAACC,OAAN,CAAc7T,MAAd,CAAL,EAA4BA,MAAM,GAAG,CAACA,MAAD,CAAT;AAC5B,WAAO,KAAKmV,SAAL,CACL;AAAE/V,UAAI,EAAEA,IAAR;AAAcoF,gBAAU,EAAEA;AAA1B,KADK,EAEL;AACEsP,eAAS,EAAE;AACT9T,cAAM,EAAE;AACN+T,eAAK,EAAE/T;AADD;AADC;AADb,KAFK,EASL;AACEgU,WAAK,EAAE;AADT,KATK,CAAP;AAaD,GApCoB;AAqCrB7G,WAAS,EAAE,UAAUtH,EAAV,EAAc;AACvB,WAAO,IAAIxE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AACXjL,WAAG,EAAEC;AADM,OAAb,EAGGyO,QAHH,CAGY,YAHZ,EAG0B,MAH1B,EAIGC,IAJH,CAIQ,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AACrB,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACU,MAAD,CAAP;AACD,OAPH;AAQD,KATM,CAAP;AAUD,GAhDoB;AAiDrBoT,iBAAe,EAAE,UAAU5Q,UAAV,EAAsBpF,IAAtB,EAA4B;AAC3C,WAAO,IAAIiC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AACXrM,kBAAU,EAAEA,UADD;AAEXpF,YAAI,EAAEA;AAFK,OAAb,EAGGmV,IAHH,CAGQ,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AACvB,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACU,MAAD,CAAP;AACD,OAND;AAOD,KARM,CAAP;AASD,GA3DoB;AA4DrBkL,mBAAiB,EAAE,UAAU9I,MAAV,EAAkB;AACnC,WAAO,IAAI/C,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AAAEzL,kBAAU,EAAE4J,QAAQ,CAACkB,KAAT,CAAeC,QAAf,CAAwB/L,MAAxB;AAAd,OAAb,EAA8DmQ,IAA9D,CACE,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AACf,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACU,MAAD,CAAP;AACD,OAJH;AAMD,KAPM,CAAP;AAQD;AArEoB,CAAvB;AAwEA,MAAMyK,MAAM,GAAGuC,QAAQ,CAACkD,KAAT,CAAe,QAAf,EAAyB+C,YAAzB,CAAf;AAEAlW,MAAM,CAACC,OAAP,GAAiByN,MAAjB,C;;;;;;;;;;;ACjHA,MAAMzD,MAAM,GAAG9K,mBAAO,CAAC,sBAAD,CAAtB;;AACA,MAAMmX,MAAM,GAAGnX,mBAAO,CAAC,0BAAD,CAAtB;;AACA,MAAMwQ,GAAG,GAAGxQ,mBAAO,CAAC,kCAAD,CAAnB;;AACA,MAAM8Q,QAAQ,GAAG9Q,mBAAO,CAAC,0BAAD,CAAxB;;AACA,MAAMoX,MAAM,GAAGpX,mBAAO,CAAC,wBAAD,CAAtB;;AACA,MAAMsW,WAAW,GAAGtW,mBAAO,CAAC,kEAAD,CAA3B;;AAEA,MAAMqX,UAAU,GAAG,IAAIvG,QAAQ,CAACY,MAAb,CAAoB;AACrCxQ,MAAI,EAAE;AACJyQ,QAAI,EAAEC,MADF;AAEJC,YAAQ,EAAE;AAFN,GAD+B;AAKrC1L,UAAQ,EAAE;AACRwL,QAAI,EAAEC;AADE,GAL2B;AAQrC7I,UAAQ,EAAE;AACR4I,QAAI,EAAEC;AADE,GAR2B;AAWrC5I,WAAS,EAAE;AACT2I,QAAI,EAAEC,MADG;AAET0F,UAAM,EAAE;AAFC,GAX0B;AAerCjR,OAAK,EAAE;AACLsL,QAAI,EAAEC;AADD,GAf8B;AAkBrCxL,WAAS,EAAE;AACTuL,QAAI,EAAEC;AADG,GAlB0B;AAqBrC7M,QAAM,EAAE;AACN4M,QAAI,EAAEC;AADA,GArB6B;AAwBrC2F,eAAa,EAAE;AACb5F,QAAI,EAAES,MADO;AAEbC,WAAO,EAAE;AAFI,GAxBsB;AA4BrCmF,mBAAiB,EAAE;AACjB7F,QAAI,EAAEW,OADW;AAEjBD,WAAO,EAAE;AAFQ,GA5BkB;AAgCrCoF,eAAa,EAAE;AACb9F,QAAI,EAAEY;AADO,GAhCsB;AAmCrCmF,YAAU,EAAE;AACV/F,QAAI,EAAEY,IADI;AAEVF,WAAO,EAAEvH,MAAM,CAACQ,GAAP;AAFC,GAnCyB;;AAuCrC;;;;;;;AAOAvK,UAAQ,EAAE;AACR4Q,QAAI,EAAEC,MADE;AAERS,WAAO,EAAE;AAFD,GA9C2B;AAkDrC1G,eAAa,EAAE;AACbgG,QAAI,EAAEW;AADO,GAlDsB;AAqDrCzJ,YAAU,EAAE;AACV8I,QAAI,EAAEC;AADI,GArDyB;AAwDrC9I,UAAQ,EAAE;AACR6I,QAAI,EAAEC;AADE,GAxD2B;AA2DrC3K,QAAM,EAAE;AACN0K,QAAI,EAAEW,OADA;AAEND,WAAO,EAAE;AAFH,GA3D6B;AA+DrChH,WAAS,EAAE;AACTsG,QAAI,EAAEY,IADG;AAETF,WAAO,EAAEvH,MAAM,CAACQ,GAAP;AAFA,GA/D0B;AAmErC0K,OAAK,EAAE,CACL;AACErE,QAAI,EAAEb,QAAQ,CAACY,MAAT,CAAgBM,KAAhB,CAAsBC,QAD9B;AAEEC,OAAG,EAAE;AAFP,GADK,CAnE8B;AAyErCnN,QAAM,EAAE;AACN4M,QAAI,EAAEb,QAAQ,CAACY,MAAT,CAAgBM,KAAhB,CAAsBC,QADtB;AAENC,OAAG,EAAE;AAFC,GAzE6B;AA6ErCyF,WAAS,EAAE,CAACrB,WAAD;AA7E0B,CAApB,CAAnB;AAgFA;;;;AAGA,MAAMsB,UAAU,GAAG5U,OAAO,CAACC,GAAR,CAAY4U,UAA/B;;AAEA,IAAIC,WAAW,GAAG,MAAM;AACtB,MAAIC,YAAY,GACd/U,OAAO,CAACC,GAAR,CAAY+U,QAAZ,IAAwB,IAAxB,GAA+BhV,OAAO,CAACC,GAAR,CAAY+U,QAA3C,GAAsD,KADxD;AAEA,SAAOlN,MAAM,GAAGmN,GAAT,CAAaF,YAAb,EAA2B,SAA3B,EAAsCG,OAAtC,EAAP;AACD,CAJD;;AAMA,IAAIC,aAAa,GAAIxQ,EAAD,IAAQ;AAC1B;AACA,SAAO,EAAP;AACD,CAHD;;AAKA,IAAIyQ,cAAc,GAAIzQ,EAAD,IAAQ;AAC3B;AACA,SAAO,EAAP;AACD,CAHD;AAKA;;;;;;AAIA,IAAI0Q,gBAAgB,GAAG,UAAUC,OAAV,EAAmB;AACxC,MAAIC,WAAW,GAAGzN,MAAM,GAAGoN,OAAT,EAAlB;AACA,SAAOI,OAAO,GAAGC,WAAjB;AACD,CAHD;;AAKAlB,UAAU,CAACmB,OAAX,GAAqB;AACnB5O,kBAAgB,EAAE,UAAU6O,SAAV,EAAqB;AACrC,QAAIpF,KAAK,GAAG,IAAZ;;AACA,QAAIqF,IAAI,GAAGtB,MAAM,CAACuB,MAAP,CAAcF,SAAd,CAAX;AACA,WAAO,IAAItV,OAAJ,CACL,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACnB,UAAIgQ,KAAK,CAACmE,iBAAV,EAA6B;AAC3B,YAAIoB,IAAI,GAAG,KAAK,KAAKC,gBAAL,EAAhB;AACA,YAAID,IAAI,GAAG,CAAX,EACEvV,MAAM,CAAC;AACLuF,iBAAO,EAAE,KADJ;AAELV,iBAAO,EAAG,gEAA+D0Q,IAAK;AAFzE,SAAD,CAAN,CADF,KAME,KAAKE,qBAAL,CAA2B,IAA3B,EAAiCrP,IAAjC,CAAuC3B,GAAD,IAAS;AAC7C,eAAK8B,gBAAL,CAAsB6O,SAAtB,EAAiChP,IAAjC,CACG3F,MAAD,IAAYV,OAAO,CAACU,MAAD,CADrB,EAEGD,GAAD,IAASR,MAAM,CAACQ,GAAD,CAFjB;AAID,SALD;AAMH,OAdD,MAeEsT,MAAM,CAAC4B,OAAP,CAAeL,IAAf,EAAqBrF,KAAK,CAACtK,QAA3B,EAAqCU,IAArC,CAA2Cc,KAAD,IAAW;AACnD,YAAIA,KAAJ,EAAW;AACT;AACA,eAAKuO,qBAAL,CAA2B,IAA3B,EAAiCrP,IAAjC,CACG3B,GAAD,IAAS;AACP1E,mBAAO,CAAC;AACNwF,qBAAO,EAAE,IADH;AAENV,qBAAO,EAAE;AAFH,aAAD,CAAP;AAID,WANH,EAOGrE,GAAD,IACER,MAAM,CAAC;AAAEuF,mBAAO,EAAE,KAAX;AAAkBV,mBAAO,EAAE;AAA3B,WAAD,CARV;AAUD,SAZD,MAYO;AACL;AACA,eAAK4Q,qBAAL,GAA6BrP,IAA7B,CACG3B,GAAD,IAAS;AACPzE,kBAAM,CAAC;AACLuF,qBAAO,EAAE,KADJ;AAELV,qBAAO,EAAE;AAFJ,aAAD,CAAN;AAID,WANH,EAOGrE,GAAD,IACER,MAAM,CAAC;AACLuF,mBAAO,EAAE,KADJ;AAELV,mBAAO,EAAE;AAFJ,WAAD,CARV;AAaD;AACF,OA7BD;AA8BH,KA/CI,EAgDJrE,GAAD,IACER,MAAM,CAAC;AACLuF,aAAO,EAAE,KADJ;AAELV,aAAO,EAAE;AAFJ,KAAD,CAjDH,CAAP;AAsDD,GA1DkB;AA2DnB2Q,kBAAgB,EAAE,YAAY;AAC5B,QAAIpB,aAAa,GAAG,KAAKA,aAAL,GAAqB,KAAKA,aAA1B,GAA0C3M,MAAM,CAACQ,GAAP,EAA9D;AACA,QAAI0N,KAAK,GAAGlO,MAAM,CAAC2M,aAAD,CAAlB;AACA,QAAIwB,GAAG,GAAGnO,MAAM,CAACA,MAAM,CAACQ,GAAP,EAAD,CAAhB;AACA,WAAO2N,GAAG,CAACC,IAAJ,CAASF,KAAT,EAAgB,SAAhB,CAAP;AACD,GAhEkB;AAiEnBF,uBAAqB,EAAE,UAAUK,KAAV,EAAiB;AACtC,QAAIA,KAAJ,EAAW;AACT,WAAK5B,aAAL,GAAqB,CAArB;AACA,WAAKC,iBAAL,GAAyB,KAAzB;AACA,WAAKC,aAAL,GAAqB,IAArB;AACD,KAJD,MAIO;AACL,UAAIF,aAAa,GAAG,KAAKA,aAAL,GAAqB,CAAzC;AACA,WAAKA,aAAL,GAAqBA,aAArB;AACA,WAAKC,iBAAL,GAAyBD,aAAa,GAAG,EAAzC;AACA,WAAKE,aAAL,GAAqBF,aAAa,GAAG,EAAhB,GAAqBzM,MAAM,CAACQ,GAAP,EAArB,GAAoC,IAAzD;AACD;;AACD,WAAO,IAAInI,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,aAAO,KAAK2T,IAAL,GAAYvN,IAAZ,CACJ3B,GAAD,IAAS;AACP1E,eAAO,CAAC0E,GAAD,CAAP;AACD,OAHI,EAIJjE,GAAD,IAAS;AACPR,cAAM,CAACQ,GAAD,CAAN;AACD,OANI,CAAP;AAQD,KATM,CAAP;AAUD,GAtFkB;AAuFnBgG,mBAAiB,EAAE,UAAUuP,OAAV,EAAmB;AACpC,QAAIjM,OAAO,GAAG;AACZjH,YAAM,EAAE,KAAKwB,GAAL,IAAYiB,SAAZ,GAAwB+G,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACiB,SAAL,CAAe,KAAKjJ,GAApB,CAAX,CAAxB,GAA+D,EAD3D;AAEZsB,eAAS,EAAE,KAAKA,SAFJ;AAGZjE,YAAM,EAAE,KAAKA,MAAL,IAAeqU,OAHX;AAIZrY,cAAQ,EAAE,KAAKA,QAJH;AAKZsY,SAAG,EAAEvB,WAAW,EALJ;AAMZwB,eAAS,EAAEnB,aAAa,CAAC,KAAKzQ,GAAN,CANZ,CAOZ;;AAPY,KAAd;AASA,QAAI3E,KAAK,GAAGyN,GAAG,CAAC+I,IAAJ,CAASpM,OAAT,EAAkByK,UAAlB,CAAZ;AACA,WAAO7U,KAAP;AACD,GAnGkB;AAoGnByW,aAAW,EAAE,UAAUtT,MAAV,EAAkB8P,KAAlB,EAAyB;AACpC,QAAI,CAACN,KAAK,CAACC,OAAN,CAAcK,KAAd,CAAL,EAA2BA,KAAK,GAAG,CAACA,KAAD,CAAR;AAC3B,WAAO,KAAKlD,MAAL,CACL;AACEpL,SAAG,EAAExB;AADP,KADK,EAIL;AACE0P,eAAS,EAAE;AACTI,aAAK,EAAE;AACLH,eAAK,EAAEG;AADF;AADE;AADb,KAJK,EAWL;AACEF,WAAK,EAAE;AADT,KAXK,CAAP;AAeD,GArHkB;AAsHnB2D,gBAAc,EAAE,UAAUC,KAAV,EAAiB1D,KAAjB,EAAwB;AACtC,QAAI,CAACN,KAAK,CAACC,OAAN,CAAc+D,KAAd,CAAL,EAA2BA,KAAK,GAAG,CAACA,KAAD,CAAR;AAC3B,QAAI,CAAChE,KAAK,CAACC,OAAN,CAAcK,KAAd,CAAL,EAA2BA,KAAK,GAAG,CAACA,KAAD,CAAR;AAE3B,WAAO,KAAKlD,MAAL,CACL;AACEpL,SAAG,EAAE;AACHuO,WAAG,EAAEyD;AADF;AADP,KADK,EAML;AACExD,cAAQ,EAAE;AACRF,aAAK,EAAEA;AADC;AADZ,KANK,EAWL;AACEF,WAAK,EAAE;AADT,KAXK,CAAP;AAeD,GAzIkB;AA0InB6D,cAAY,EAAE,UAAUzT,MAAV,EAAkB;AAC9B,WAAO,IAAI/C,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAK4M,IAAL,CAAU;AACRvI,WAAG,EAAExB;AADG,OAAV,EAGGkQ,QAHH,CAGY,OAHZ,EAIGC,IAJH,CAIQ,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AACrB,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACwW,cAAc,CAAC9V,MAAD,EAAS,OAAT,CAAf,CAAP;AACD,OAPH;AAQD,KATM,CAAP;AAUD;AArJkB,CAArB;;AAwJA,MAAM+V,iBAAiB,GAAG,CAACC,IAAD,EAAOC,IAAP,KAAgB;AACxC,MAAIC,UAAU,GAAGF,IAAI,CAAC1S,GAAL,CAAS,CAAC8G,IAAD,EAAO+L,CAAP,KAAa;AACrC,QAAIC,MAAM,GAAG;AACXhZ,UAAI,EAAEgN,IAAI,CAAChN,IADA;AAEXqV,aAAO,EAAErI,IAAI,CAACqI,OAFH;AAGXhR,aAAO,EAAE2I,IAAI,CAAC3I,OAHH;AAIXiR,eAAS,EAAEtI,IAAI,CAACsI;AAJL,KAAb;AAMAuD,QAAI,CAACrV,OAAL,CAAcyV,EAAD,IAAQ;AACnB,UAAIjM,IAAI,CAAChN,IAAL,KAAciZ,EAAE,CAACjZ,IAArB,EAA2B;AACzBgZ,cAAM,GAAGE,MAAM,CAACF,MAAP,CACP,EADO,EAEP;AACEhZ,cAAI,EAAEgN,IAAI,CAAChN,IADb;AAEEqV,iBAAO,EAAErI,IAAI,CAACqI,OAFhB;AAGEhR,iBAAO,EAAE2I,IAAI,CAAC3I,OAHhB;AAIEiR,mBAAS,EAAEtI,IAAI,CAACsI;AAJlB,SAFO,EAQP2D,EARO,CAAT;AAUD;AACF,KAbD;AAcA,WAAO,EAAE,GAAGD;AAAL,KAAP;AACD,GAtBgB,CAAjB;AAwBA,MAAIpT,GAAG,GAAG,EAAV;AACAiT,MAAI,CAACrV,OAAL,CAAcwJ,IAAD,IAAU;AACrB,QAAI+J,GAAG,GAAG,IAAV;AACA+B,cAAU,CAACtV,OAAX,CAAoB2V,EAAD,IAAQ;AACzB,UAAInM,IAAI,CAAChN,IAAL,CAAUoZ,IAAV,OAAqBD,EAAE,CAACnZ,IAAH,CAAQoZ,IAAR,EAAzB,EAAyCrC,GAAG,GAAG,KAAN;AAC1C,KAFD;AAGA,QAAIA,GAAJ,EAASnR,GAAG,CAACnC,IAAJ,CAASuJ,IAAT;AACV,GAND;AAQA,SAAO,CAAC,GAAG8L,UAAJ,EAAgB,GAAGlT,GAAnB,CAAP;AACD,CAnCD;;AAqCAuQ,UAAU,CAAC7E,OAAX,GAAqB;AACnB;;;AAGAhJ,UAAQ,EAAE,UAAU+Q,UAAV,EAAsB;AAC9B,WAAO,IAAIpX,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AACX3J,iBAAS,EAAEuR;AADA,OAAb;AAEG;;;;;;;AAFH,OASGlE,IATH,CASQ,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AACrB,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACU,MAAD,CAAP;AACD,OAZH;AAaD,KAdM,CAAP;AAeD,GApBkB;AAqBnBmG,qBAAmB,EAAE,UAAUuQ,WAAV,EAAuB;AAC1C,WAAO,IAAIrX,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AACX9J,kBAAU,EAAE2R;AADD,OAAb,EAEGnE,IAFH,CAEQ,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AACvB,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACU,MAAD,CAAP;AACD,OALD;AAMD,KAPM,CAAP;AAQD,GA9BkB;AA+BnBsG,mBAAiB,EAAE,UAAUqQ,SAAV,EAAqB;AACtC,WAAO,IAAItX,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AACX7J,gBAAQ,EAAE2R;AADC,OAAb,EAEGpE,IAFH,CAEQ,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AACvB,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACU,MAAD,CAAP;AACD,OALD;AAMD,KAPM,CAAP;AAQD,GAxCkB;AAyCnBqI,aAAW,EAAE,UAAUjG,MAAV,EAAkB;AAC7B,WAAO,IAAI/C,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AAAEjL,WAAG,EAAExB;AAAP,OAAb,EAA8BmQ,IAA9B,CAAmC,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AAClD,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,eAAO,CAACU,MAAM,CAAC6T,SAAR,CAAP;AACD,OAHD;AAID,KALM,CAAP;AAMD,GAhDkB;AAiDnBrL,aAAW,EAAE,UAAUpG,MAAV,EAAkBqG,IAAlB,EAAwB;AACnC,WAAO,IAAIpJ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AAAEjL,WAAG,EAAExB;AAAP,OAAb,EAA8BmQ,IAA9B,CAAmC,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AAClD,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACT,YAAI,CAACC,MAAL,EAAaT,MAAM,CAAC;AAAE6E,iBAAO,EAAE;AAAX,SAAD,CAAN;AACb,YAAIwS,UAAU,GAAGb,iBAAiB,CAAC/V,MAAM,CAAC6T,SAAP,IAAoB,EAArB,EAAyBpL,IAAzB,CAAlC;AACA,aAAKoO,gBAAL,CACE;AAAEjT,aAAG,EAAExB;AAAP,SADF,EAEE;AAAE6M,cAAI,EAAE;AAAE4E,qBAAS,EAAE+C;AAAb;AAAR,SAFF,EAGE;AAAEE,aAAG,EAAE;AAAP,SAHF,EAIE,UAAU/W,GAAV,EAAeiB,IAAf,EAAqB;AACnB,cAAIjB,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,iBAAO,CAACsX,UAAD,CAAP;AACD,SAPH;AASAtX,eAAO,CAACU,MAAD,CAAP;AACD,OAdD;AAeD,KAhBM,CAAP;AAiBD,GAnEkB;AAoEnB2I,gBAAc,EAAE,UAAUvG,MAAV,EAAkBqG,IAAlB,EAAwB;AACtC,WAAO,IAAIpJ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKsP,OAAL,CAAa;AAAEjL,WAAG,EAAExB;AAAP,OAAb,EAA8BmQ,IAA9B,CAAmC,CAACxS,GAAD,EAAMC,MAAN,KAAiB;AAClD,YAAID,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACT,YAAI,CAACC,MAAL,EAAaT,MAAM,CAAC;AAAE6E,iBAAO,EAAE;AAAX,SAAD,CAAN;AACb,YAAI2S,UAAU,GAAG,CAAC/W,MAAM,CAAC6T,SAAP,IAAoB,EAArB,EAAyB/J,MAAzB,CAAiCM,IAAD,IAAU;AACzD,cAAI4M,MAAM,GAAGvO,IAAI,CAACqB,MAAL,CAAamN,CAAD,IAAOA,CAAC,CAAC7Z,IAAF,CAAOoZ,IAAP,OAAkBpM,IAAI,CAAChN,IAAL,CAAUoZ,IAAV,EAArC,CAAb;AACA,iBAAOQ,MAAM,CAAC7M,MAAP,KAAkB,CAAzB;AACD,SAHgB,CAAjB;AAKA,aAAK0M,gBAAL,CACE;AAAEjT,aAAG,EAAExB;AAAP,SADF,EAEE;AAAE6M,cAAI,EAAE;AAAE4E,qBAAS,EAAEkD;AAAb;AAAR,SAFF,EAGE;AAAED,aAAG,EAAE;AAAP,SAHF,EAIE,UAAU/W,GAAV,EAAeiB,IAAf,EAAqB;AACnB,cAAIjB,GAAJ,EAASR,MAAM,CAACQ,GAAD,CAAN;AACTT,iBAAO,CAACyX,UAAD,CAAP;AACD,SAPH;AASAzX,eAAO,CAACU,MAAD,CAAP;AACD,OAlBD;AAmBD,KApBM,CAAP;AAqBD,GA1FkB;AA2FnB2D,YAAU,EAAE,UAAUuT,OAAV,EAAmB;AAC7B,WAAO,KAAK/D,SAAL,CACL;AACEvP,SAAG,EAAEsT,OAAO,CAACtT;AADf,KADK,EAIL;AACEqL,UAAI,EAAE;AACJ7R,YAAI,EAAE8Z,OAAO,CAAC9Z,IADV;AAEJiF,gBAAQ,EAAE6U,OAAO,CAAC7U,QAFd;AAGJ4C,gBAAQ,EAAEiS,OAAO,CAACjS,QAHd;AAIJ1C,aAAK,EAAE2U,OAAO,CAAC3U,KAJX;AAKJD,iBAAS,EAAE4U,OAAO,CAAC5U,SALf;AAMJa,cAAM,EAAE+T,OAAO,CAAC/T,MANZ;AAOJlG,gBAAQ,EAAEia,OAAO,CAACja,QAPd;AAQJsK,iBAAS,EAAEP,MAAM,CAACQ,GAAP;AARP;AADR,KAJK,CAAP;AAiBD,GA7GkB;AA8GnBI,UAAQ,EAAE,UAAUsP,OAAV,EAAmB;AAC3B,QAAIlW,IAAI,GAAG,IAAI,IAAJ,CAASkW,OAAT,CAAX;AACA,WAAOlW,IAAI,CAACkS,IAAL,EAAP;AACD,GAjHkB;;AAkHnB;;;AAGA3M,cAAY,EAAE,UAAU4Q,MAAV,EAAkB;AAC9B,WAAO,IAAI9X,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,UAAIiH,OAAO,GAAG,KAAd;;AACA,UAAI;AACFkG,WAAG,CAAC0K,MAAJ,CAAWD,MAAX,EAAmBrD,UAAnB,EAA+B,UAAU/T,GAAV,EAAesX,OAAf,EAAwB;AACrD,cAAIA,OAAJ,EAAa;AACX,gBAAI9C,gBAAgB,CAAC8C,OAAO,CAAC9B,GAAT,CAApB,EAAmC;AACjC/O,qBAAO,GAAG,IAAV;AACD;AACF;;AACDlH,iBAAO,CAACkH,OAAD,CAAP;AACD,SAPD;AAQD,OATD,CASE,OAAOzG,GAAP,EAAY;AACZiC,eAAO,CAACC,GAAR,CAAYlC,GAAZ;AACAR,cAAM,CAAC,KAAD,CAAN;AACD;AACF,KAfM,CAAP;AAgBD,GAtIkB;;AAuInB;;;;AAIA6J,iBAAe,EAAE,UAAU+N,MAAV,EAAkB;AACjC,WAAO,IAAI9X,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,UAAI;AACFmN,WAAG,CAAC0K,MAAJ,CAAWD,MAAX,EAAmBrD,UAAnB,EAA+B,UAAU/T,GAAV,EAAesX,OAAf,EAAwB;AACrD/X,iBAAO,CAAC+X,OAAD,CAAP;AACD,SAFD;AAGD,OAJD,CAIE,OAAOtX,GAAP,EAAY;AACZR,cAAM,CAACQ,GAAD,CAAN;AACD;AACF,KARM,CAAP;AASD,GArJkB;AAsJnBgM,iBAAe,EAAE,UAAU4I,SAAV,EAAqB;AACpC,WAAO,IAAItV,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAIqV,IAAI,GAAGtB,MAAM,CAACuB,MAAP,CAAcF,SAAd,CAAX;AACA,UAAI2C,UAAU,GAAG,EAAjB;AACAjE,YAAM,CAACkE,OAAP,CAAeD,UAAf,EAA2B,CAACvX,GAAD,EAAMyX,IAAN,KAAe;AACxCnE,cAAM,CAACnH,IAAP,CAAY0I,IAAZ,EAAkB4C,IAAlB,EAAwB,CAACzX,GAAD,EAAMmM,IAAN,KAAe;AACrC,cAAI,CAACnM,GAAL,EAAUT,OAAO,CAAC;AAAE4M;AAAF,WAAD,CAAP,CAAV,KACK3M,MAAM,CAACQ,GAAD,CAAN;AACN,SAHD;AAID,OALD;AAMD,KATM,CAAP;AAUD;AAjKkB,CAArB;AAoKA,MAAMuF,IAAI,GAAG0H,QAAQ,CAACkD,KAAT,CAAe,MAAf,EAAuBqD,UAAvB,CAAb;AAEAxW,MAAM,CAACC,OAAP,GAAiBsI,IAAjB,C;;;;;;;;;;;ACxdA,MAAM7I,MAAM,GAAGP,mBAAO,CAAC,wBAAD,CAAP,CAAmBub,MAAnB,EAAf;;AAEA,MAAMC,QAAQ,GAAGxb,mBAAO,CAAC,8DAAD,CAAxB;;AAEA,MAAMiB,KAAK,GAAGjB,mBAAO,CAAC,wDAAD,CAArB;;AAEA,MAAMyb,WAAW,GAAGzb,mBAAO,CAAC,oEAAD,CAA3B;;AAEA,MAAM0b,MAAM,GAAG1b,mBAAO,CAAC,0DAAD,CAAtB;;AAEA,MAAM2b,WAAW,GAAG3b,mBAAO,CAAC,kEAAD,CAA3B;;AAEA,MAAM4b,MAAM,GAAG5b,mBAAO,CAAC,sBAAD,CAAtB;;AAEA,MAAM+E,MAAM,GAAG/E,mBAAO,CAAC,0DAAD,CAAtB;;AAEA,IAAI6b,MAAM,GAAGD,MAAM,CAAC;AAAEE,MAAI,EAAE;AAAR,CAAD,CAAnB;AAEAvb,MAAM,CAACgP,IAAP,CAAY,gBAAZ,EAA8BiM,QAAQ,CAACzR,SAAvC;AAEAxJ,MAAM,CAACgP,IAAP,CAAY,mBAAZ,EAAiCiM,QAAQ,CAACnR,YAA1C;AAEA9J,MAAM,CAACgP,IAAP,CAAY,wBAAZ,EAAsCiM,QAAQ,CAAChR,iBAA/C;AAEAjK,MAAM,CAACgP,IAAP,CAAY,aAAZ,EAA2BiM,QAAQ,CAAC9Q,MAApC;AAEAnK,MAAM,CAACwb,GAAP,CAAW,mBAAX,EAAgCP,QAAQ,CAACxR,oBAAzC;AAEAzJ,MAAM,CAACwb,GAAP,CAAW,uBAAX,EAAoCP,QAAQ,CAACrR,kBAA7C;AAEA5J,MAAM,CAACgP,IAAP,CAAY,aAAZ,EAA2BmM,MAAM,CAAChT,MAAlC,E,CAEA;;AACA,MAAMsT,SAAS,GAAGhc,mBAAO,CAAC,gEAAD,CAAzB;;AAEAO,MAAM,CAACgP,IAAP,CAAY,qBAAZ,EAAmCyM,SAAS,CAAClQ,gBAA7C;AACAvL,MAAM,CAACwb,GAAP,CAAW,qBAAX,EAAkCC,SAAS,CAAChQ,aAA5C;AACAzL,MAAM,CAACwb,GAAP,CAAW,WAAX,EAAwBC,SAAS,CAAC/P,WAAlC;AACA1L,MAAM,CAACwb,GAAP,CAAW,yBAAX,EAAsCC,SAAS,CAAC7P,WAAhD;AACA5L,MAAM,CAACgP,IAAP,CAAY,4BAAZ,EAA0CyM,SAAS,CAAC1P,WAApD;AACA/L,MAAM,CAACgP,IAAP,CAAY,+BAAZ,EAA6CyM,SAAS,CAACvP,cAAvD;AAEAlM,MAAM,CAACgP,IAAP,CAAY,qBAAZ,EAAmCyM,SAAS,CAAC9S,cAA7C;AACA3I,MAAM,CAACgP,IAAP,CAAY,uBAAZ,EAAqCyM,SAAS,CAAC/S,gBAA/C;AACA1I,MAAM,CAACgP,IAAP,CAAY,oBAAZ,EAAkCyM,SAAS,CAAC7S,aAA5C,E,CAEA;;AACA5I,MAAM,CAACwb,GAAP,CAAW,cAAX,EAA2B9a,KAAK,CAACmH,cAAjC,E,CAEA;;AACA7H,MAAM,CAACwb,GAAP,CAAW,mBAAX,EAAgCN,WAAW,CAAClT,iBAA5C,E,CAEA;;AACAhI,MAAM,CAACgP,IAAP,CAAY,kBAAZ,EAAgCsM,MAAM,CAACI,GAAP,EAAhC,EAA8CN,WAAW,CAAC/T,UAA1D,E,CAEA;;AACArH,MAAM,CAACgP,IAAP,CAAY,2BAAZ,EAAyCxK,MAAM,CAACgG,aAAhD;AAEAxK,MAAM,CAACwb,GAAP,CAAW,kBAAX,EAA+BhX,MAAM,CAACwG,kBAAtC;AAEA1K,MAAM,CAACC,OAAP,GAAiBP,MAAjB,C;;;;;;;;;;;AC5DA,MAAMN,OAAO,GAAGD,mBAAO,CAAC,wBAAD,CAAvB;;AACA,MAAMO,MAAM,GAAGN,OAAO,CAACsb,MAAR,EAAf;;AAEA,MAAM7K,IAAI,GAAG1Q,mBAAO,CAAC,oDAAD,CAApB,C,CAEA;;;AACA,MAAMkc,SAAS,GAAGlc,mBAAO,CAAC,8CAAD,CAAzB;;AAEAO,MAAM,CAACE,GAAP,CAAW,QAAX,EAAqBiQ,IAAI,CAACE,YAA1B;AACArQ,MAAM,CAACuG,GAAP,CAAW,QAAX,EAAqBoV,SAArB;AAEArb,MAAM,CAACC,OAAP,GAAiBP,MAAjB,C;;;;;;;;;;;ACXA;;;AAIA,IAAIC,GAAG,GAAGR,mBAAO,CAAC,2BAAD,CAAjB;;AACA,IAAImc,KAAK,GAAGnc,mBAAO,CAAC,oBAAD,CAAP,CAAiB,mBAAjB,CAAZ;;AACA,IAAIoc,IAAI,GAAGpc,mBAAO,CAAC,kBAAD,CAAlB;AAEA;;;;;AAIA,IAAIqc,IAAI,GAAGC,aAAa,CAACtZ,OAAO,CAACC,GAAR,CAAYsZ,IAAZ,IAAoB,MAArB,CAAxB;AACA/b,GAAG,CAACgc,GAAJ,CAAQ,MAAR,EAAgBH,IAAhB;AAEA;;;;AAIA,IAAII,MAAM,GAAGL,IAAI,CAACM,YAAL,CAAkBlc,GAAlB,CAAb;AAEA;;;;AAIAic,MAAM,CAACE,MAAP,CAAcN,IAAd;AACAI,MAAM,CAAClL,EAAP,CAAU,OAAV,EAAmBqL,OAAnB;AACAH,MAAM,CAAClL,EAAP,CAAU,WAAV,EAAuBsL,WAAvB;AAEA;;;;AAIA,SAASP,aAAT,CAAuBQ,GAAvB,EAA4B;AAC1B,MAAIT,IAAI,GAAGU,QAAQ,CAACD,GAAD,EAAM,EAAN,CAAnB;;AAEA,MAAIE,KAAK,CAACX,IAAD,CAAT,EAAiB;AACf;AACA,WAAOS,GAAP;AACD;;AAED,MAAIT,IAAI,IAAI,CAAZ,EAAe;AACb;AACA,WAAOA,IAAP;AACD;;AAED,SAAO,KAAP;AACD;AAED;;;;;AAIA,SAASO,OAAT,CAAiBpN,KAAjB,EAAwB;AACtB,MAAIA,KAAK,CAACyN,OAAN,KAAkB,QAAtB,EAAgC;AAC9B,UAAMzN,KAAN;AACD;;AAED,MAAIgC,IAAI,GAAG,OAAO6K,IAAP,KAAgB,QAAhB,GACP,UAAUA,IADH,GAEP,UAAUA,IAFd,CALsB,CAStB;;AACA,UAAQ7M,KAAK,CAAC0N,IAAd;AACE,SAAK,QAAL;AACEpX,aAAO,CAAC0J,KAAR,CAAcgC,IAAI,GAAG,+BAArB;AACAxO,aAAO,CAACma,IAAR,CAAa,CAAb;AACA;;AACF,SAAK,YAAL;AACErX,aAAO,CAAC0J,KAAR,CAAcgC,IAAI,GAAG,oBAArB;AACAxO,aAAO,CAACma,IAAR,CAAa,CAAb;AACA;;AACF;AACE,YAAM3N,KAAN;AAVJ;AAYD;AAED;;;;;AAIA,SAASqN,WAAT,GAAuB;AACrB,MAAIO,IAAI,GAAGX,MAAM,CAACY,OAAP,EAAX;AACA,MAAI7L,IAAI,GAAG,OAAO4L,IAAP,KAAgB,QAAhB,GACP,UAAUA,IADH,GAEP,UAAUA,IAAI,CAACf,IAFnB;AAGAF,OAAK,CAAC,kBAAkB3K,IAAnB,CAAL;AACD,C;;;;;;;;;;;ACvFD,2C;;;;;;;;;;;ACAA,oC;;;;;;;;;;;ACAA,qC;;;;;;;;;;;ACAA,wC;;;;;;;;;;;ACAA,iC;;;;;;;;;;;ACAA,kC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,2C;;;;;;;;;;;ACAA,oC;;;;;;;;;;;ACAA,+B;;;;;;;;;;;ACAA,iC;;;;;;;;;;;ACAA,yC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,qC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,oC","file":"app.server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/server.js\");\n","const dotenv = require(\"dotenv\");\r\nconst express = require('express');\r\nconst logger = require('morgan');\r\nconst bodyParser = require('body-parser');\r\nconst cors = require(\"cors\");\r\n\r\ndotenv.config();\r\n\r\nconst connectDb = require(\"./models\").connectDb;\r\nvar router = require(\"./routes/router\");\r\n\r\n\r\nvar app = express();\r\n\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(bodyParser.json());\r\napp.use(express.json());\r\napp.use(cors());\r\napp.use(logger('dev'));\r\napp.use('/', router);\r\n\r\nconnectDb();\r\n\r\nmodule.exports = app;\r\n\r\n","const userType = require(\"./types\").userTypes;\r\n\r\n/**\r\n * Get menus list\r\n */\r\nexports.menus = [\r\n  {\r\n    name: \"Mi Cuenta\",\r\n    path: \"/admin/cuenta\",\r\n    icon: \"icon icon-account_circle\",\r\n    visible: true,\r\n    validUserTypes: [\r\n      userType.guard,\r\n      userType.suburbAdmin,\r\n      userType.admin,\r\n      userType.guest,\r\n      userType.neighbor,\r\n    ],\r\n    order: 5,\r\n  },\r\n  {\r\n    name: \"Guardias\",\r\n    path: \"/admin/guardias\",\r\n    icon: \"icon icon-shield\",\r\n    visible: true,\r\n    validUserTypes: [userType.guest, userType.guard, userType.admin],\r\n    order: 2,\r\n  },\r\n  {\r\n    name: \"GuardiasForm\",\r\n    icon: \"icon icon-shield\",\r\n    path: \"/admin/guardias-form\",\r\n    visible: false,\r\n    validUserTypes: [userType.suburbAdmin, userType.admin],\r\n    order: 6,\r\n  },\r\n  {\r\n    name: \"Vecinos\",\r\n    path: \"/admin/vecinos\",\r\n    icon: \"icon icon-users\",\r\n    visible: true,\r\n    validUserTypes: [userType.guard, userType.suburbAdmin, userType.admin],\r\n    order: 3,\r\n  },\r\n  {\r\n    name: \"Colonia\",\r\n    path: \"/admin/colonias\",\r\n    icon: \"icon icon-building\",\r\n    visible: true,\r\n    validUserTypes: [userType.admin, userType.suburbAdmin, userType.guest],\r\n    order: 4,\r\n  },\r\n  {\r\n    name: \"Colonia Status\",\r\n    path: \"/admin/coloniaStatus\",\r\n    icon: \"icon icon-building\",\r\n    visible: false,\r\n    validUserTypes: [userType.admin, userType.suburbAdmin, userType.guest],\r\n    order: 4,\r\n  },\r\n  {\r\n    name: \"Colonia Status\",\r\n    path: \"/admin/coloniaMain\",\r\n    icon: \"icon icon-building\",\r\n    visible: false,\r\n    validUserTypes: [\r\n      userType.admin,\r\n      userType.suburbAdmin,\r\n      userType.suburbAdmin,\r\n    ],\r\n    order: 4,\r\n  },\r\n];\r\n","exports.userTypes = {\r\n  guest: \"guest\",\r\n  admin: \"admin\",\r\n  suburbAdmin: \"suburbAdmin\",\r\n  guard: \"guard\",\r\n  neighbor: \"neighbor\",\r\n};\r\n\r\nexports.suburbStatus = [\r\n  {\r\n    status: \"pending\",\r\n    description:\r\n      \"Tu solicitud para registrar la colonia ha sido enviada, por favor espera de 2 a 3 dias habiles o contactanos por medio de nuestras redes sociales para mayor informacion.\",\r\n  },\r\n  {\r\n    status: \"rejected\",\r\n    description: \"Lo sentimos tu solicitud fue rechazada.\",\r\n  },\r\n  {\r\n    status: \"approved\",\r\n    description: \"Tu solicitud a sido aprobada.\",\r\n  },\r\n  {\r\n    status: \"feedback\",\r\n    description: \"Tu solicitud a sido revisada, se requiere mas información.\",\r\n  },\r\n];\r\n","const userServices = require(\"../logic/userService\");\r\nconst suburbService = require(\"../logic/suburbService\");\r\n//const fetchDbx = require('isomorphic-fetch');\r\nconst fs = require(\"fs\");\r\n// const Dropbox = require(\"dropbox\").Dropbox;\r\nconst dropboxV2Api = require(\"dropbox-v2-api\");\r\nconst sgMail = require(\"@sendgrid/mail\");\r\n\r\nconst getFileName = (nodeFileName, originalName) => {\r\n  let idx = originalName.lastIndexOf(\".\");\r\n  return `${nodeFileName}.${originalName.substring(idx + 1)}`;\r\n};\r\n\r\nconst uploadFileDropbox = (file) => {\r\n  const dropbox = dropboxV2Api.authenticate({\r\n    token: process.env.DROPBOX_TOKEN,\r\n  });\r\n\r\n  return new Promise((resolve, reject) => {\r\n    dropbox(\r\n      {\r\n        resource: \"files/upload\",\r\n        parameters: {\r\n          path: `/neighby/${getFileName(file.filename, file.originalname)}`,\r\n        },\r\n        readStream: fs.createReadStream(`${file.destination}/${file.filename}`),\r\n      },\r\n      (err, result, response) => {\r\n        if (!err) resolve(result);\r\n        else reject(err);\r\n      }\r\n    );\r\n  });\r\n};\r\n\r\nconst base64_encode = (file_path) => {\r\n  // read binary data\r\n  var bitmap = fs.readFileSync(file_path);\r\n  // convert binary data to base64 encoded string\r\n  return new Buffer.from(bitmap, \"base64\").toString(\"base64\"); //.toString('base64');\r\n};\r\n\r\nconst getEmailAttachments = (files) => {\r\n  let attachments = [];\r\n  files.forEach((file) => {\r\n    attachments.push({\r\n      filename: `${file.originalname}`,\r\n      content: base64_encode(`${file.destination}/${file.filename}`),\r\n    });\r\n  });\r\n  return attachments;\r\n};\r\n\r\nconst sendEmail = async (files, user, suburb, suburbId) => {\r\n  try {\r\n    sgMail.setApiKey(process.env.SENDGRID_API_KEY);\r\n\r\n    const msg = {\r\n      to: process.env.OWNER_EMAILS.split(\",\"),\r\n      from: \"support@neighby.com\",\r\n      subject: \"Nuevo requerimiento de registro de colonia.\",\r\n      text: `solicitud de registro.`,\r\n      html: `<strong>El usuario ${user} desea registrar la colonia ${suburb} y envia los documentos para revisión adjuntos en este email para revision, id de referencia:[${suburbId}].</strong>`,\r\n      attachments: getEmailAttachments(files),\r\n    };\r\n    await sgMail.send(msg);\r\n  } catch (ex) {\r\n    throw ex;\r\n  }\r\n};\r\n\r\nconst deleteTemporaryFiles = (files) => {\r\n  files.forEach((file) => {\r\n    fs.unlink(`${file.destination}/${file.filename}`, (err) => {\r\n      if (err) throw err;\r\n      console.log(\r\n        `path file ${file.destination}/${file.filename} has been deleted.`\r\n      );\r\n    });\r\n  });\r\n};\r\n\r\nconst processFileUpload = async (files, data) => {\r\n  try {\r\n    let {\r\n      userId,\r\n      name,\r\n      lastName,\r\n      cellphone,\r\n      email,\r\n      postalCode,\r\n      section,\r\n      suburbName,\r\n      recaptchaToken,\r\n    } = data;\r\n    let validCaptcha = await userServices.validateRecaptcha(recaptchaToken);\r\n    let proms = [];\r\n    files.forEach((file) => {\r\n      proms.push(uploadFileDropbox(file));\r\n    });\r\n    let uploadedFiles = await Promise.all(proms);\r\n\r\n    let saveSuburb = await suburbService.saveSuburb({\r\n      name: suburbName,\r\n      location: section,\r\n      postalCode: postalCode,\r\n      active: true,\r\n      userAdmins: [userId],\r\n      status: [suburbService.getSuburbStatus(\"pending\")],\r\n      files: files.map((fil) => ({\r\n        fileName: fil.filename,\r\n        originalName: fil.originalname,\r\n        actionType: \"solicitudRegistro\",\r\n        mimetype: fil.mimetype,\r\n      })),\r\n    });\r\n\r\n    let updateUser = await userServices.updateUser({\r\n      _id: userId,\r\n      name,\r\n      lastName,\r\n      cellphone,\r\n      email,\r\n      active: true,\r\n    });\r\n\r\n    await sendEmail(files, `${name} ${lastName}`, suburbName, saveSuburb.id);\r\n\r\n    deleteTemporaryFiles(files);\r\n    return saveSuburb;\r\n  } catch (ex) {\r\n    throw ex;\r\n  }\r\n};\r\n\r\nexports.uploadFile = async (req, res, next) => {\r\n  try {\r\n    let {\r\n      userId,\r\n      name,\r\n      lastName,\r\n      cellphone,\r\n      email,\r\n      postalCode,\r\n      section,\r\n      suburbName,\r\n      recaptchaToken,\r\n    } = req.body;\r\n    let processFiles = await processFileUpload(req.files, {\r\n      userId,\r\n      name,\r\n      lastName,\r\n      cellphone,\r\n      email,\r\n      postalCode,\r\n      section,\r\n      suburbName,\r\n      recaptchaToken,\r\n    });\r\n    res.status(202).json({ message: \"ok\" });\r\n  } catch (ex) {\r\n    res\r\n      .status(400)\r\n      .json({ message: ex.message || \"No se pudo completar el registro.\" });\r\n  }\r\n};\r\n","const menuService = require(\"../logic/menuService\");\r\n\r\n\r\n\r\n/**\r\n * [GET] method to get the menus by user types\r\n */\r\nexports.getMenusByUser = async (req, res, next) => {\r\n    let token = req.headers[\"authorization\"];\r\n    try {\r\n        const result = await menuService.getMenusByUser(token);\r\n        res.status('200').json(result);\r\n    } catch (err) {\r\n        res.status('401').json(err);\r\n    }\r\n}","const postalCodeService = require(\"../logic/postalCodeService\");\r\n\r\nexports.getPostalCodeInfo = async (req, res, next) => {\r\n    try {\r\n        let result = await postalCodeService.getCPInfo(req.query.postalCode);\r\n        res.status(200).json(result);\r\n    }\r\n    catch (err) {\r\n        res.status(400).json(err);\r\n    }\r\n}","const user = require(\"./userAdmin\");\r\n\r\nexports.signUp = (req, res, next) => {\r\n    if (req.body.token === undefined || req.body.token === '' || req.body.token === null) {\r\n        res.send({ success: false, message: 'Por favor intenta de nuevo (codigo recaptcha no encontrado).' });\r\n        return;\r\n    }\r\n    let { email, name, lastName, cellphone, facebookId, googleId, password, token } = req.body;\r\n    if (facebookId) {\r\n        req.body ={ email, name, lastName, loginName: facebookId, cellphone, facebookId, googleId, password, token };\r\n        user.saveFacebookUser(req, res, next);\r\n    }\r\n    else if (googleId) {        \r\n        req.body ={ email, name, lastName, loginName: googleId, cellphone, facebookId, googleId, password, token };\r\n        user.saveGoogleUser(req, res, next);\r\n    }\r\n    else {        \r\n        req.body ={ email, name, lastName, loginName: email, cellphone, facebookId, googleId, password, token };\r\n        user.saveEmailUser(req, res, next);\r\n    }\r\n    //mandar llamar registro aqui\r\n    // if (googleId || facebookId)\r\n    //     axios({\r\n    //         method: 'post',\r\n    //         url: googleId ? `${process.env.ADMIN_API_HOST}/api/saveGoogleUser` : `${process.env.ADMIN_API_HOST}/api/saveFacebookUser`,\r\n    //         data: {\r\n    //             name,\r\n    //             lastName,\r\n    //             loginName: googleId ? googleId : facebookId,\r\n    //             email,\r\n    //             cellphone,\r\n    //             googleId,\r\n    //             facebookId,\r\n    //             token\r\n    //         }\r\n    //     }).then(resS => {\r\n    //         res.send({ success: true, message: resS.data.message || \"Ok\" });\r\n    //     })\r\n    //         .catch(err => {\r\n    //             let errMsg = err && err.response && err.response.data && err.response.data.message ? err.response.data.message : err.message || \"No se pudo guardar el usuario.\";\r\n    //             res.send({ success: false, message: errMsg });\r\n    //         });\r\n    // else {\r\n    //     axios({\r\n    //         method: 'post',\r\n    //         url: `${process.env.ADMIN_API_HOST}/api/saveEmailUser`,\r\n    //         data: {\r\n    //             name,\r\n    //             lastName,\r\n    //             loginName: email,\r\n    //             email,\r\n    //             cellphone,\r\n    //             password,\r\n    //             token\r\n    //         }\r\n    //     }).then(resS => {\r\n    //         res.send({ success: true, message: resS.data.message || \"Ok\" });\r\n    //     })\r\n    //         .catch(err => {\r\n    //             let errMsg = err && err.response && err.response.data && err.response.data.message ? err.response.data.message : err.message || \"No se pudo guardar el usuario.\";\r\n    //             res.send({ success: false, message: errMsg });\r\n    //         });\r\n    // }\r\n}","const User = require(\"../models/user\");\r\nconst viewPermissions = require(\"../logic/viewPermissions\");\r\n\r\n\r\nconst validateUser = (userLogin, password) => {\r\n    return new Promise((resolve, reject) => {\r\n        User.getLogin(userLogin).then((login, err) => {\r\n            if (login) {\r\n                let validPass = login.validatePassword(password);\r\n                validPass.then(result => {\r\n                    //generate jwt token\r\n                    let token = login.generateUserToken();\r\n                    resolve({ success: true, message: token });\r\n                }, err => {\r\n                    reject({ success: false, message: err.message || 'La contraseña no es valida.' });\r\n                });\r\n            }\r\n            else reject({ succes: false, message: 'El usuario no existe.' });\r\n        });\r\n    });\r\n}\r\n\r\nexports.checkAuth = (req, res, next) => {\r\n    //over here check the db to know if the auth is valid\r\n    let user = req.body.user;\r\n    let password = req.body.password;\r\n    validateUser(user, password).then(result => {\r\n        if (result.success) {\r\n            // var session = req.session;\r\n            // session.token = result.message;\r\n            // session.user = user;\r\n            res.status('200').json(result);\r\n        }\r\n        else\r\n            res.status('401').json({ success: false, message: 'Unauthorized' });\r\n    }, err => {\r\n        res.status('401').json({ success: false, message: err.message || 'Unauthorized' });\r\n    });\r\n}\r\n\r\nexports.getTokenByFacebookId = (req, res) => {\r\n    let facebookId = req.query['id'];\r\n    User.getUserByFacebookId(facebookId).then(usr => {\r\n        if (usr) {\r\n            let token = usr.generateUserToken();\r\n            res.status('200').json({ token });\r\n        }\r\n        else {\r\n            res.status('404').json({ token: null });\r\n        }\r\n    })\r\n}\r\n\r\nexports.getTokenByGoogleId = (req, res) => {\r\n    let googleId = req.query['id'];\r\n    User.getUserByGoogleId(googleId).then(usr => {\r\n        if (usr) {\r\n            let token = usr.generateUserToken();\r\n            res.status('200').json({ token });\r\n        }\r\n        else {\r\n            res.status('404').json({ token: null });\r\n        }\r\n    });\r\n}\r\n\r\nexports.isValidToken = (req, res, next) => {\r\n    let token = req.headers[\"authorization\"];\r\n    return new Promise((resolve, reject) => {\r\n        User.isValidToken(token).then((isValid) => {\r\n            if (isValid)\r\n                res.status('200').json({ valid: true, message: \"the token is valid\" })\r\n            else\r\n                res.status('401')({\r\n                    valid: false,\r\n                    message: \"the token is not valid\"\r\n                });\r\n\r\n        }, err => res.status('500')(err));\r\n    });\r\n\r\n}\r\n\r\nexports.validateTokenPath = (req, res, next) => {\r\n    let { token, user, path } = req.body;\r\n    //over here add logic to check if a path is valid for the given context (user-> userType and jwt token)\r\n    viewPermissions.permissionValid(path, token, user).then(result => {\r\n        res.status('200').json({ valid: true, message: \"ok :)\" });\r\n    }, err => {\r\n        res.status('401').json(err);\r\n    });\r\n}\r\n\r\nexports.logOff = (req, res, next) => {\r\n    if (req.session)\r\n        req.session.destroy(err => {\r\n            if (err)\r\n                res.status('500').json({ success: false, message: err.message || 'An unknow error occurs while trying to log off.' })\r\n            res.status('200').json({ success: true, message: 'session destroyed.' });\r\n        })\r\n}\r\n","const suburbService = require(\"../logic/suburbService\");\r\nconst userService = require(\"../logic/userService\");\r\nconst userTypes = require(\"../constants/types\").userTypes;\r\nconst moment = require(\"moment\");\r\n\r\nexports.approveReject = async (req, res, next) => {\r\n  try {\r\n    let { suburbId, newStatus, details } = req.body;\r\n    let suburb = await suburbService.getSuburbById(suburbId);\r\n    let status = suburbService.getSuburbStatus(newStatus);\r\n    if (suburb && status) {\r\n      let addStatus = await suburbService.suburbAddStatus(suburbId, {\r\n        ...status,\r\n        details,\r\n        transtime: moment.utc(),\r\n      });\r\n      if (addStatus) {\r\n        if (status.status === \"approved\")\r\n          await userService.updateUser({\r\n            _id: suburb.userAdmins[0].id,\r\n            userType: userTypes.suburbAdmin,\r\n            transtime: moment.utc(),\r\n          });\r\n        res.status(200).json({\r\n          success: true,\r\n          message: `El estatus ha sido actualizado correctamente, el nuevo estatus es: \"${status.status}\"`,\r\n        });\r\n      }\r\n    } else\r\n      res.status(400).json({\r\n        success: false,\r\n        message: \"El estatus no es valido o la colonia no existe\",\r\n      });\r\n  } catch (ex) {\r\n    res.status(400).json({\r\n      success: false,\r\n      message: ex.message || \"No se pudo procesar aprobar/rechazar la colonia.\",\r\n    });\r\n  }\r\n};\r\n\r\nexports.getSuburbByAdminId = (req, res, next) => {\r\n  let userId = req.query.id;\r\n  suburbService.getSuburbByAdminUser(userId).then(\r\n    (result) => {\r\n      res.status(\"200\").json(result);\r\n    },\r\n    (err) => {\r\n      res.status(400).json({\r\n        success: false,\r\n        message:\r\n          err.message || \"No se pudo obtener la informacion de la colonia.\",\r\n      });\r\n    }\r\n  );\r\n};\r\n","const userService = require(\"../logic/userService\");\r\nconst userTypes = require(\"../constants/types\").userTypes;\r\n\r\nexports.saveGoogleUser = (req, res, next) => {\r\n  //get user data here\r\n  let {\r\n    name,\r\n    lastName,\r\n    loginName,\r\n    email,\r\n    password,\r\n    cellphone,\r\n    facebookId,\r\n    googleId,\r\n    token,\r\n  } = req.body;\r\n  //validate the captcha here\r\n  userService.validateRecaptcha(token).then(\r\n    (resV) => {\r\n      //save the user here\r\n      userService\r\n        .saveUser({\r\n          name,\r\n          lastName,\r\n          loginName,\r\n          email,\r\n          password,\r\n          cellphone,\r\n          facebookId,\r\n          googleId,\r\n          userConfirmed: true,\r\n        })\r\n        .then(\r\n          (resSave) => {\r\n            res.status(\"200\").json({\r\n              success: true,\r\n              message: res.message || \"Has sido registrado correctamente.\",\r\n            });\r\n          },\r\n          (err) => {\r\n            res\r\n              .status(\"400\")\r\n              .json({ success: false, message: err.message || \"Bad request.\" });\r\n          }\r\n        );\r\n    },\r\n    (err) => {\r\n      res\r\n        .status(\"400\")\r\n        .json({ success: false, message: err.message || \"Bad request.\" });\r\n    }\r\n  );\r\n};\r\n\r\nexports.saveFacebookUser = (req, res, next) => {\r\n  let {\r\n    name,\r\n    lastName,\r\n    loginName,\r\n    email,\r\n    password,\r\n    cellphone,\r\n    facebookId,\r\n    googleId,\r\n    token,\r\n  } = req.body;\r\n  //validate the captcha here\r\n  userService.validateRecaptcha(token).then(\r\n    (resV) => {\r\n      //save the user here\r\n      userService\r\n        .saveUser({\r\n          name,\r\n          lastName,\r\n          loginName,\r\n          email,\r\n          password,\r\n          cellphone,\r\n          facebookId,\r\n          googleId,\r\n          userConfirmed: true,\r\n        })\r\n        .then(\r\n          (resSave) => {\r\n            res.status(\"200\").json({\r\n              success: true,\r\n              message: res.message || \"Has sido registrado correctamente.\",\r\n            });\r\n          },\r\n          (err) => {\r\n            res\r\n              .status(\"400\")\r\n              .json({ success: false, message: err.message || \"Bad request.\" });\r\n          }\r\n        );\r\n    },\r\n    (err) => {\r\n      res\r\n        .status(\"400\")\r\n        .json({ success: false, message: err.message || \"Bad request.\" });\r\n    }\r\n  );\r\n};\r\n\r\nexports.saveEmailUser = (req, res, next) => {\r\n  let {\r\n    name,\r\n    lastName,\r\n    loginName,\r\n    email,\r\n    password,\r\n    cellphone,\r\n    facebookId,\r\n    googleId,\r\n    token,\r\n  } = req.body;\r\n  //validate the captcha here\r\n  userService.validateRecaptcha(token).then(\r\n    (resV) => {\r\n      //if the user is registered through email credentials the user needs to be confirmed through an email\r\n      userService\r\n        .saveUserWithPassword({\r\n          name,\r\n          lastName,\r\n          loginName,\r\n          email,\r\n          password: password,\r\n          cellphone,\r\n          facebookId,\r\n          googleId,\r\n          userConfirmed: false,\r\n        })\r\n        .then(\r\n          (resSave) => {\r\n            res.status(\"200\").json({\r\n              success: true,\r\n              message: res.message || \"Has sido registrado correctamente.\",\r\n            });\r\n          },\r\n          (err) => {\r\n            res\r\n              .status(\"400\")\r\n              .json({ success: false, message: err.message || \"Bad request.\" });\r\n          }\r\n        );\r\n    },\r\n    (err) => {\r\n      res\r\n        .status(\"400\")\r\n        .json({ success: false, message: err.message || \"Bad request.\" });\r\n    }\r\n  );\r\n};\r\n\r\nexports.createUserByType = async (req, res, next) => {\r\n  try {\r\n    const { name, lastName, loginName, email, cellphone } = req.body;\r\n    const userType = userTypes[req.params.userType];\r\n    if (!userType) {\r\n      res.status(\"400\").json({ success: false, message: \"Bad request.\" });\r\n      return;\r\n    }\r\n    const result = await userService.saveUser({\r\n      name,\r\n      lastName,\r\n      loginName,\r\n      email,\r\n      cellphone,\r\n      userConfirmed: false,\r\n      userType,\r\n    });\r\n    res.status(\"200\").json({\r\n      success: true,\r\n      message: result.message || \"Has sido registrado correctamente.\",\r\n    });\r\n  } catch (err) {\r\n    res\r\n      .status(\"400\")\r\n      .json({ success: false, message: err.message || \"Bad request.\" });\r\n  }\r\n};\r\n\r\nexports.getUserByType = async (req, res, next) => {\r\n  try {\r\n    const userType = userTypes[req.params.userType];\r\n    if (!userType) {\r\n      res.status(\"400\").json({ success: false, message: \"Bad request.\" });\r\n      return;\r\n    }\r\n    const result = await userService.getUserByType(userType);\r\n    res.status(\"200\").json({ success: true, data: result });\r\n  } catch (err) {\r\n    res\r\n      .status(\"400\")\r\n      .json({ success: false, message: err.message || \"Bad request.\" });\r\n  }\r\n};\r\n\r\nexports.getUserInfo = async (req, res, next) => {\r\n  try {\r\n    userService.getUserByToken(req.query.token).then(\r\n      (result) => {\r\n        res.status(\"200\").json(result);\r\n      },\r\n      (err) => {\r\n        res\r\n          .status(\"400\")\r\n          .json({ success: false, message: err.message || \"Bad request.\" });\r\n      }\r\n    );\r\n  } catch (err) {\r\n    res\r\n      .status(\"400\")\r\n      .json({ success: false, message: err.message || \"Bad request.\" });\r\n  }\r\n};\r\n\r\nexports.getUserFavs = async (req, res, next) => {\r\n  try {\r\n    let userFavs = await userService.getUserFavorites(req.query.userId);\r\n    res.status(\"200\").json(userFavs);\r\n  } catch (err) {\r\n    res\r\n      .status(\"400\")\r\n      .json({ success: false, message: err.message || \"Bad request.\" });\r\n  }\r\n};\r\n\r\nexports.addUserFavs = async (req, res, next) => {\r\n  try {\r\n    let { favs, userId } = req.body;\r\n    let userFavs = await userService.saveUserFavorites(userId, favs);\r\n    res.status(\"200\").json(userFavs);\r\n  } catch (err) {\r\n    res\r\n      .status(\"400\")\r\n      .json({ success: false, message: err.message || \"Bad request.\" });\r\n  }\r\n};\r\n\r\nexports.removeUserFavs = async (req, res, next) => {\r\n  try {\r\n    let { favs, userId } = req.body;\r\n    let userFavs = await userService.removeUserFavorites(userId, favs);\r\n    res.status(\"200\").json(userFavs);\r\n  } catch (err) {\r\n    res\r\n      .status(\"400\")\r\n      .json({ success: false, message: err.message || \"Bad request.\" });\r\n  }\r\n};\r\n","const User = require(\"../models/user\");\r\nconst userTypes = require(\"../constants/types\").userTypes;\r\n\r\nconst openApi = [\r\n  \"/api/checkAuth\",\r\n  \"/api/auth/fbtoken\",\r\n  \"/api/auth/googletoken\",\r\n  \"/api/saveGoogleUser\",\r\n  \"/api/saveFacebookUser\",\r\n  \"/api/saveEmailUser\",\r\n  \"/api/signUp\",\r\n  \"/api/validateTokenPath\",\r\n  \"/api/cp/getCPInfo\",\r\n  \"/api/file/upload\",\r\n  \"/api/userInfo/favorites\", //remover esto cuando se agregue authenticacion en mobile\r\n  \"/api/userInfo/addFavorites\", //remover esto cuando se agregue authenticacion en mobile\r\n  \"/api/userInfo/removeFavorites\", //remover esto cuando se agregue authenticacion en mobile\r\n];\r\n\r\nconst protectedApi = [\"/api/suburb/approveReject\"];\r\n\r\nmodule.exports = class Auth {\r\n  validateToken(token) {\r\n    let user = User;\r\n\r\n    let def = user.isValidToken(token);\r\n    return new Promise(\r\n      (resolve, reject) => {\r\n        def.then(function (isValid) {\r\n          if (isValid) resolve({ valid: true, message: \"the token is valid\" });\r\n          else\r\n            resolve({\r\n              valid: false,\r\n              message: \"the token is not valid\",\r\n            });\r\n        });\r\n      },\r\n      (err) => reject({ valid: false, message: \"The token cannot be checked.\" })\r\n    );\r\n  }\r\n\r\n  validateAdminUser(token) {\r\n    let user = User;\r\n    let getPayload = user.getTokenPayload(token);\r\n    return new Promise(\r\n      (resolve, reject) => {\r\n        getPayload.then((payload) => {\r\n          if (payload.userType !== userTypes.admin)\r\n            reject({\r\n              valid: false,\r\n              message:\r\n                \"The user does not have permissions to execute this api.\",\r\n            });\r\n          else resolve({ valid: true, message: \"Ok\" });\r\n        });\r\n      },\r\n      (err) => {\r\n        console.log(err);\r\n        reject({\r\n          valid: false,\r\n          message: \"The user does not have permissions to execute this api.\",\r\n        });\r\n      }\r\n    );\r\n  }\r\n\r\n  isOpenApi(apiPath) {\r\n    return openApi.indexOf(apiPath) !== -1 ? true : false;\r\n  }\r\n\r\n  isProtectedApi(apiPath) {\r\n    return protectedApi.indexOf(apiPath) !== -1 ? true : false;\r\n  }\r\n\r\n  validateApiRequest(apiPath, token) {\r\n    if (this.isOpenApi(apiPath))\r\n      return new Promise((resolve) =>\r\n        resolve({ valid: true, message: \"the api is open.\" })\r\n      );\r\n    else if (this.isProtectedApi(apiPath)) {\r\n      return new Promise((resolve, reject) => {\r\n        this.validateAdminUser(token)\r\n          .then((res) => {\r\n            let validateToken = this.validateToken(token);\r\n            validateToken\r\n              .then((res) => resolve(res))\r\n              .catch((err) => reject(err));\r\n          })\r\n          .catch((err) => {\r\n            reject(err);\r\n          });\r\n      });\r\n    } else {\r\n      return this.validateToken(token);\r\n    }\r\n  }\r\n};\r\n","const User = require(\"../models/user\");\r\nconst menus = require(\"../constants/menusConfig\").menus;\r\n\r\n/**\r\n * Get menus by logged user\r\n */\r\nexports.getMenusByUser = async (userToken) => {\r\n  return new Promise((resolve, reject) => {\r\n    let getPayload = User.getTokenPayload(userToken);\r\n    getPayload.then(payload => {\r\n      const { userType, loginName } = payload;\r\n\r\n      let userMenus = menus.filter(menu => {\r\n        let types = menu.validUserTypes.filter(g => g.toLowerCase() === userType.toLowerCase());\r\n        return types.length > 0;\r\n      }).map(item => ({ name: item.name, path: item.path, visible: item.visible, icon: item.icon, order: item.order }));\r\n\r\n\r\n      resolve(userMenus);\r\n    }, errP => {\r\n      reject({ valid: false, message: 'The token is not allowed' });\r\n    });\r\n  });\r\n};","const PostalCode = require(\"../models/postalCode\");\r\n\r\n\r\nexports.getCPInfo = async (postalCode) => {\r\n    return new Promise((resolve, reject) => {\r\n        if (postalCode.length > 2) {\r\n            getInfo = PostalCode.getCPInfo(postalCode);\r\n            getInfo.then(cp => {\r\n                resolve(cp);\r\n            }, err => {\r\n                reject({ valid: false, message: 'No se pudo obtener la informaion del codigo postal.' });\r\n            });\r\n        }\r\n        else {\r\n            reject({ valid: false, message: 'La longitud del codigo postal no es valida.' });\r\n        }\r\n    });\r\n}","const Suburb = require(\"../models/suburb\");\r\nconst suburbStatus = require(\"../constants/types\").suburbStatus;\r\n\r\nconst getSuburbStatus = (statusName) => {\r\n  let status = suburbStatus.filter((st) => st.status === statusName);\r\n  return status[0];\r\n};\r\n\r\nconst saveSuburb = (suburbObj) => {\r\n  return new Promise((resolve, reject) => {\r\n    Suburb.SaveSuburb(suburbObj).then((sub, err) => {\r\n      if (!err)\r\n        resolve({\r\n          success: true,\r\n          message: \"La colonia fue guardada correctamente.\",\r\n          id: sub.id,\r\n        });\r\n      else\r\n        reject({\r\n          success: false,\r\n          message:\r\n            err.message || \"Ocurrio un error al intentar guardar la colonia.\",\r\n        });\r\n    });\r\n  });\r\n};\r\n\r\nconst suburbAddStatus = (id, status) => {\r\n  return new Promise((resolve, reject) => {\r\n    Suburb.UpdateStatus(id, status).then((sub, err) => {\r\n      if (!err)\r\n        resolve({\r\n          success: true,\r\n          message: \"El status de la colonia fue actualizado correctamente.\",\r\n        });\r\n      else\r\n        reject({\r\n          success: false,\r\n          message:\r\n            err.message ||\r\n            \"Ocurrio un error al intentar actualizar el estatus de la colonia.\",\r\n        });\r\n    });\r\n  });\r\n};\r\n\r\nconst suburbAddStatusByName = (name, postalCode, status) => {\r\n  return new Promise((resolve, reject) => {\r\n    Suburb.UpdateStatusByName(name, postalCode, status).then((sub, err) => {\r\n      if (!err)\r\n        resolve({\r\n          success: true,\r\n          message: \"El status de la colonia fue actualizado correctamente.\",\r\n        });\r\n      else\r\n        reject({\r\n          success: false,\r\n          message:\r\n            err.message ||\r\n            \"Ocurrio un error al intentar actualizar el estatus de la colonia.\",\r\n        });\r\n    });\r\n  });\r\n};\r\n\r\nconst getSuburbByAdminUser = (userId) => {\r\n  return new Promise((resolve, reject) => {\r\n    Suburb.GetSuburbByUserId(userId).then((sub, err) => {\r\n      if (!err) resolve(sub);\r\n      else\r\n        reject({\r\n          success: false,\r\n          message:\r\n            err.message ||\r\n            \"Ocurrio un error al intentar obtener la colonia por usuario administrador.\",\r\n        });\r\n    });\r\n  });\r\n};\r\n\r\nconst getSuburbById = (suburbId) => {\r\n  return new Promise((resolve, reject) => {\r\n    Suburb.GetSuburb(suburbId)\r\n      .then((sub, err) => {\r\n        if (!err) resolve(sub);\r\n        else\r\n          reject({\r\n            success: false,\r\n            message:\r\n              err.message || \"Ocurrio un error al intentar obtener la colonia.\",\r\n          });\r\n      })\r\n      .catch((err) => reject(err));\r\n  });\r\n};\r\n\r\nmodule.exports = {\r\n  saveSuburb,\r\n  suburbAddStatus,\r\n  suburbAddStatusByName,\r\n  getSuburbByAdminUser,\r\n  getSuburbById,\r\n  getSuburbStatus,\r\n};\r\n","const User = require(\"../models/user\");\r\nconst request = require(\"request\");\r\nconst userTypes = require(\"../constants/types\").userTypes;\r\n\r\nconst saveUser = (userObj) => {\r\n  return new Promise((resolve, reject) => {\r\n    User.getLogin(userObj.loginName).then(\r\n      (login) => {\r\n        if (login) {\r\n          reject({\r\n            success: false,\r\n            message: \"El usuario existe actualmente en la base de datos.\",\r\n          });\r\n        } else {\r\n          //create the user\r\n          User.saveUser(\r\n            userObj.userType\r\n              ? userObj\r\n              : { ...userObj, userType: userTypes.guest }\r\n          ).then(\r\n            (usr, err) => {\r\n              //check if there is an error\r\n              if (!err)\r\n                resolve({\r\n                  success: true,\r\n                  message: \"Has sido registrado correctamente.\",\r\n                });\r\n              else\r\n                reject({\r\n                  success: false,\r\n                  message: err.message || \"No se pudo registrar el usuario.\",\r\n                });\r\n            },\r\n            (err) => {\r\n              reject({ success: false, message: err.message });\r\n            }\r\n          );\r\n        }\r\n      },\r\n      (err) => {\r\n        reject({\r\n          success: false,\r\n          message:\r\n            err.message || \"Ocurrio un error al tratar de guardar el usuario.\",\r\n        });\r\n      }\r\n    );\r\n  });\r\n};\r\n\r\nconst updateUser = async (userObj) => {\r\n  return new Promise((resolve, reject) => {\r\n    User.updateUser(userObj).then(\r\n      (usr, err) => {\r\n        if (!err)\r\n          resolve({\r\n            success: true,\r\n            message: \"Ha sido actualizado correctamente.\",\r\n          });\r\n        else\r\n          reject({\r\n            success: false,\r\n            message: err.message || \"No se pudo actualizar el usuario.\",\r\n          });\r\n      },\r\n      (err) => {\r\n        reject({ success: false, message: err.message });\r\n      }\r\n    );\r\n  });\r\n};\r\n\r\nconst validateRecaptcha = async (token) => {\r\n  const secretKey = process.env.RECAPTCHA_SECRET;\r\n  const verificationURL = `https://www.google.com/recaptcha/api/siteverify?secret=${secretKey}&response=${token}`;\r\n\r\n  return new Promise((resolve, reject) => {\r\n    request.post(verificationURL, (error, resG, body) => {\r\n      if (error)\r\n        reject({\r\n          success: false,\r\n          message:\r\n            \"Por favor intenta de nuevo (no es posible validar recaptcha).\",\r\n        });\r\n      let status = JSON.parse(body);\r\n      if (!status.success)\r\n        reject({ success: false, message: \"Por favor intenta de nuevo.\" });\r\n      else if (status.score <= 0.5)\r\n        reject({\r\n          success: false,\r\n          message: \"Por favor intenta de nuevo (score demasiado bajo).\",\r\n        });\r\n      else resolve({ success: true, message: \"recaptcha valido.\" });\r\n    });\r\n  });\r\n};\r\n\r\nconst saveUserWithPassword = async (userObj) => {\r\n  const { password } = userObj;\r\n  return new Promise((resolve, reject) => {\r\n    User.encryptPassword(password).then(\r\n      (resEncrypt) => {\r\n        let encryptedPassword = resEncrypt.hash;\r\n        userObj.password = encryptedPassword;\r\n        saveUser(userObj).then(\r\n          (result) => {\r\n            resolve(result);\r\n          },\r\n          (err) => {\r\n            reject(err);\r\n          }\r\n        );\r\n      },\r\n      (err) => {\r\n        reject({ success: false, message: err.message || \"Bad request.\" });\r\n      }\r\n    );\r\n  });\r\n};\r\n\r\nconst getUserByType = async (userType) => {\r\n  try {\r\n    return await User.find({\r\n      userType: userType,\r\n    });\r\n  } catch (ex) {\r\n    return ex;\r\n  }\r\n};\r\n\r\nconst getUserByToken = async (token) => {\r\n  try {\r\n    let payload = await User.getTokenPayload(token);\r\n    return await User.findById(payload.userId);\r\n  } catch (ex) {\r\n    return ex;\r\n  }\r\n};\r\n\r\nconst getUserFavorites = async (userId) => {\r\n  try {\r\n    let payload = await User.getUserFavs(userId);\r\n    return payload;\r\n  } catch (ex) {\r\n    throw ex;\r\n  }\r\n};\r\n\r\nconst saveUserFavorites = async (userId, favs) => {\r\n  try {\r\n    let payload = await User.addUserFavs(userId, favs);\r\n    return payload;\r\n  } catch (ex) {\r\n    throw ex;\r\n  }\r\n};\r\n\r\nconst removeUserFavorites = async (userId, favs) => {\r\n  try {\r\n    let payload = await User.removeUserFavs(userId, favs);\r\n    return payload;\r\n  } catch (ex) {\r\n    throw ex;\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  saveUser,\r\n  validateRecaptcha,\r\n  saveUserWithPassword,\r\n  getUserByType,\r\n  getUserByToken,\r\n  updateUser,\r\n  getUserFavorites,\r\n  saveUserFavorites,\r\n  removeUserFavorites,\r\n};\r\n","const User = require(\"../models/user\");\r\nconst permissions = require(\"../constants/menusConfig\").menus;\r\n\r\n\r\n\r\nconst validateWithPayload = (path, payload) => {\r\n    let valid =  { valid: false, message: 'la pantalla no es valida para tu usuario.' };\r\n    if(!payload || !payload.userType)\r\n        return valid;\r\n\r\n    const { userType } = payload;\r\n    let validPath = permissions.filter(p => {\r\n        let types = p.validUserTypes.filter(g => g.toLowerCase() === userType.toLowerCase());\r\n        return types.length > 0 && p.path.toLowerCase() === path.toLocaleLowerCase();\r\n\r\n    });\r\n\r\n    if (validPath.length > 0)\r\n        valid = { valid: true, message: 'ok' };\r\n    return valid;\r\n};\r\n\r\n\r\nexports.permissionValid = (path, jwt) => {\r\n    return new Promise((resolve, reject) => {\r\n        let user = User;\r\n        let isValid = user.isValidToken(jwt);\r\n        isValid.then(res => {\r\n            let getPayload = user.getTokenPayload(jwt);\r\n            getPayload.then(payload => {\r\n                let valid = validateWithPayload(path, payload);\r\n                if (valid.valid)\r\n                    resolve(valid);\r\n                else\r\n                    reject(valid);\r\n            }, errP => {\r\n                reject({ valid: false, message: 'los datos de la sesión no son validos.' });\r\n            });\r\n        }, err => {\r\n            reject({ valid: false, message: 'el token de la sesión no es valido.' });\r\n        });\r\n    });\r\n}","const Auth = require(\"../logic/auth\");\r\n\r\nconst validApiRequest = (apiPath, token) => {\r\n  return new Promise((resolve, reject) => {\r\n    let auth = new Auth();\r\n    auth.validateApiRequest(apiPath, token).then(\r\n      (res) => {\r\n        resolve(res);\r\n      },\r\n      (err) =>\r\n        reject({\r\n          valid: false,\r\n          message: err.message ? err.message : `Error: ${JSON.stringify(err)}`,\r\n        })\r\n    );\r\n  });\r\n};\r\n\r\nexports.checkApiAuth = (req, res, next) => {\r\n  console.log(`validando si el request esta autenticado...`);\r\n  //check request headers over here to know if the request is authenticated\r\n  let apiPath = req.baseUrl,\r\n    token = req.headers[\"authorization\"];\r\n\r\n  validApiRequest(apiPath, token).then(\r\n    (result) => {\r\n      if (result.valid) next();\r\n      else\r\n        res\r\n          .status(\"401\")\r\n          .json({ success: false, error: \"Unauthorized request.\" });\r\n    },\r\n    (err) =>\r\n      res.status(\"401\").json({\r\n        success: false,\r\n        error: err.message || \"An error occurs while validating the request.\",\r\n      })\r\n  );\r\n};\r\n","const mongoose = require(\"mongoose\");\r\nconst Menu = require(\"./menu\");\r\nconst Role = require(\"./role\");\r\nconst User = require(\"./user\");\r\nconst PostalCode = require(\"./postalCode\");\r\n\r\n\r\nconst models = { Menu, Role, User, PostalCode };\r\n\r\nconst connectDb = () => {\r\n    //setup the mongo connection\r\n    let mConn = mongoose.connect(process.env.DB_CONNECTION, {\r\n        useNewUrlParser: true\r\n    });\r\n\r\n    mongoose.connection.on(\"error\", console.error.bind(console, \"Mongo db connection error: \"));\r\n    return mConn;\r\n};\r\n\r\n\r\nmodule.exports = { connectDb, models };","const moment = require('moment');\r\nconst mongoose = require('mongoose');\r\n//const Base = require('./baseModel');\r\n\r\nconst MenuSchema = new mongoose.Schema({\r\n    name: {\r\n        type: String,\r\n        required: 'Enter the menu name'\r\n    },\r\n    link: {\r\n        type: String,\r\n        required: 'Enter the menu link'\r\n    },\r\n    parentId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Menu'\r\n    },\r\n    position: {\r\n        type: Number,\r\n        default: 1\r\n    },\r\n    icon: {\r\n        type: String\r\n    },\r\n    visible: {\r\n        type: Boolean,\r\n        default: true\r\n    },\r\n    active: {\r\n        type: Boolean,\r\n        default: true\r\n    },\r\n    type: {\r\n        type: String\r\n    },\r\n    transtime: {\r\n        type: Date,\r\n        default: moment.utc()\r\n    }\r\n});\r\n\r\n\r\nMenuSchema.statics = {\r\n    getMenuById: function (menuId) { //, projectId){\r\n        return this.findOne({\r\n            _id: menuId //, \r\n            //project: projectId\r\n        });\r\n    },\r\n    updateMenu: function (objMenu) {\r\n        return this.update({\r\n            _id: objMenu._id\r\n        }, {\r\n                $set: {\r\n                    'name': objMenu.name,\r\n                    'link': objMenu.link,\r\n                    'parentId': objMenu.parentId,\r\n                    'position': objMenu.position,\r\n                    'icon': objMenu.position,\r\n                    'visible': objMenu.visible,\r\n                    'active': objMenu.active,\r\n                    'type': objMenu.active,\r\n                    'transtime': moment.utc()\r\n                }\r\n            });\r\n    },\r\n    deleteMenu: function (menuId) {\r\n        return this.deleteMany({\r\n            _id: menuId\r\n        });\r\n    },\r\n    getChildMenus: function (menuId) {\r\n        return this.find({\r\n            parentId: menuId\r\n        });\r\n    },\r\n    getChildMenusRecursively: function (parents) {\r\n        let _this = this;\r\n        let getThisLevelChilds = this.getChildMenus(parents);\r\n        let elements = [];\r\n        return new Promise((resolve, reject) => {\r\n            getThisLevelChilds.then((childs) => {\r\n                if (childs.length > 0) {\r\n                    elements = JSON.parse(JSON.stringify(childs)).map((child) => {\r\n                        return child._id;\r\n                    });\r\n                    let getInnerChilds = _this.getChildMenusRecursively(elements);\r\n                    getInnerChilds.then((result) => {\r\n                        resolve(elements.concat(result));\r\n                    });\r\n                } else\r\n                    resolve(elements);\r\n            }, (err) => {\r\n                reject(err);\r\n            })\r\n        });\r\n    },\r\n    getParentMenusRecursively: function (menuId) {\r\n        let _this = this;\r\n        let getThisLevel = this.getMenuById(menuId);\r\n        let elements = [];\r\n        return new Promise((resolve, reject) => {\r\n            getThisLevel.then((menu) => {\r\n                menu = JSON.parse(JSON.stringify(menu))\r\n                if (menu && menu.parentId) {\r\n                    elements.push(menu.parentId);\r\n                    let getMoreParents = _this.getParentMenusRecursively(menu.parentId);\r\n                    getMoreParents.then((result) =>\r\n                        resolve(elements.concat(result)));\r\n                } else\r\n                    resolve(elements);\r\n            }, err => reject(err));\r\n        });\r\n    },\r\n    getMenus: function (menus) {\r\n        return this.find({ _id: menus });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\nconst Menu = mongoose.model(\"Menu\", MenuSchema);\r\n\r\nmodule.exports = Menu;","const mongoose = require('mongoose');\r\n\r\nconst PostalCodeSchema = new mongoose.Schema({\r\n    d_codigo: {\r\n        type: String\r\n    },\r\n    d_asenta: {\r\n        type: String\r\n    },\r\n    d_tipo_asenta: {\r\n        type: String\r\n    },\r\n    D_mnpio: {\r\n        type: String\r\n    },\r\n    d_estado: {\r\n        type: String\r\n    },\r\n    d_ciudad: {\r\n        type: String\r\n    },\r\n    d_CP: {\r\n        type: String\r\n    },\r\n    c_estado: {\r\n        type: String\r\n    },\r\n    c_oficina: {\r\n        type: String\r\n    },\r\n    c_CP: {\r\n        type: String\r\n    },\r\n    c_tipo_asenta: {\r\n        type: String\r\n    },\r\n    c_mnpio: {\r\n        type: String\r\n    },\r\n    id_asenta_cpcons: {\r\n        type: String\r\n    },\r\n    d_zona: {\r\n        type: String\r\n    },\r\n    c_cve_ciudad: {\r\n        type: String\r\n    }\r\n});\r\n\r\nPostalCodeSchema.statics = {\r\n    getCPInfo: function (cp) {\r\n        let regCp = new RegExp(cp)\r\n        return this.find({ d_codigo: regCp }).limit(100);\r\n    }\r\n};\r\n\r\nconst PostalCode = mongoose.model(\"PostalCode\", PostalCodeSchema);\r\n\r\nmodule.exports = PostalCode;","const moment = require('moment');\r\nconst mongoose = require(\"mongoose\");\r\n\r\nconst RoleSchema = new mongoose.Schema({\r\n    name: {\r\n        type: String,\r\n        required: 'Enter the name of the role'\r\n    },\r\n    description: {\r\n        type: String,\r\n        required: 'Enter the description of the role'\r\n    },\r\n    siteAdministration: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    sysAdministrator: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    active: {\r\n        type: Boolean,\r\n        default: true\r\n    },\r\n    menus: [{\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Menu'\r\n    }],\r\n    transtime: {\r\n        type: Date,\r\n        default: moment.utc()\r\n    }\r\n});\r\n\r\nRoleSchema.statics = {\r\n    deleteRole: function (roleId) {\r\n        return this.deleteMany({\r\n            _id: roleId\r\n        });\r\n    },\r\n    setRoleMenu: function (roleId, menus) {\r\n        if (!Array.isArray(menus)) menus = [menus];\r\n        return this.update({\r\n            _id: roleId\r\n        }, {\r\n                $addToSet: {\r\n                    menus: {\r\n                        $each: menus\r\n                    }\r\n                }\r\n            }, {\r\n                multi: true\r\n            });\r\n    },\r\n    deleteRoleMenu: function (roles, menus) {\r\n        if (!Array.isArray(menus)) menus = [menus];\r\n        if (!Array.isArray(roles)) roles = [roles];\r\n\r\n        return this.update({\r\n            _id: {\r\n                $in: roles\r\n            }\r\n        }, {\r\n                $pullAll: {\r\n                    menus: menus\r\n                }\r\n            }, {\r\n                multi: true\r\n            });\r\n    },\r\n    getRoleMenus: function (roleId) {\r\n        return new Promise((resolve, reject) => {\r\n            this.find({\r\n                _id: roleId\r\n            }).populate('menus').exec((err, result) => {\r\n                if (err) reject(err);\r\n                resolve(result);\r\n            });\r\n        });\r\n    }\r\n};\r\n\r\nconst Role = mongoose.model(\"Role\", RoleSchema);\r\n\r\nmodule.exports = Role;","const mongoose = require(\"mongoose\");\r\nconst moment = require(\"moment\");\r\n\r\nconst GuestSchema = new mongoose.Schema({\r\n  name: {\r\n    type: String,\r\n  },\r\n  vehicle: {\r\n    type: String,\r\n  },\r\n  subject: {\r\n    type: String,\r\n  },\r\n  isService: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  plates: {\r\n    type: String,\r\n  },\r\n  additionalInformation: {\r\n    type: String,\r\n  },\r\n  active: {\r\n    type: Boolean,\r\n    default: true,\r\n  },\r\n  arriveOn: {\r\n    type: Date,\r\n  },\r\n  leaveOn: {\r\n    type: Date,\r\n  },\r\n  transtime: {\r\n    type: Date,\r\n    default: moment.utc(),\r\n  },\r\n});\r\n\r\nmodule.exports = GuestSchema;\r\n","const mongoose = require(\"mongoose\");\r\nconst moment = require(\"moment\");\r\n\r\nconst SuburbFileSchema = new mongoose.Schema({\r\n  fileName: {\r\n    type: String,\r\n  },\r\n  originalName: {\r\n    type: String,\r\n  },\r\n  actionType: {\r\n    type: String,\r\n  },\r\n  mimetype: {\r\n    type: String,\r\n  },\r\n  transtime: {\r\n    type: Date,\r\n    default: moment.utc(),\r\n  },\r\n});\r\n\r\nmodule.exports = SuburbFileSchema;\r\n","const mongoose = require(\"mongoose\");\r\nconst moment = require(\"moment\");\r\n\r\nconst SuburbStatusSchema = new mongoose.Schema({\r\n  status: {\r\n    type: String,\r\n  },\r\n  description: {\r\n    type: String,\r\n  },\r\n  details: {\r\n    type: String,\r\n  },\r\n  transtime: {\r\n    type: Date,\r\n    default: moment.utc(),\r\n  },\r\n});\r\n\r\n//const SuburbStatus = mongoose.model(\"SuburbStatus\", SuburbStatusSchema);\r\n\r\nmodule.exports = SuburbStatusSchema;\r\n","const mongoose = require(\"mongoose\");\r\nconst moment = require(\"moment\");\r\nconst SuburbStatusSchema = require(\"./schemas/suburbStatusSchema\");\r\nconst SuburbFileSchema = require(\"./schemas/suburbFileSchema\");\r\n\r\nconst SuburbSchema = new mongoose.Schema({\r\n  name: {\r\n    type: String,\r\n  },\r\n  location: {\r\n    type: String,\r\n  },\r\n  postalCode: {\r\n    type: Number,\r\n  },\r\n  active: {\r\n    type: Boolean,\r\n  },\r\n  transtime: {\r\n    type: Date,\r\n    default: moment.utc(),\r\n  },\r\n  userAdmins: [\r\n    {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"User\",\r\n    },\r\n  ],\r\n  /*\r\n        estatus validos:\r\n        activacionPendiente,\r\n        activacionRechazada\r\n        activadoBasico,\r\n        activadoPlus\r\n    */\r\n  status: [SuburbStatusSchema],\r\n  files: [SuburbFileSchema],\r\n});\r\n\r\nSuburbSchema.statics = {\r\n  SaveSuburb: function (suburbObj) {\r\n    let suburb = new this(suburbObj);\r\n    return suburb.save();\r\n  },\r\n  UpdateStatus: function (id, status) {\r\n    if (!Array.isArray(status)) status = [status];\r\n    return this.updateOne(\r\n      { _id: id },\r\n      {\r\n        $addToSet: {\r\n          status: {\r\n            $each: status,\r\n          },\r\n        },\r\n      },\r\n      {\r\n        multi: true,\r\n      }\r\n    );\r\n  },\r\n  UpdateStatusByName: function (name, postalCode) {\r\n    if (!Array.isArray(status)) status = [status];\r\n    return this.updateOne(\r\n      { name: name, postalCode: postalCode },\r\n      {\r\n        $addToSet: {\r\n          status: {\r\n            $each: status,\r\n          },\r\n        },\r\n      },\r\n      {\r\n        multi: true,\r\n      }\r\n    );\r\n  },\r\n  GetSuburb: function (id) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({\r\n        _id: id,\r\n      })\r\n        .populate(\"userAdmins\", \"User\")\r\n        .exec((err, result) => {\r\n          if (err) reject(err);\r\n          resolve(result);\r\n        });\r\n    });\r\n  },\r\n  GetSuburbByName: function (postalCode, name) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({\r\n        postalCode: postalCode,\r\n        name: name,\r\n      }).exec((err, result) => {\r\n        if (err) reject(err);\r\n        resolve(result);\r\n      });\r\n    });\r\n  },\r\n  GetSuburbByUserId: function (userId) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({ userAdmins: mongoose.Types.ObjectId(userId) }).exec(\r\n        (err, result) => {\r\n          if (err) reject(err);\r\n          resolve(result);\r\n        }\r\n      );\r\n    });\r\n  },\r\n};\r\n\r\nconst Suburb = mongoose.model(\"Suburb\", SuburbSchema);\r\n\r\nmodule.exports = Suburb;\r\n","const moment = require(\"moment\");\r\nconst bcrypt = require(\"bcryptjs\");\r\nconst jwt = require(\"jsonwebtoken\");\r\nconst mongoose = require(\"mongoose\");\r\nconst base64 = require(\"base-64\");\r\nconst GuestSchema = require(\"./schemas/guestSchema\");\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n  name: {\r\n    type: String,\r\n    required: \"Ingresa el nombre\",\r\n  },\r\n  lastName: {\r\n    type: String,\r\n  },\r\n  password: {\r\n    type: String,\r\n  },\r\n  loginName: {\r\n    type: String,\r\n    unique: true,\r\n  },\r\n  email: {\r\n    type: String,\r\n  },\r\n  cellphone: {\r\n    type: String,\r\n  },\r\n  suburb: {\r\n    type: String,\r\n  },\r\n  loginAttempts: {\r\n    type: Number,\r\n    default: 0,\r\n  },\r\n  temporaryDisabled: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  disabledSince: {\r\n    type: Date,\r\n  },\r\n  lastAccess: {\r\n    type: Date,\r\n    default: moment.utc(),\r\n  },\r\n  /**\r\n   * valid user types:\r\n   *  guest -> a guest user\r\n   *  guard -> a guard of the suburb\r\n   *  admin -> an administrator of the suburb\r\n   *  sudo  -> an administrator of the app\r\n   */\r\n  userType: {\r\n    type: String,\r\n    default: \"guest\",\r\n  },\r\n  userConfirmed: {\r\n    type: Boolean,\r\n  },\r\n  facebookId: {\r\n    type: String,\r\n  },\r\n  googleId: {\r\n    type: String,\r\n  },\r\n  active: {\r\n    type: Boolean,\r\n    default: true,\r\n  },\r\n  transtime: {\r\n    type: Date,\r\n    default: moment.utc(),\r\n  },\r\n  roles: [\r\n    {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"Role\",\r\n    },\r\n  ],\r\n  suburb: {\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: \"Suburb\",\r\n  },\r\n  favorites: [GuestSchema],\r\n});\r\n\r\n/**\r\n * Private attributes\r\n */\r\nconst _secretKey = process.env.JWT_SECRET;\r\n\r\nlet _getExpDate = () => {\r\n  var expTimeByMin =\r\n    process.env.exptoken != null ? process.env.exptoken : \"180\";\r\n  return moment().add(expTimeByMin, \"minutes\").valueOf();\r\n};\r\n\r\nlet _getValidApis = (id) => {\r\n  //return an array with the valid apis\r\n  return [];\r\n};\r\n\r\nlet _getValidMenus = (id) => {\r\n  //return an array with the valid menus for the user\r\n  return [];\r\n};\r\n\r\n/**\r\n * Method to validate exp from the user token.\r\n * @param {*} expDate\r\n */\r\nlet _validateExpDate = function (expDate) {\r\n  let currentTime = moment().valueOf();\r\n  return expDate > currentTime;\r\n};\r\n\r\nUserSchema.methods = {\r\n  validatePassword: function (_password) {\r\n    var _this = this;\r\n    let pass = base64.decode(_password);\r\n    return new Promise(\r\n      (resolve, reject) => {\r\n        if (_this.temporaryDisabled) {\r\n          let wait = 10 - this.getDisabledSince();\r\n          if (wait > 0)\r\n            reject({\r\n              success: false,\r\n              message: `El usuario esta temporalmente desabilitado, por favor espere ${wait} minutos para volver a intentar.`,\r\n            });\r\n          else\r\n            this.increaseLoginAttempts(true).then((res) => {\r\n              this.validatePassword(_password).then(\r\n                (result) => resolve(result),\r\n                (err) => reject(err)\r\n              );\r\n            });\r\n        } else\r\n          bcrypt.compare(pass, _this.password).then((valid) => {\r\n            if (valid) {\r\n              //reset logint attempts\r\n              this.increaseLoginAttempts(true).then(\r\n                (res) => {\r\n                  resolve({\r\n                    success: true,\r\n                    message: \"La contraseña coincide.\",\r\n                  });\r\n                },\r\n                (err) =>\r\n                  reject({ success: false, message: \"Un error occurio.\" })\r\n              );\r\n            } else {\r\n              //increase login attempts\r\n              this.increaseLoginAttempts().then(\r\n                (res) => {\r\n                  reject({\r\n                    success: false,\r\n                    message: \"La contraseña no es valida.\",\r\n                  });\r\n                },\r\n                (err) =>\r\n                  reject({\r\n                    success: false,\r\n                    message: \"Un error occurio, la contraseña no es valida.\",\r\n                  })\r\n              );\r\n            }\r\n          });\r\n      },\r\n      (err) =>\r\n        reject({\r\n          success: false,\r\n          message: \"Ocurrio un error al comparar la contraseña.\",\r\n        })\r\n    );\r\n  },\r\n  getDisabledSince: function () {\r\n    let disabledSince = this.disabledSince ? this.disabledSince : moment.utc();\r\n    let start = moment(disabledSince);\r\n    let end = moment(moment.utc());\r\n    return end.diff(start, \"minutes\");\r\n  },\r\n  increaseLoginAttempts: function (reset) {\r\n    if (reset) {\r\n      this.loginAttempts = 0;\r\n      this.temporaryDisabled = false;\r\n      this.disabledSince = null;\r\n    } else {\r\n      let loginAttempts = this.loginAttempts + 1;\r\n      this.loginAttempts = loginAttempts;\r\n      this.temporaryDisabled = loginAttempts > 10;\r\n      this.disabledSince = loginAttempts > 10 ? moment.utc() : null;\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      return this.save().then(\r\n        (res) => {\r\n          resolve(res);\r\n        },\r\n        (err) => {\r\n          reject(err);\r\n        }\r\n      );\r\n    });\r\n  },\r\n  generateUserToken: function (_suburb) {\r\n    let payload = {\r\n      userId: this._id != undefined ? JSON.parse(JSON.stringify(this._id)) : \"\",\r\n      loginName: this.loginName,\r\n      suburb: this.suburb || _suburb,\r\n      userType: this.userType,\r\n      exp: _getExpDate(),\r\n      validApis: _getValidApis(this._id),\r\n      //validMenus: _getValidMenus(this._id) //verify if is better put this in another schema i.e. suburb\r\n    };\r\n    let token = jwt.sign(payload, _secretKey);\r\n    return token;\r\n  },\r\n  setUserRole: function (userId, roles) {\r\n    if (!Array.isArray(roles)) roles = [roles];\r\n    return this.update(\r\n      {\r\n        _id: userId,\r\n      },\r\n      {\r\n        $addToSet: {\r\n          roles: {\r\n            $each: roles,\r\n          },\r\n        },\r\n      },\r\n      {\r\n        multi: true,\r\n      }\r\n    );\r\n  },\r\n  deleteUserRole: function (users, roles) {\r\n    if (!Array.isArray(users)) users = [users];\r\n    if (!Array.isArray(roles)) roles = [roles];\r\n\r\n    return this.update(\r\n      {\r\n        _id: {\r\n          $in: users,\r\n        },\r\n      },\r\n      {\r\n        $pullAll: {\r\n          roles: roles,\r\n        },\r\n      },\r\n      {\r\n        multi: true,\r\n      }\r\n    );\r\n  },\r\n  getUserRoles: function (userId) {\r\n    return new Promise((resolve, reject) => {\r\n      this.find({\r\n        _id: userId,\r\n      })\r\n        .populate(\"roles\")\r\n        .exec((err, result) => {\r\n          if (err) reject(err);\r\n          resolve(getCleanResult(result, \"roles\"));\r\n        });\r\n    });\r\n  },\r\n};\r\n\r\nconst mergeArrayObjects = (arr1, arr2) => {\r\n  let firstMerge = arr1.map((item, i) => {\r\n    let assign = {\r\n      name: item.name,\r\n      vehicle: item.vehicle,\r\n      subject: item.subject,\r\n      isService: item.isService,\r\n    };\r\n    arr2.forEach((a2) => {\r\n      if (item.name === a2.name) {\r\n        assign = Object.assign(\r\n          {},\r\n          {\r\n            name: item.name,\r\n            vehicle: item.vehicle,\r\n            subject: item.subject,\r\n            isService: item.isService,\r\n          },\r\n          a2\r\n        );\r\n      }\r\n    });\r\n    return { ...assign };\r\n  });\r\n\r\n  let all = [];\r\n  arr2.forEach((item) => {\r\n    let add = true;\r\n    firstMerge.forEach((fm) => {\r\n      if (item.name.trim() === fm.name.trim()) add = false;\r\n    });\r\n    if (add) all.push(item);\r\n  });\r\n\r\n  return [...firstMerge, ...all];\r\n};\r\n\r\nUserSchema.statics = {\r\n  /**\r\n   * Method to get a user by login name\r\n   */\r\n  getLogin: function (_loginName) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({\r\n        loginName: _loginName,\r\n      }) /*.populate({\r\n                path: 'roles',\r\n                populate: {\r\n                    path: 'menus',\r\n                    model: 'Menu'\r\n                }\r\n            })*/\r\n        .exec((err, result) => {\r\n          if (err) reject(err);\r\n          resolve(result);\r\n        });\r\n    });\r\n  },\r\n  getUserByFacebookId: function (_facebookId) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({\r\n        facebookId: _facebookId,\r\n      }).exec((err, result) => {\r\n        if (err) reject(err);\r\n        resolve(result);\r\n      });\r\n    });\r\n  },\r\n  getUserByGoogleId: function (_googleId) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({\r\n        googleId: _googleId,\r\n      }).exec((err, result) => {\r\n        if (err) reject(err);\r\n        resolve(result);\r\n      });\r\n    });\r\n  },\r\n  getUserFavs: function (userId) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({ _id: userId }).exec((err, result) => {\r\n        if (err) reject(err);\r\n        resolve(result.favorites);\r\n      });\r\n    });\r\n  },\r\n  addUserFavs: function (userId, favs) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({ _id: userId }).exec((err, result) => {\r\n        if (err) reject(err);\r\n        if (!result) reject({ message: \"user not found\" });\r\n        let mergedFavs = mergeArrayObjects(result.favorites || [], favs);\r\n        this.findOneAndUpdate(\r\n          { _id: userId },\r\n          { $set: { favorites: mergedFavs } },\r\n          { new: true },\r\n          function (err, user) {\r\n            if (err) reject(err);\r\n            resolve(mergedFavs);\r\n          }\r\n        );\r\n        resolve(result);\r\n      });\r\n    });\r\n  },\r\n  removeUserFavs: function (userId, favs) {\r\n    return new Promise((resolve, reject) => {\r\n      this.findOne({ _id: userId }).exec((err, result) => {\r\n        if (err) reject(err);\r\n        if (!result) reject({ message: \"user not found\" });\r\n        let filterFavs = (result.favorites || []).filter((item) => {\r\n          let exists = favs.filter((f) => f.name.trim() === item.name.trim());\r\n          return exists.length === 0;\r\n        });\r\n\r\n        this.findOneAndUpdate(\r\n          { _id: userId },\r\n          { $set: { favorites: filterFavs } },\r\n          { new: true },\r\n          function (err, user) {\r\n            if (err) reject(err);\r\n            resolve(filterFavs);\r\n          }\r\n        );\r\n        resolve(result);\r\n      });\r\n    });\r\n  },\r\n  updateUser: function (objUser) {\r\n    return this.updateOne(\r\n      {\r\n        _id: objUser._id,\r\n      },\r\n      {\r\n        $set: {\r\n          name: objUser.name,\r\n          lastName: objUser.lastName,\r\n          password: objUser.password,\r\n          email: objUser.email,\r\n          cellphone: objUser.cellphone,\r\n          active: objUser.active,\r\n          userType: objUser.userType,\r\n          transtime: moment.utc(),\r\n        },\r\n      }\r\n    );\r\n  },\r\n  saveUser: function (objUser) {\r\n    let user = new this(objUser);\r\n    return user.save();\r\n  },\r\n  /**\r\n   * Validate if the user token is active\r\n   */\r\n  isValidToken: function (_token) {\r\n    return new Promise(function (resolve, reject) {\r\n      var isValid = false;\r\n      try {\r\n        jwt.verify(_token, _secretKey, function (err, decoded) {\r\n          if (decoded) {\r\n            if (_validateExpDate(decoded.exp)) {\r\n              isValid = true;\r\n            }\r\n          }\r\n          resolve(isValid);\r\n        });\r\n      } catch (err) {\r\n        console.log(err);\r\n        reject(false);\r\n      }\r\n    });\r\n  },\r\n  /**\r\n   * Get the payload of the jwt token\r\n   * @param {String} _token\r\n   */\r\n  getTokenPayload: function (_token) {\r\n    return new Promise(function (resolve, reject) {\r\n      try {\r\n        jwt.verify(_token, _secretKey, function (err, decoded) {\r\n          resolve(decoded);\r\n        });\r\n      } catch (err) {\r\n        reject(err);\r\n      }\r\n    });\r\n  },\r\n  encryptPassword: function (_password) {\r\n    return new Promise((resolve, reject) => {\r\n      let pass = base64.decode(_password);\r\n      let saltRounds = 10;\r\n      bcrypt.genSalt(saltRounds, (err, salt) => {\r\n        bcrypt.hash(pass, salt, (err, hash) => {\r\n          if (!err) resolve({ hash });\r\n          else reject(err);\r\n        });\r\n      });\r\n    });\r\n  },\r\n};\r\n\r\nconst User = mongoose.model(\"User\", UserSchema);\r\n\r\nmodule.exports = User;\r\n","const router = require(\"express\").Router();\r\n\r\nconst siteAuth = require(\"../controllers/siteAuth\");\r\n\r\nconst menus = require(\"../controllers/menus\");\r\n\r\nconst postalCodes = require(\"../controllers/postalCodes\");\r\n\r\nconst signup = require(\"../controllers/signup\");\r\n\r\nconst handleFiles = require(\"../controllers/handleFile\");\r\n\r\nconst multer = require(\"multer\");\r\n\r\nconst suburb = require(\"../controllers/suburb\");\r\n\r\nlet upload = multer({ dest: \"./uploads/\" });\r\n\r\nrouter.post(\"/api/checkAuth\", siteAuth.checkAuth);\r\n\r\nrouter.post(\"/api/isValidToken\", siteAuth.isValidToken);\r\n\r\nrouter.post(\"/api/validateTokenPath\", siteAuth.validateTokenPath);\r\n\r\nrouter.post(\"/api/logOff\", siteAuth.logOff);\r\n\r\nrouter.get(\"/api/auth/fbtoken\", siteAuth.getTokenByFacebookId);\r\n\r\nrouter.get(\"/api/auth/googletoken\", siteAuth.getTokenByGoogleId);\r\n\r\nrouter.post(\"/api/signUp\", signup.signUp);\r\n\r\n//user apis\r\nconst userAdmin = require(\"../controllers/userAdmin\");\r\n\r\nrouter.post(\"/api/user/:userType\", userAdmin.createUserByType);\r\nrouter.get(\"/api/user/:userType\", userAdmin.getUserByType);\r\nrouter.get(\"/api/user\", userAdmin.getUserInfo);\r\nrouter.get(\"/api/userInfo/favorites\", userAdmin.getUserFavs);\r\nrouter.post(\"/api/userInfo/addFavorites\", userAdmin.addUserFavs);\r\nrouter.post(\"/api/userInfo/removeFavorites\", userAdmin.removeUserFavs);\r\n\r\nrouter.post(\"/api/saveGoogleUser\", userAdmin.saveGoogleUser);\r\nrouter.post(\"/api/saveFacebookUser\", userAdmin.saveFacebookUser);\r\nrouter.post(\"/api/saveEmailUser\", userAdmin.saveEmailUser);\r\n\r\n//logged user APIs\r\nrouter.get(\"/api/me/menu\", menus.getMenusByUser);\r\n\r\n//postal codes\r\nrouter.get(\"/api/cp/getCPInfo\", postalCodes.getPostalCodeInfo);\r\n\r\n//handle files\r\nrouter.post(\"/api/file/upload\", upload.any(), handleFiles.uploadFile);\r\n\r\n//suburb apis\r\nrouter.post(\"/api/suburb/approveReject\", suburb.approveReject);\r\n\r\nrouter.get(\"/api/suburb/info\", suburb.getSuburbByAdminId);\r\n\r\nmodule.exports = router;\r\n","const express = require(\"express\");\r\nconst router = express.Router();\r\n\r\nconst auth = require(\"../middleware/auth\");\r\n\r\n//routes\r\nconst apiRoutes = require(\"./apiRoutes\");\r\n\r\nrouter.use(\"/api/*\", auth.checkApiAuth);\r\nrouter.all(\"/api/*\", apiRoutes);\r\n\r\nmodule.exports = router;\r\n","/**\r\n * Module dependencies.\r\n */\r\n\r\nvar app = require('./app');\r\nvar debug = require('debug')('rochacoapi:server');\r\nvar http = require('http');\r\n\r\n/**\r\n * Get port from environment and store in Express.\r\n */\r\n\r\nvar port = normalizePort(process.env.PORT || '4010');\r\napp.set('port', port);\r\n\r\n/**\r\n * Create HTTP server.\r\n */\r\n\r\nvar server = http.createServer(app);\r\n\r\n/**\r\n * Listen on provided port, on all network interfaces.\r\n */\r\n\r\nserver.listen(port);\r\nserver.on('error', onError);\r\nserver.on('listening', onListening);\r\n\r\n/**\r\n * Normalize a port into a number, string, or false.\r\n */\r\n\r\nfunction normalizePort(val) {\r\n  var port = parseInt(val, 10);\r\n\r\n  if (isNaN(port)) {\r\n    // named pipe\r\n    return val;\r\n  }\r\n\r\n  if (port >= 0) {\r\n    // port number\r\n    return port;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Event listener for HTTP server \"error\" event.\r\n */\r\n\r\nfunction onError(error) {\r\n  if (error.syscall !== 'listen') {\r\n    throw error;\r\n  }\r\n\r\n  var bind = typeof port === 'string'\r\n    ? 'Pipe ' + port\r\n    : 'Port ' + port;\r\n\r\n  // handle specific listen errors with friendly messages\r\n  switch (error.code) {\r\n    case 'EACCES':\r\n      console.error(bind + ' requires elevated privileges');\r\n      process.exit(1);\r\n      break;\r\n    case 'EADDRINUSE':\r\n      console.error(bind + ' is already in use');\r\n      process.exit(1);\r\n      break;\r\n    default:\r\n      throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Event listener for HTTP server \"listening\" event.\r\n */\r\n\r\nfunction onListening() {\r\n  var addr = server.address();\r\n  var bind = typeof addr === 'string'\r\n    ? 'pipe ' + addr\r\n    : 'port ' + addr.port;\r\n  debug('Listening on ' + bind);\r\n}\r\n","module.exports = require(\"@sendgrid/mail\");","module.exports = require(\"base-64\");","module.exports = require(\"bcryptjs\");","module.exports = require(\"body-parser\");","module.exports = require(\"cors\");","module.exports = require(\"debug\");","module.exports = require(\"dotenv\");","module.exports = require(\"dropbox-v2-api\");","module.exports = require(\"express\");","module.exports = require(\"fs\");","module.exports = require(\"http\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"moment\");","module.exports = require(\"mongoose\");","module.exports = require(\"morgan\");","module.exports = require(\"multer\");","module.exports = require(\"request\");"],"sourceRoot":""}